var Cs=Object.defineProperty;var Sr=r=>{throw TypeError(r)};var Ts=(r,e,t)=>e in r?Cs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Y=(r,e,t)=>Ts(r,typeof e!="symbol"?e+"":e,t),As=(r,e,t)=>e.has(r)||Sr("Cannot "+t);var Cr=(r,e,t)=>e.has(r)?Sr("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t);var zt=(r,e,t)=>(As(r,e,"access private method"),t);import{w as Bi,d as wn,S as he,i as de,s as pe,c as $s,a as P,t as K,b as $,g as ue,e as fe,u as Ps,f as Is,h as Ds,j as I,k as m,l as w,m as A,n as y,o as xt,p as De,q as qi,r as M,L as ar,v as te,x as ne,y as re,z as H,A as L,B as J,C as _t,D as Qe,E as pt,F as U,G as Ft,H as me,I as Ne,J as Rs,K as Os,M as an,N as Fi,O as Li,P as Tr,Q as cn,R as Ar,T as $r,U as Ks,V as Ut}from"./vendor-Bb5pvzyT.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=t(i);fetch(i.href,l)}})();function js(){const{subscribe:r,set:e,update:t}=Bi(JSON.parse(localStorage.getItem("user")||"null"));return{subscribe:r,user:{subscribe:r},isAuthenticated:wn({subscribe:r},n=>!!n),login:async n=>{const i={id:`user-${n}`,slug:n,title:n};e(i),localStorage.setItem("user",JSON.stringify(i))},logout:()=>{e(null),localStorage.removeItem("user")}}}const Pt=js(),Bs={appTitle:"Social Appliance",header:{enabled:!0,links:[{label:"Home",href:"/"},{label:"Admin",href:"/admin"},{label:"Login",href:"/login"}],customHtml:null,className:"border-b border-white/20 mb-8 pb-4"},api:{baseUrl:"/api",serverless:!1,enableCache:!1,cacheDuration:5*60*1e3,loadStaticData:!0,flushCacheOnStartup:!1,staticDataFiles:["/static.info.js"],serverRetryInterval:3e4},features:{authentication:!0,allowCreate:!0,allowEdit:!0,allowDelete:!0},methods:{onInit:()=>{},renderHeader:()=>null}},Kn=window.APP_CONFIG||Bs,kn=Bi(Kn),qs=wn(kn,r=>r.header),vt=wn(kn,r=>r.api);wn(kn,r=>r.features);var ji;(ji=Kn.methods)!=null&&ji.onInit&&Kn.methods.onInit();function Pr(r){let e,t,n,i;const l=[Ls,Fs],s=[];function a(o,u){return o[1]?0:1}return e=a(r),t=s[e]=l[e](r),{c(){t.c(),n=De()},m(o,u){s[e].m(o,u),I(o,n,u),i=!0},p(o,u){let c=e;e=a(o),e===c?s[e].p(o,u):(ue(),K(s[c],1,1,()=>{s[c]=null}),fe(),t=s[e],t?t.p(o,u):(t=s[e]=l[e](o),t.c()),$(t,1),t.m(n.parentNode,n))},i(o){i||($(t),i=!0)},o(o){K(t),i=!1},d(o){o&&P(n),s[e].d(o)}}}function Fs(r){let e,t,n,i,l,s,a,o;n=new ar({props:{to:"/",class:"text-xs uppercase tracking-wider hover:underline",$$slots:{default:[Ns]},$$scope:{ctx:r}}});const u=[zs,Ms],c=[];function h(f,d){return f[0].features.authentication&&f[3]?0:f[0].features.authentication?1:-1}return~(s=h(r))&&(a=c[s]=u[s](r)),{c(){e=w("header"),t=w("div"),re(n.$$.fragment),i=A(),l=w("nav"),a&&a.c(),y(l,"class","flex items-center gap-4 text-xs"),y(t,"class","max-w-6xl mx-auto flex items-center justify-between"),y(e,"class","border-b border-white/20 px-4 py-2")},m(f,d){I(f,e,d),m(e,t),ne(n,t,null),m(t,i),m(t,l),~s&&c[s].m(l,null),o=!0},p(f,d){const g={};d&65&&(g.$$scope={dirty:d,ctx:f}),n.$set(g);let b=s;s=h(f),s===b?~s&&c[s].p(f,d):(a&&(ue(),K(c[b],1,1,()=>{c[b]=null}),fe()),~s?(a=c[s],a?a.p(f,d):(a=c[s]=u[s](f),a.c()),$(a,1),a.m(l,null)):a=null)},i(f){o||($(n.$$.fragment,f),$(a),o=!0)},o(f){K(n.$$.fragment,f),K(a),o=!1},d(f){f&&P(e),te(n),~s&&c[s].d()}}}function Ls(r){let e,t,n;return{c(){e=w("header"),t=w("div"),y(t,"class","max-w-6xl mx-auto px-4 py-2"),y(e,"class",n=r[2].className)},m(i,l){I(i,e,l),m(e,t),t.innerHTML=r[1]},p(i,l){l&2&&(t.innerHTML=i[1]),l&4&&n!==(n=i[2].className)&&y(e,"class",n)},i:M,o:M,d(i){i&&P(e)}}}function Ns(r){let e=r[0].appTitle+"",t;return{c(){t=L(e)},m(n,i){I(n,t,i)},p(n,i){i&1&&e!==(e=n[0].appTitle+"")&&H(t,e)},d(n){n&&P(t)}}}function Ms(r){let e,t;return e=new ar({props:{to:"/login",class:"hover:underline",$$slots:{default:[Us]},$$scope:{ctx:r}}}),{c(){re(e.$$.fragment)},m(n,i){ne(e,n,i),t=!0},p(n,i){const l={};i&64&&(l.$$scope={dirty:i,ctx:n}),e.$set(l)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){K(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function zs(r){let e,t,n,i,l=r[3].slug+"",s,a,o,u,c,h,f;return e=new ar({props:{to:"/admin",class:"hover:underline",$$slots:{default:[Hs]},$$scope:{ctx:r}}}),{c(){re(e.$$.fragment),t=A(),n=w("span"),i=L("["),s=L(l),a=L("]"),o=A(),u=w("button"),u.textContent="logout",y(n,"class","text-white/60"),y(u,"class","hover:underline")},m(d,g){ne(e,d,g),I(d,t,g),I(d,n,g),m(n,i),m(n,s),m(n,a),I(d,o,g),I(d,u,g),c=!0,h||(f=J(u,"click",r[4]),h=!0)},p(d,g){const b={};g&64&&(b.$$scope={dirty:g,ctx:d}),e.$set(b),(!c||g&8)&&l!==(l=d[3].slug+"")&&H(s,l)},i(d){c||($(e.$$.fragment,d),c=!0)},o(d){K(e.$$.fragment,d),c=!1},d(d){d&&(P(t),P(n),P(o),P(u)),te(e,d),h=!1,f()}}}function Us(r){let e;return{c(){e=L("login")},m(t,n){I(t,e,n)},d(t){t&&P(e)}}}function Hs(r){let e;return{c(){e=L("admin")},m(t,n){I(t,e,n)},d(t){t&&P(e)}}}function Qs(r){let e,t,n,i,l,s=r[2].enabled&&Pr(r);const a=r[5].default,o=$s(a,r,r[6],null);return{c(){e=w("div"),s&&s.c(),t=A(),n=w("main"),i=w("div"),o&&o.c(),y(i,"class","max-w-6xl mx-auto"),y(n,"class","flex-1 px-4 py-8"),y(e,"class","min-h-screen flex flex-col")},m(u,c){I(u,e,c),s&&s.m(e,null),m(e,t),m(e,n),m(n,i),o&&o.m(i,null),l=!0},p(u,[c]){u[2].enabled?s?(s.p(u,c),c&4&&$(s,1)):(s=Pr(u),s.c(),$(s,1),s.m(e,t)):s&&(ue(),K(s,1,1,()=>{s=null}),fe()),o&&o.p&&(!l||c&64)&&Ps(o,a,u,u[6],l?Ds(a,u[6],c,null):Is(u[6]),null)},i(u){l||($(s),$(o,u),l=!0)},o(u){K(s),K(o,u),l=!1},d(u){u&&P(e),s&&s.d(),o&&o.d(u)}}}function Vs(r,e,t){let n,i,l,s;xt(r,kn,c=>t(0,i=c)),xt(r,qs,c=>t(2,l=c)),xt(r,Pt,c=>t(3,s=c));let{$$slots:a={},$$scope:o}=e;function u(){Pt.logout(),qi("/")}return r.$$set=c=>{"$$scope"in c&&t(6,o=c.$$scope)},r.$$.update=()=>{var c,h;r.$$.dirty&1&&t(1,n=(h=(c=i.methods)==null?void 0:c.renderHeader)==null?void 0:h.call(c,i))},[i,n,l,s,u,a,o]}class Ws extends he{constructor(e){super(),de(this,e,Vs,Qs,pe,{})}}const ie=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ae=Object.keys,ye=Array.isArray;function ve(r,e){return typeof e!="object"||ae(e).forEach(function(t){r[t]=e[t]}),r}typeof Promise>"u"||ie.Promise||(ie.Promise=Promise);const It=Object.getPrototypeOf,Gs={}.hasOwnProperty;function Se(r,e){return Gs.call(r,e)}function dt(r,e){typeof e=="function"&&(e=e(It(r))),(typeof Reflect>"u"?ae:Reflect.ownKeys)(e).forEach(t=>{qe(r,t,e[t])})}const Ni=Object.defineProperty;function qe(r,e,t,n){Ni(r,e,ve(t&&Se(t,"get")&&typeof t.get=="function"?{get:t.get,set:t.set,configurable:!0}:{value:t,configurable:!0,writable:!0},n))}function ut(r){return{from:function(e){return r.prototype=Object.create(e.prototype),qe(r.prototype,"constructor",r),{extend:dt.bind(null,r.prototype)}}}}const Zs=Object.getOwnPropertyDescriptor;function cr(r,e){let t;return Zs(r,e)||(t=It(r))&&cr(t,e)}const Ys=[].slice;function un(r,e,t){return Ys.call(r,e,t)}function Mi(r,e){return e(r)}function wt(r){if(!r)throw new Error("Assertion Failed")}function zi(r){ie.setImmediate?setImmediate(r):setTimeout(r,0)}function Ui(r,e){return r.reduce((t,n,i)=>{var l=e(n,i);return l&&(t[l[0]]=l[1]),t},{})}function Fe(r,e){if(typeof e=="string"&&Se(r,e))return r[e];if(!e)return r;if(typeof e!="string"){for(var t=[],n=0,i=e.length;n<i;++n){var l=Fe(r,e[n]);t.push(l)}return t}var s=e.indexOf(".");if(s!==-1){var a=r[e.substr(0,s)];return a==null?void 0:Fe(a,e.substr(s+1))}}function Te(r,e,t){if(r&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(r)))if(typeof e!="string"&&"length"in e){wt(typeof t!="string"&&"length"in t);for(var n=0,i=e.length;n<i;++n)Te(r,e[n],t[n])}else{var l=e.indexOf(".");if(l!==-1){var s=e.substr(0,l),a=e.substr(l+1);if(a==="")t===void 0?ye(r)&&!isNaN(parseInt(s))?r.splice(s,1):delete r[s]:r[s]=t;else{var o=r[s];o&&Se(r,s)||(o=r[s]={}),Te(o,a,t)}}else t===void 0?ye(r)&&!isNaN(parseInt(e))?r.splice(e,1):delete r[e]:r[e]=t}}function Hi(r){var e={};for(var t in r)Se(r,t)&&(e[t]=r[t]);return e}const Js=[].concat;function Qi(r){return Js.apply([],r)}const Vi="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Qi([8,16,32,64].map(r=>["Int","Uint","Float"].map(e=>e+r+"Array")))).filter(r=>ie[r]),Xs=Vi.map(r=>ie[r]);Ui(Vi,r=>[r,!0]);let Ue=null;function Lt(r){Ue=typeof WeakMap<"u"&&new WeakMap;const e=jn(r);return Ue=null,e}function jn(r){if(!r||typeof r!="object")return r;let e=Ue&&Ue.get(r);if(e)return e;if(ye(r)){e=[],Ue&&Ue.set(r,e);for(var t=0,n=r.length;t<n;++t)e.push(jn(r[t]))}else if(Xs.indexOf(r.constructor)>=0)e=r;else{const l=It(r);for(var i in e=l===Object.prototype?{}:Object.create(l),Ue&&Ue.set(r,e),r)Se(r,i)&&(e[i]=jn(r[i]))}return e}const{toString:el}={};function Bn(r){return el.call(r).slice(8,-1)}const qn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",tl=typeof qn=="symbol"?function(r){var e;return r!=null&&(e=r[qn])&&e.apply(r)}:function(){return null},ct={};function je(r){var e,t,n,i;if(arguments.length===1){if(ye(r))return r.slice();if(this===ct&&typeof r=="string")return[r];if(i=tl(r)){for(t=[];!(n=i.next()).done;)t.push(n.value);return t}if(r==null)return[r];if(typeof(e=r.length)=="number"){for(t=new Array(e);e--;)t[e]=r[e];return t}return[r]}for(e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return t}const ur=typeof Symbol<"u"?r=>r[Symbol.toStringTag]==="AsyncFunction":()=>!1;var Re=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Wi(r,e){Re=r,Gi=e}var Gi=()=>!0;const nl=!new Error("").stack;function st(){if(nl)try{throw st.arguments,new Error}catch(r){return r}return new Error}function Fn(r,e){var t=r.stack;return t?(e=e||0,t.indexOf(r.name)===0&&(e+=(r.name+r.message).split(`
`).length),t.split(`
`).slice(e).filter(Gi).map(n=>`
`+n).join("")):""}var Zi=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],fr=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Zi),rl={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function ft(r,e){this._e=st(),this.name=r,this.message=e}function Yi(r,e){return r+". Errors: "+Object.keys(e).map(t=>e[t].toString()).filter((t,n,i)=>i.indexOf(t)===n).join(`
`)}function fn(r,e,t,n){this._e=st(),this.failures=e,this.failedKeys=n,this.successCount=t,this.message=Yi(r,e)}function Et(r,e){this._e=st(),this.name="BulkError",this.failures=Object.keys(e).map(t=>e[t]),this.failuresByPos=e,this.message=Yi(r,e)}ut(ft).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Fn(this._e,2))}},toString:function(){return this.name+": "+this.message}}),ut(fn).from(ft),ut(Et).from(ft);var hr=fr.reduce((r,e)=>(r[e]=e+"Error",r),{});const il=ft;var N=fr.reduce((r,e)=>{var t=e+"Error";function n(i,l){this._e=st(),this.name=t,i?typeof i=="string"?(this.message=`${i}${l?`
 `+l:""}`,this.inner=l||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=rl[e]||t,this.inner=null)}return ut(n).from(il),r[e]=n,r},{});N.Syntax=SyntaxError,N.Type=TypeError,N.Range=RangeError;var Ir=Zi.reduce((r,e)=>(r[e+"Error"]=N[e],r),{}),en=fr.reduce((r,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(r[e+"Error"]=N[e]),r),{});function ee(){}function Dt(r){return r}function sl(r,e){return r==null||r===Dt?e:function(t){return e(r(t))}}function tt(r,e){return function(){r.apply(this,arguments),e.apply(this,arguments)}}function ll(r,e){return r===ee?e:function(){var t=r.apply(this,arguments);t!==void 0&&(arguments[0]=t);var n=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var l=e.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?tt(n,this.onsuccess):n),i&&(this.onerror=this.onerror?tt(i,this.onerror):i),l!==void 0?l:t}}function ol(r,e){return r===ee?e:function(){r.apply(this,arguments);var t=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),t&&(this.onsuccess=this.onsuccess?tt(t,this.onsuccess):t),n&&(this.onerror=this.onerror?tt(n,this.onerror):n)}}function al(r,e){return r===ee?e:function(t){var n=r.apply(this,arguments);ve(t,n);var i=this.onsuccess,l=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?tt(i,this.onsuccess):i),l&&(this.onerror=this.onerror?tt(l,this.onerror):l),n===void 0?s===void 0?void 0:s:ve(n,s)}}function cl(r,e){return r===ee?e:function(){return e.apply(this,arguments)!==!1&&r.apply(this,arguments)}}function dr(r,e){return r===ee?e:function(){var t=r.apply(this,arguments);if(t&&typeof t.then=="function"){for(var n=this,i=arguments.length,l=new Array(i);i--;)l[i]=arguments[i];return t.then(function(){return e.apply(n,l)})}return e.apply(this,arguments)}}en.ModifyError=fn,en.DexieError=ft,en.BulkError=Et;var Rt={};const Ji=100,[Ln,hn,Nn]=typeof Promise>"u"?[]:(()=>{let r=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[r,It(r),r];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,It(e),r]})(),Xi=hn&&hn.then,tn=Ln&&Ln.constructor,pr=!!Nn;var Mn=!1,ul=Nn?()=>{Nn.then(Ht)}:ie.setImmediate?setImmediate.bind(null,Ht):ie.MutationObserver?()=>{var r=document.createElement("div");new MutationObserver(()=>{Ht(),r=null}).observe(r,{attributes:!0}),r.setAttribute("i","1")}:()=>{setTimeout(Ht,0)},St=function(r,e){kt.push([r,e]),dn&&(ul(),dn=!1)},zn=!0,dn=!0,Je=[],nn=[],Un=null,Hn=Dt,ht={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Or,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(r=>{try{Or(r[0],r[1])}catch{}})}},F=ht,kt=[],Xe=0,rn=[];function R(r){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=ee,this._lib=!1;var e=this._PSD=F;if(Re&&(this._stackHolder=st(),this._prev=null,this._numPrev=0),typeof r!="function"){if(r!==Rt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Vn(this,this._value))}this._state=null,this._value=null,++e.ref,ts(this,r)}const Qn={get:function(){var r=F,e=pn;function t(n,i){var l=!r.global&&(r!==F||e!==pn);const s=l&&!Le();var a=new R((o,u)=>{mr(this,new es(mn(n,r,l,s),mn(i,r,l,s),o,u,r))});return Re&&is(a,this),a}return t.prototype=Rt,t},set:function(r){qe(this,"then",r&&r.prototype===Rt?Qn:{get:function(){return r},set:Qn.set})}};function es(r,e,t,n,i){this.onFulfilled=typeof r=="function"?r:null,this.onRejected=typeof e=="function"?e:null,this.resolve=t,this.reject=n,this.psd=i}function ts(r,e){try{e(t=>{if(r._state===null){if(t===r)throw new TypeError("A promise cannot be resolved with itself.");var n=r._lib&&Nt();t&&typeof t.then=="function"?ts(r,(i,l)=>{t instanceof R?t._then(i,l):t.then(i,l)}):(r._state=!0,r._value=t,ns(r)),n&&Mt()}},Vn.bind(null,r))}catch(t){Vn(r,t)}}function Vn(r,e){if(nn.push(e),r._state===null){var t=r._lib&&Nt();e=Hn(e),r._state=!1,r._value=e,Re&&e!==null&&typeof e=="object"&&!e._promise&&function(n,i,l){try{n.apply(null,l)}catch{}}(()=>{var n=cr(e,"stack");e._promise=r,qe(e,"stack",{get:()=>Mn?n&&(n.get?n.get.apply(e):n.value):r.stack})}),function(n){Je.some(i=>i._value===n._value)||Je.push(n)}(r),ns(r),t&&Mt()}}function ns(r){var e=r._listeners;r._listeners=[];for(var t=0,n=e.length;t<n;++t)mr(r,e[t]);var i=r._PSD;--i.ref||i.finalize(),Xe===0&&(++Xe,St(()=>{--Xe==0&&gr()},[]))}function mr(r,e){if(r._state!==null){var t=r._state?e.onFulfilled:e.onRejected;if(t===null)return(r._state?e.resolve:e.reject)(r._value);++e.psd.ref,++Xe,St(fl,[t,r,e])}else r._listeners.push(e)}function fl(r,e,t){try{Un=e;var n,i=e._value;e._state?n=r(i):(nn.length&&(nn=[]),n=r(i),nn.indexOf(i)===-1&&function(l){for(var s=Je.length;s;)if(Je[--s]._value===l._value)return void Je.splice(s,1)}(e)),t.resolve(n)}catch(l){t.reject(l)}finally{Un=null,--Xe==0&&gr(),--t.psd.ref||t.psd.finalize()}}function rs(r,e,t){if(e.length===t)return e;var n="";if(r._state===!1){var i,l,s=r._value;s!=null?(i=s.name||"Error",l=s.message||s,n=Fn(s,0)):(i=s,l=""),e.push(i+(l?": "+l:"")+n)}return Re&&((n=Fn(r._stackHolder,2))&&e.indexOf(n)===-1&&e.push(n),r._prev&&rs(r._prev,e,t)),e}function is(r,e){var t=e?e._numPrev+1:0;t<100&&(r._prev=e,r._numPrev=t)}function Ht(){Nt()&&Mt()}function Nt(){var r=zn;return zn=!1,dn=!1,r}function Mt(){var r,e,t;do for(;kt.length>0;)for(r=kt,kt=[],t=r.length,e=0;e<t;++e){var n=r[e];n[0].apply(null,n[1])}while(kt.length>0);zn=!0,dn=!0}function gr(){var r=Je;Je=[],r.forEach(n=>{n._PSD.onunhandled.call(null,n._value,n)});for(var e=rn.slice(0),t=e.length;t;)e[--t]()}function Qt(r){return new R(Rt,!1,r)}function le(r,e){var t=F;return function(){var n=Nt(),i=F;try{return We(t,!0),r.apply(this,arguments)}catch(l){e&&e(l)}finally{We(i,!1),n&&Mt()}}}dt(R.prototype,{then:Qn,_then:function(r,e){mr(this,new es(null,null,r,e,F))},catch:function(r){if(arguments.length===1)return this.then(null,r);var e=arguments[0],t=arguments[1];return typeof e=="function"?this.then(null,n=>n instanceof e?t(n):Qt(n)):this.then(null,n=>n&&n.name===e?t(n):Qt(n))},finally:function(r){return this.then(e=>(r(),e),e=>(r(),Qt(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Mn=!0;var r=rs(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=r),r}finally{Mn=!1}}},timeout:function(r,e){return r<1/0?new R((t,n)=>{var i=setTimeout(()=>n(new N.Timeout(e)),r);this.then(t,n).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&qe(R.prototype,Symbol.toStringTag,"Dexie.Promise"),ht.env=ss(),dt(R,{all:function(){var r=je.apply(null,arguments).map(Vt);return new R(function(e,t){r.length===0&&e([]);var n=r.length;r.forEach((i,l)=>R.resolve(i).then(s=>{r[l]=s,--n||e(r)},t))})},resolve:r=>{if(r instanceof R)return r;if(r&&typeof r.then=="function")return new R((t,n)=>{r.then(t,n)});var e=new R(Rt,!0,r);return is(e,Un),e},reject:Qt,race:function(){var r=je.apply(null,arguments).map(Vt);return new R((e,t)=>{r.map(n=>R.resolve(n).then(e,t))})},PSD:{get:()=>F,set:r=>F=r},totalEchoes:{get:()=>pn},newPSD:Ve,usePSD:gt,scheduler:{get:()=>St,set:r=>{St=r}},rejectionMapper:{get:()=>Hn,set:r=>{Hn=r}},follow:(r,e)=>new R((t,n)=>Ve((i,l)=>{var s=F;s.unhandleds=[],s.onunhandled=l,s.finalize=tt(function(){(function(a){function o(){a(),rn.splice(rn.indexOf(o),1)}rn.push(o),++Xe,St(()=>{--Xe==0&&gr()},[])})(()=>{this.unhandleds.length===0?i():l(this.unhandleds[0])})},s.finalize),r()},e,t,n))}),tn&&(tn.allSettled&&qe(R,"allSettled",function(){const r=je.apply(null,arguments).map(Vt);return new R(e=>{r.length===0&&e([]);let t=r.length;const n=new Array(t);r.forEach((i,l)=>R.resolve(i).then(s=>n[l]={status:"fulfilled",value:s},s=>n[l]={status:"rejected",reason:s}).then(()=>--t||e(n)))})}),tn.any&&typeof AggregateError<"u"&&qe(R,"any",function(){const r=je.apply(null,arguments).map(Vt);return new R((e,t)=>{r.length===0&&t(new AggregateError([]));let n=r.length;const i=new Array(n);r.forEach((l,s)=>R.resolve(l).then(a=>e(a),a=>{i[s]=a,--n||t(new AggregateError(i))}))})}));const be={awaits:0,echoes:0,id:0};var hl=0,sn=[],Cn=0,pn=0,dl=0;function Ve(r,e,t,n){var i=F,l=Object.create(i);l.parent=i,l.ref=0,l.global=!1,l.id=++dl;var s=ht.env;l.env=pr?{Promise:R,PromiseProp:{value:R,configurable:!0,writable:!0},all:R.all,race:R.race,allSettled:R.allSettled,any:R.any,resolve:R.resolve,reject:R.reject,nthen:Dr(s.nthen,l),gthen:Dr(s.gthen,l)}:{},e&&ve(l,e),++i.ref,l.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=gt(l,r,t,n);return l.ref===0&&l.finalize(),a}function mt(){return be.id||(be.id=++hl),++be.awaits,be.echoes+=Ji,be.id}function Le(){return!!be.awaits&&(--be.awaits==0&&(be.id=0),be.echoes=be.awaits*Ji,!0)}function Vt(r){return be.echoes&&r&&r.constructor===tn?(mt(),r.then(e=>(Le(),e),e=>(Le(),ce(e)))):r}function pl(r){++pn,be.echoes&&--be.echoes!=0||(be.echoes=be.id=0),sn.push(F),We(r,!0)}function ml(){var r=sn[sn.length-1];sn.pop(),We(r,!1)}function We(r,e){var t=F;if((e?!be.echoes||Cn++&&r===F:!Cn||--Cn&&r===F)||ls(e?pl.bind(null,r):ml),r!==F&&(F=r,t===ht&&(ht.env=ss()),pr)){var n=ht.env.Promise,i=r.env;hn.then=i.nthen,n.prototype.then=i.gthen,(t.global||r.global)&&(Object.defineProperty(ie,"Promise",i.PromiseProp),n.all=i.all,n.race=i.race,n.resolve=i.resolve,n.reject=i.reject,i.allSettled&&(n.allSettled=i.allSettled),i.any&&(n.any=i.any))}}function ss(){var r=ie.Promise;return pr?{Promise:r,PromiseProp:Object.getOwnPropertyDescriptor(ie,"Promise"),all:r.all,race:r.race,allSettled:r.allSettled,any:r.any,resolve:r.resolve,reject:r.reject,nthen:hn.then,gthen:r.prototype.then}:{}}function gt(r,e,t,n,i){var l=F;try{return We(r,!0),e(t,n,i)}finally{We(l,!1)}}function ls(r){Xi.call(Ln,r)}function mn(r,e,t,n){return typeof r!="function"?r:function(){var i=F;t&&mt(),We(e,!0);try{return r.apply(this,arguments)}finally{We(i,!1),n&&ls(Le)}}}function Dr(r,e){return function(t,n){return r.call(this,mn(t,e),mn(n,e))}}(""+Xi).indexOf("[native code]")===-1&&(mt=Le=ee);const Rr="unhandledrejection";function Or(r,e){var t;try{t=e.onuncatched(r)}catch{}if(t!==!1)try{var n,i={promise:e,reason:r};if(ie.document&&document.createEvent?((n=document.createEvent("Event")).initEvent(Rr,!0,!0),ve(n,i)):ie.CustomEvent&&ve(n=new CustomEvent(Rr,{detail:i}),i),n&&ie.dispatchEvent&&(dispatchEvent(n),!ie.PromiseRejectionEvent&&ie.onunhandledrejection))try{ie.onunhandledrejection(n)}catch{}Re&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${r.stack||r}`)}catch{}}var ce=R.reject;function Wn(r,e,t,n){if(r.idbdb&&(r._state.openComplete||F.letThrough||r._vip)){var i=r._createTransaction(e,t,r._dbSchema);try{i.create(),r._state.PR1398_maxLoop=3}catch(l){return l.name===hr.InvalidState&&r.isOpen()&&--r._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),r._close(),r.open().then(()=>Wn(r,e,t,n))):ce(l)}return i._promise(e,(l,s)=>Ve(()=>(F.trans=i,n(l,s,i)))).then(l=>i._completion.then(()=>l))}if(r._state.openComplete)return ce(new N.DatabaseClosed(r._state.dbOpenError));if(!r._state.isBeingOpened){if(!r._options.autoOpen)return ce(new N.DatabaseClosed);r.open().catch(ee)}return r._state.dbReadyPromise.then(()=>Wn(r,e,t,n))}const Kr="3.2.7",Ye="ï¿¿",Gn=-1/0,Oe="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",os="String expected.",Ct=[],xn=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),gl=xn,bl=xn,as=r=>!/(dexie\.js|dexie\.min\.js)/.test(r),En="__dbnames",Tn="readonly",An="readwrite";function nt(r,e){return r?e?function(){return r.apply(this,arguments)&&e.apply(this,arguments)}:r:e}const cs={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Wt(r){return typeof r!="string"||/\./.test(r)?e=>e:e=>(e[r]===void 0&&r in e&&delete(e=Lt(e))[r],e)}class yl{_trans(e,t,n){const i=this._tx||F.trans,l=this.name;function s(o,u,c){if(!c.schema[l])throw new N.NotFound("Table "+l+" not part of transaction");return t(c.idbtrans,c)}const a=Nt();try{return i&&i.db===this.db?i===F.trans?i._promise(e,s,n):Ve(()=>i._promise(e,s,n),{trans:i,transless:F.transless||F}):Wn(this.db,e,[this.name],s)}finally{a&&Mt()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",n=>this.core.get({trans:n,key:e}).then(i=>this.hook.reading.fire(i))).then(t)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(ye(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=ae(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter(u=>{if(u.compound&&t.every(c=>u.keyPath.indexOf(c)>=0)){for(let c=0;c<t.length;++c)if(t.indexOf(u.keyPath[c])===-1)return!1;return!0}return!1}).sort((u,c)=>u.keyPath.length-c.keyPath.length)[0];if(n&&this.db._maxKey!==Ye){const u=n.keyPath.slice(0,t.length);return this.where(u).equals(u.map(c=>e[c]))}!n&&Re&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:i}=this.schema,l=this.db._deps.indexedDB;function s(u,c){try{return l.cmp(u,c)===0}catch{return!1}}const[a,o]=t.reduce(([u,c],h)=>{const f=i[h],d=e[h];return[u||f,u||!f?nt(c,f&&f.multi?g=>{const b=Fe(g,h);return ye(b)&&b.some(_=>s(d,_))}:g=>s(d,Fe(g,h))):c]},[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(o):n?this.filter(o):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,ye(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const t=n=>{if(!n)return n;const i=Object.create(e.prototype);for(var l in n)if(Se(n,l))try{i[l]=n[l]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){return this.mapToClass(function(e){ve(this,e)})}add(e,t){const{auto:n,keyPath:i}=this.schema.primKey;let l=e;return i&&n&&(l=Wt(i)(e)),this._trans("readwrite",s=>this.core.mutate({trans:s,type:"add",keys:t!=null?[t]:null,values:[l]})).then(s=>s.numFailures?R.reject(s.failures[0]):s.lastResult).then(s=>{if(i)try{Te(e,i,s)}catch{}return s})}update(e,t){if(typeof e!="object"||ye(e))return this.where(":id").equals(e).modify(t);{const n=Fe(e,this.schema.primKey.keyPath);if(n===void 0)return ce(new N.InvalidArgument("Given object does not contain its primary key"));try{typeof t!="function"?ae(t).forEach(i=>{Te(e,i,t[i])}):t(e,{value:e,primKey:n})}catch{}return this.where(":id").equals(n).modify(t)}}put(e,t){const{auto:n,keyPath:i}=this.schema.primKey;let l=e;return i&&n&&(l=Wt(i)(e)),this._trans("readwrite",s=>this.core.mutate({trans:s,type:"put",values:[l],keys:t!=null?[t]:null})).then(s=>s.numFailures?R.reject(s.failures[0]):s.lastResult).then(s=>{if(i)try{Te(e,i,s)}catch{}return s})}delete(e){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"delete",keys:[e]})).then(t=>t.numFailures?R.reject(t.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:cs})).then(e=>e.numFailures?R.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",t=>this.core.getMany({keys:e,trans:t}).then(n=>n.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,t,n){const i=Array.isArray(t)?t:void 0,l=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",s=>{const{auto:a,keyPath:o}=this.schema.primKey;if(o&&i)throw new N.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new N.InvalidArgument("Arguments objects and keys must have the same length");const u=e.length;let c=o&&a?e.map(Wt(o)):e;return this.core.mutate({trans:s,type:"add",keys:i,values:c,wantResults:l}).then(({numFailures:h,results:f,lastResult:d,failures:g})=>{if(h===0)return l?f:d;throw new Et(`${this.name}.bulkAdd(): ${h} of ${u} operations failed`,g)})})}bulkPut(e,t,n){const i=Array.isArray(t)?t:void 0,l=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",s=>{const{auto:a,keyPath:o}=this.schema.primKey;if(o&&i)throw new N.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new N.InvalidArgument("Arguments objects and keys must have the same length");const u=e.length;let c=o&&a?e.map(Wt(o)):e;return this.core.mutate({trans:s,type:"put",keys:i,values:c,wantResults:l}).then(({numFailures:h,results:f,lastResult:d,failures:g})=>{if(h===0)return l?f:d;throw new Et(`${this.name}.bulkPut(): ${h} of ${u} operations failed`,g)})})}bulkDelete(e){const t=e.length;return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:e})).then(({numFailures:n,lastResult:i,failures:l})=>{if(n===0)return i;throw new Et(`${this.name}.bulkDelete(): ${n} of ${t} operations failed`,l)})}}function Tt(r){var e={},t=function(s,a){if(a){for(var o=arguments.length,u=new Array(o-1);--o;)u[o-1]=arguments[o];return e[s].subscribe.apply(null,u),r}if(typeof s=="string")return e[s]};t.addEventType=l;for(var n=1,i=arguments.length;n<i;++n)l(arguments[n]);return t;function l(s,a,o){if(typeof s!="object"){var u;a||(a=cl),o||(o=ee);var c={subscribers:[],fire:o,subscribe:function(h){c.subscribers.indexOf(h)===-1&&(c.subscribers.push(h),c.fire=a(c.fire,h))},unsubscribe:function(h){c.subscribers=c.subscribers.filter(function(f){return f!==h}),c.fire=c.subscribers.reduce(a,o)}};return e[s]=t[s]=c,c}ae(u=s).forEach(function(h){var f=u[h];if(ye(f))l(h,u[h][0],u[h][1]);else{if(f!=="asap")throw new N.InvalidArgument("Invalid event config");var d=l(h,Dt,function(){for(var g=arguments.length,b=new Array(g);g--;)b[g]=arguments[g];d.subscribers.forEach(function(_){zi(function(){_.apply(null,b)})})})}})}}function yt(r,e){return ut(e).from({prototype:r}),e}function ot(r,e){return!(r.filter||r.algorithm||r.or)&&(e?r.justLimit:!r.replayFilter)}function $n(r,e){r.filter=nt(r.filter,e)}function Pn(r,e,t){var n=r.replayFilter;r.replayFilter=n?()=>nt(n(),e()):e,r.justLimit=t&&!n}function ln(r,e){if(r.isPrimKey)return e.primaryKey;const t=e.getIndexByKeyPath(r.index);if(!t)throw new N.Schema("KeyPath "+r.index+" on object store "+e.name+" is not indexed");return t}function jr(r,e,t){const n=ln(r,e.schema);return e.openCursor({trans:t,values:!r.keysOnly,reverse:r.dir==="prev",unique:!!r.unique,query:{index:n,range:r.range}})}function Gt(r,e,t,n){const i=r.replayFilter?nt(r.filter,r.replayFilter()):r.filter;if(r.or){const l={},s=(a,o,u)=>{if(!i||i(o,u,f=>o.stop(f),f=>o.fail(f))){var c=o.primaryKey,h=""+c;h==="[object ArrayBuffer]"&&(h=""+new Uint8Array(c)),Se(l,h)||(l[h]=!0,e(a,o,u))}};return Promise.all([r.or._iterate(s,t),Br(jr(r,n,t),r.algorithm,s,!r.keysOnly&&r.valueMapper)])}return Br(jr(r,n,t),nt(r.algorithm,i),e,!r.keysOnly&&r.valueMapper)}function Br(r,e,t,n){var i=le(n?(l,s,a)=>t(n(l),s,a):t);return r.then(l=>{if(l)return l.start(()=>{var s=()=>l.continue();e&&!e(l,a=>s=a,a=>{l.stop(a),s=ee},a=>{l.fail(a),s=ee})||i(l.value,l,a=>s=a),s()})})}function _e(r,e){try{const t=qr(r),n=qr(e);if(t!==n)return t==="Array"?1:n==="Array"?-1:t==="binary"?1:n==="binary"?-1:t==="string"?1:n==="string"?-1:t==="Date"?1:n!=="Date"?NaN:-1;switch(t){case"number":case"Date":case"string":return r>e?1:r<e?-1:0;case"binary":return function(i,l){const s=i.length,a=l.length,o=s<a?s:a;for(let u=0;u<o;++u)if(i[u]!==l[u])return i[u]<l[u]?-1:1;return s===a?0:s<a?-1:1}(Fr(r),Fr(e));case"Array":return function(i,l){const s=i.length,a=l.length,o=s<a?s:a;for(let u=0;u<o;++u){const c=_e(i[u],l[u]);if(c!==0)return c}return s===a?0:s<a?-1:1}(r,e)}}catch{}return NaN}function qr(r){const e=typeof r;if(e!=="object")return e;if(ArrayBuffer.isView(r))return"binary";const t=Bn(r);return t==="ArrayBuffer"?"binary":t}function Fr(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r)}class _l{_read(e,t){var n=this._ctx;return n.error?n.table._trans(null,ce.bind(null,n.error)):n.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,ce.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=nt(t.algorithm,e)}_iterate(e,t){return Gt(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&ve(n,e),t._ctx=n,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read(n=>Gt(t,e,n,t.table.core))}count(e){return this._read(t=>{const n=this._ctx,i=n.table.core;if(ot(n,!0))return i.count({trans:t,query:{index:ln(n,i.schema),range:n.range}}).then(s=>Math.min(s,n.limit));var l=0;return Gt(n,()=>(++l,!1),t,i).then(()=>l)}).then(e)}sortBy(e,t){const n=e.split(".").reverse(),i=n[0],l=n.length-1;function s(u,c){return c?s(u[n[c]],c-1):u[i]}var a=this._ctx.dir==="next"?1:-1;function o(u,c){var h=s(u,l),f=s(c,l);return h<f?-a:h>f?a:0}return this.toArray(function(u){return u.sort(o)}).then(t)}toArray(e){return this._read(t=>{var n=this._ctx;if(n.dir==="next"&&ot(n,!0)&&n.limit>0){const{valueMapper:i}=n,l=ln(n,n.table.core.schema);return n.table.core.query({trans:t,limit:n.limit,values:!0,query:{index:l,range:n.range}}).then(({result:s})=>i?s.map(i):s)}{const i=[];return Gt(n,l=>i.push(l),t,n.table.core).then(()=>i)}},e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,ot(t)?Pn(t,()=>{var n=e;return(i,l)=>n===0||(n===1?(--n,!1):(l(()=>{i.advance(n),n=0}),!1))}):Pn(t,()=>{var n=e;return()=>--n<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Pn(this._ctx,()=>{var t=e;return function(n,i,l){return--t<=0&&i(l),t>=0}},!0),this}until(e,t){return $n(this._ctx,function(n,i,l){return!e(n.value)||(i(l),t)}),this}first(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var t,n;return $n(this._ctx,function(i){return e(i.value)}),t=this._ctx,n=e,t.isMatch=nt(t.isMatch,n),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,i){e(i.primaryKey,i)})}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(i,l){n.push(l.key)}).then(function(){return n}).then(e)}primaryKeys(e){var t=this._ctx;if(t.dir==="next"&&ot(t,!0)&&t.limit>0)return this._read(i=>{var l=ln(t,t.table.core.schema);return t.table.core.query({trans:i,values:!1,limit:t.limit,query:{index:l,range:t.range}})}).then(({result:i})=>i).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(i,l){n.push(l.primaryKey)}).then(function(){return n}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(t){return t[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return $n(this._ctx,function(i){var l=i.primaryKey.toString(),s=Se(n,l);return n[l]=!0,!s}),this}modify(e){var t=this._ctx;return this._write(n=>{var i;if(typeof e=="function")i=e;else{var l=ae(e),s=l.length;i=function(b){for(var _=!1,p=0;p<s;++p){var v=l[p],k=e[v];Fe(b,v)!==k&&(Te(b,v,k),_=!0)}return _}}const a=t.table.core,{outbound:o,extractKey:u}=a.schema.primaryKey,c=this.db._options.modifyChunkSize||200,h=[];let f=0;const d=[],g=(b,_)=>{const{failures:p,numFailures:v}=_;f+=b-v;for(let k of ae(p))h.push(p[k])};return this.clone().primaryKeys().then(b=>{const _=p=>{const v=Math.min(c,b.length-p);return a.getMany({trans:n,keys:b.slice(p,p+v),cache:"immutable"}).then(k=>{const E=[],x=[],T=o?[]:null,C=[];for(let S=0;S<v;++S){const B=k[S],O={value:Lt(B),primKey:b[p+S]};i.call(O,O.value,O)!==!1&&(O.value==null?C.push(b[p+S]):o||_e(u(B),u(O.value))===0?(x.push(O.value),o&&T.push(b[p+S])):(C.push(b[p+S]),E.push(O.value)))}const j=ot(t)&&t.limit===1/0&&(typeof e!="function"||e===In)&&{index:t.index,range:t.range};return Promise.resolve(E.length>0&&a.mutate({trans:n,type:"add",values:E}).then(S=>{for(let B in S.failures)C.splice(parseInt(B),1);g(E.length,S)})).then(()=>(x.length>0||j&&typeof e=="object")&&a.mutate({trans:n,type:"put",keys:T,values:x,criteria:j,changeSpec:typeof e!="function"&&e}).then(S=>g(x.length,S))).then(()=>(C.length>0||j&&e===In)&&a.mutate({trans:n,type:"delete",keys:C,criteria:j}).then(S=>g(C.length,S))).then(()=>b.length>p+v&&_(p+c))})};return _(0).then(()=>{if(h.length>0)throw new fn("Error modifying one or more objects",h,f,d);return b.length})})})}delete(){var e=this._ctx,t=e.range;return ot(e)&&(e.isPrimKey&&!bl||t.type===3)?this._write(n=>{const{primaryKey:i}=e.table.core.schema,l=t;return e.table.core.count({trans:n,query:{index:i,range:l}}).then(s=>e.table.core.mutate({trans:n,type:"deleteRange",range:l}).then(({failures:a,lastResult:o,results:u,numFailures:c})=>{if(c)throw new fn("Could not delete some values",Object.keys(a).map(h=>a[h]),s-c);return s-c}))}):this.modify(In)}}const In=(r,e)=>e.value=null;function vl(r,e){return r<e?-1:r===e?0:1}function wl(r,e){return r>e?-1:r===e?0:1}function xe(r,e,t){var n=r instanceof fs?new r.Collection(r):r;return n._ctx.error=t?new t(e):new TypeError(e),n}function at(r){return new r.Collection(r,()=>us("")).limit(0)}function kl(r,e,t,n,i,l){for(var s=Math.min(r.length,n.length),a=-1,o=0;o<s;++o){var u=e[o];if(u!==n[o])return i(r[o],t[o])<0?r.substr(0,o)+t[o]+t.substr(o+1):i(r[o],n[o])<0?r.substr(0,o)+n[o]+t.substr(o+1):a>=0?r.substr(0,a)+e[a]+t.substr(a+1):null;i(r[o],u)<0&&(a=o)}return s<n.length&&l==="next"?r+t.substr(r.length):s<r.length&&l==="prev"?r.substr(0,t.length):a<0?null:r.substr(0,a)+n[a]+t.substr(a+1)}function Zt(r,e,t,n){var i,l,s,a,o,u,c,h=t.length;if(!t.every(b=>typeof b=="string"))return xe(r,os);function f(b){i=function(p){return p==="next"?v=>v.toUpperCase():v=>v.toLowerCase()}(b),l=function(p){return p==="next"?v=>v.toLowerCase():v=>v.toUpperCase()}(b),s=b==="next"?vl:wl;var _=t.map(function(p){return{lower:l(p),upper:i(p)}}).sort(function(p,v){return s(p.lower,v.lower)});a=_.map(function(p){return p.upper}),o=_.map(function(p){return p.lower}),u=b,c=b==="next"?"":n}f("next");var d=new r.Collection(r,()=>ze(a[0],o[h-1]+n));d._ondirectionchange=function(b){f(b)};var g=0;return d._addAlgorithm(function(b,_,p){var v=b.key;if(typeof v!="string")return!1;var k=l(v);if(e(k,o,g))return!0;for(var E=null,x=g;x<h;++x){var T=kl(v,k,a[x],o[x],s,u);T===null&&E===null?g=x+1:(E===null||s(E,T)>0)&&(E=T)}return _(E!==null?function(){b.continue(E+c)}:p),!1}),d}function ze(r,e,t,n){return{type:2,lower:r,upper:e,lowerOpen:t,upperOpen:n}}function us(r){return{type:1,lower:r,upper:r}}class fs{get Collection(){return this._ctx.table.db.Collection}between(e,t,n,i){n=n!==!1,i=i===!0;try{return this._cmp(e,t)>0||this._cmp(e,t)===0&&(n||i)&&(!n||!i)?at(this):new this.Collection(this,()=>ze(e,t,!n,!i))}catch{return xe(this,Oe)}}equals(e){return e==null?xe(this,Oe):new this.Collection(this,()=>us(e))}above(e){return e==null?xe(this,Oe):new this.Collection(this,()=>ze(e,void 0,!0))}aboveOrEqual(e){return e==null?xe(this,Oe):new this.Collection(this,()=>ze(e,void 0,!1))}below(e){return e==null?xe(this,Oe):new this.Collection(this,()=>ze(void 0,e,!1,!0))}belowOrEqual(e){return e==null?xe(this,Oe):new this.Collection(this,()=>ze(void 0,e))}startsWith(e){return typeof e!="string"?xe(this,os):this.between(e,e+Ye,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):Zt(this,(t,n)=>t.indexOf(n[0])===0,[e],Ye)}equalsIgnoreCase(e){return Zt(this,(t,n)=>t===n[0],[e],"")}anyOfIgnoreCase(){var e=je.apply(ct,arguments);return e.length===0?at(this):Zt(this,(t,n)=>n.indexOf(t)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=je.apply(ct,arguments);return e.length===0?at(this):Zt(this,(t,n)=>n.some(i=>t.indexOf(i)===0),e,Ye)}anyOf(){const e=je.apply(ct,arguments);let t=this._cmp;try{e.sort(t)}catch{return xe(this,Oe)}if(e.length===0)return at(this);const n=new this.Collection(this,()=>ze(e[0],e[e.length-1]));n._ondirectionchange=l=>{t=l==="next"?this._ascending:this._descending,e.sort(t)};let i=0;return n._addAlgorithm((l,s,a)=>{const o=l.key;for(;t(o,e[i])>0;)if(++i,i===e.length)return s(a),!1;return t(o,e[i])===0||(s(()=>{l.continue(e[i])}),!1)}),n}notEqual(e){return this.inAnyRange([[Gn,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=je.apply(ct,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return xe(this,Oe)}const t=e.reduce((n,i)=>n?n.concat([[n[n.length-1][1],i]]):[[Gn,i]],null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const n=this._cmp,i=this._ascending,l=this._descending,s=this._min,a=this._max;if(e.length===0)return at(this);if(!e.every(v=>v[0]!==void 0&&v[1]!==void 0&&i(v[0],v[1])<=0))return xe(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",N.InvalidArgument);const o=!t||t.includeLowers!==!1,u=t&&t.includeUppers===!0;let c,h=i;function f(v,k){return h(v[0],k[0])}try{c=e.reduce(function(v,k){let E=0,x=v.length;for(;E<x;++E){const T=v[E];if(n(k[0],T[1])<0&&n(k[1],T[0])>0){T[0]=s(T[0],k[0]),T[1]=a(T[1],k[1]);break}}return E===x&&v.push(k),v},[]),c.sort(f)}catch{return xe(this,Oe)}let d=0;const g=u?v=>i(v,c[d][1])>0:v=>i(v,c[d][1])>=0,b=o?v=>l(v,c[d][0])>0:v=>l(v,c[d][0])>=0;let _=g;const p=new this.Collection(this,()=>ze(c[0][0],c[c.length-1][1],!o,!u));return p._ondirectionchange=v=>{v==="next"?(_=g,h=i):(_=b,h=l),c.sort(f)},p._addAlgorithm((v,k,E)=>{for(var x=v.key;_(x);)if(++d,d===c.length)return k(E),!1;return!!function(T){return!g(T)&&!b(T)}(x)||(this._cmp(x,c[d][1])===0||this._cmp(x,c[d][0])===0||k(()=>{h===i?v.continue(c[d][0]):v.continue(c[d][1])}),!1)}),p}startsWithAnyOf(){const e=je.apply(ct,arguments);return e.every(t=>typeof t=="string")?e.length===0?at(this):this.inAnyRange(e.map(t=>[t,t+Ye])):xe(this,"startsWithAnyOf() only works with strings")}}function Ae(r){return le(function(e){return Ot(e),r(e.target.error),!1})}function Ot(r){r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault()}const Kt="storagemutated",He="x-storagemutated-1",Ge=Tt(null,Kt);class xl{_lock(){return wt(!F.global),++this._reculock,this._reculock!==1||F.global||(F.lockOwnerFor=this),this}_unlock(){if(wt(!F.global),--this._reculock==0)for(F.global||(F.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{gt(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&F.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,n=this.db._state.dbOpenError;if(wt(!this.idbtrans),!e&&!t)switch(n&&n.name){case"DatabaseClosedError":throw new N.DatabaseClosed(n);case"MissingAPIError":throw new N.MissingAPI(n.message,n);default:throw new N.OpenFailed(n)}if(!this.active)throw new N.TransactionInactive;return wt(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=le(i=>{Ot(i),this._reject(e.error)}),e.onabort=le(i=>{Ot(i),this.active&&this._reject(new N.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=le(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Ge.storagemutated.fire(e.mutatedParts)}),this}_promise(e,t,n){if(e==="readwrite"&&this.mode!=="readwrite")return ce(new N.ReadOnly("Transaction is readonly"));if(!this.active)return ce(new N.TransactionInactive);if(this._locked())return new R((l,s)=>{this._blockedFuncs.push([()=>{this._promise(e,t,n).then(l,s)},F])});if(n)return Ve(()=>{var l=new R((s,a)=>{this._lock();const o=t(s,a,this);o&&o.then&&o.then(s,a)});return l.finally(()=>this._unlock()),l._lib=!0,l});var i=new R((l,s)=>{var a=t(l,s,this);a&&a.then&&a.then(l,s)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const n=R.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then(()=>n);else{t._waitingFor=n,t._waitingQueue=[];var i=t.idbtrans.objectStore(t.storeNames[0]);(function s(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(i.get(-1/0).onsuccess=s)})()}var l=t._waitingFor;return new R((s,a)=>{n.then(o=>t._waitingQueue.push(le(s.bind(null,o))),o=>t._waitingQueue.push(le(a.bind(null,o)))).finally(()=>{t._waitingFor===l&&(t._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new N.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if(Se(t,e))return t[e];const n=this.schema[e];if(!n)throw new N.NotFound("Table "+e+" not part of transaction");const i=new this.db.Table(e,n,this);return i.core=this.db.core.table(e),t[e]=i,i}}function Zn(r,e,t,n,i,l,s){return{name:r,keyPath:e,unique:t,multi:n,auto:i,compound:l,src:(t&&!s?"&":"")+(n?"*":"")+(i?"++":"")+hs(e)}}function hs(r){return typeof r=="string"?r:r?"["+[].join.call(r,"+")+"]":""}function ds(r,e,t){return{name:r,primKey:e,indexes:t,mappedClass:null,idxByName:Ui(t,n=>[n.name,n])}}let jt=r=>{try{return r.only([[]]),jt=()=>[[]],[[]]}catch{return jt=()=>Ye,Ye}};function Yn(r){return r==null?()=>{}:typeof r=="string"?function(e){return e.split(".").length===1?n=>n[e]:n=>Fe(n,e)}(r):e=>Fe(e,r)}function Lr(r){return[].slice.call(r)}let El=0;function At(r){return r==null?":id":typeof r=="string"?r:`[${r.join("+")}]`}function Sl(r,e,t){function n(o){if(o.type===3)return null;if(o.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:u,upper:c,lowerOpen:h,upperOpen:f}=o;return u===void 0?c===void 0?null:e.upperBound(c,!!f):c===void 0?e.lowerBound(u,!!h):e.bound(u,c,!!h,!!f)}const{schema:i,hasGetAll:l}=function(o,u){const c=Lr(o.objectStoreNames);return{schema:{name:o.name,tables:c.map(h=>u.objectStore(h)).map(h=>{const{keyPath:f,autoIncrement:d}=h,g=ye(f),b=f==null,_={},p={name:h.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:b,compound:g,keyPath:f,autoIncrement:d,unique:!0,extractKey:Yn(f)},indexes:Lr(h.indexNames).map(v=>h.index(v)).map(v=>{const{name:k,unique:E,multiEntry:x,keyPath:T}=v,C={name:k,compound:ye(T),keyPath:T,unique:E,multiEntry:x,extractKey:Yn(T)};return _[At(T)]=C,C}),getIndexByKeyPath:v=>_[At(v)]};return _[":id"]=p.primaryKey,f!=null&&(_[At(f)]=p.primaryKey),p})},hasGetAll:c.length>0&&"getAll"in u.objectStore(c[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(r,t),s=i.tables.map(o=>function(u){const c=u.name;return{name:c,schema:u,mutate:function({trans:h,type:f,keys:d,values:g,range:b}){return new Promise((_,p)=>{_=le(_);const v=h.objectStore(c),k=v.keyPath==null,E=f==="put"||f==="add";if(!E&&f!=="delete"&&f!=="deleteRange")throw new Error("Invalid operation type: "+f);const{length:x}=d||g||{length:1};if(d&&g&&d.length!==g.length)throw new Error("Given keys array must have same length as given values array.");if(x===0)return _({numFailures:0,failures:{},results:[],lastResult:void 0});let T;const C=[],j=[];let S=0;const B=z=>{++S,Ot(z)};if(f==="deleteRange"){if(b.type===4)return _({numFailures:S,failures:j,results:[],lastResult:void 0});b.type===3?C.push(T=v.clear()):C.push(T=v.delete(n(b)))}else{const[z,X]=E?k?[g,d]:[g,null]:[d,null];if(E)for(let Z=0;Z<x;++Z)C.push(T=X&&X[Z]!==void 0?v[f](z[Z],X[Z]):v[f](z[Z])),T.onerror=B;else for(let Z=0;Z<x;++Z)C.push(T=v[f](z[Z])),T.onerror=B}const O=z=>{const X=z.target.result;C.forEach((Z,oe)=>Z.error!=null&&(j[oe]=Z.error)),_({numFailures:S,failures:j,results:f==="delete"?d:C.map(Z=>Z.result),lastResult:X})};T.onerror=z=>{B(z),O(z)},T.onsuccess=O})},getMany:({trans:h,keys:f})=>new Promise((d,g)=>{d=le(d);const b=h.objectStore(c),_=f.length,p=new Array(_);let v,k=0,E=0;const x=C=>{const j=C.target;p[j._pos]=j.result,++E===k&&d(p)},T=Ae(g);for(let C=0;C<_;++C)f[C]!=null&&(v=b.get(f[C]),v._pos=C,v.onsuccess=x,v.onerror=T,++k);k===0&&d(p)}),get:({trans:h,key:f})=>new Promise((d,g)=>{d=le(d);const b=h.objectStore(c).get(f);b.onsuccess=_=>d(_.target.result),b.onerror=Ae(g)}),query:function(h){return f=>new Promise((d,g)=>{d=le(d);const{trans:b,values:_,limit:p,query:v}=f,k=p===1/0?void 0:p,{index:E,range:x}=v,T=b.objectStore(c),C=E.isPrimaryKey?T:T.index(E.name),j=n(x);if(p===0)return d({result:[]});if(h){const S=_?C.getAll(j,k):C.getAllKeys(j,k);S.onsuccess=B=>d({result:B.target.result}),S.onerror=Ae(g)}else{let S=0;const B=_||!("openKeyCursor"in C)?C.openCursor(j):C.openKeyCursor(j),O=[];B.onsuccess=z=>{const X=B.result;return X?(O.push(_?X.value:X.primaryKey),++S===p?d({result:O}):void X.continue()):d({result:O})},B.onerror=Ae(g)}})}(l),openCursor:function({trans:h,values:f,query:d,reverse:g,unique:b}){return new Promise((_,p)=>{_=le(_);const{index:v,range:k}=d,E=h.objectStore(c),x=v.isPrimaryKey?E:E.index(v.name),T=g?b?"prevunique":"prev":b?"nextunique":"next",C=f||!("openKeyCursor"in x)?x.openCursor(n(k),T):x.openKeyCursor(n(k),T);C.onerror=Ae(p),C.onsuccess=le(j=>{const S=C.result;if(!S)return void _(null);S.___id=++El,S.done=!1;const B=S.continue.bind(S);let O=S.continuePrimaryKey;O&&(O=O.bind(S));const z=S.advance.bind(S),X=()=>{throw new Error("Cursor not stopped")};S.trans=h,S.stop=S.continue=S.continuePrimaryKey=S.advance=()=>{throw new Error("Cursor not started")},S.fail=le(p),S.next=function(){let Z=1;return this.start(()=>Z--?this.continue():this.stop()).then(()=>this)},S.start=Z=>{const oe=new Promise((Q,V)=>{Q=le(Q),C.onerror=Ae(V),S.fail=V,S.stop=ge=>{S.stop=S.continue=S.continuePrimaryKey=S.advance=X,Q(ge)}}),se=()=>{if(C.result)try{Z()}catch(Q){S.fail(Q)}else S.done=!0,S.start=()=>{throw new Error("Cursor behind last entry")},S.stop()};return C.onsuccess=le(Q=>{C.onsuccess=se,se()}),S.continue=B,S.continuePrimaryKey=O,S.advance=z,se(),oe},_(S)},p)})},count({query:h,trans:f}){const{index:d,range:g}=h;return new Promise((b,_)=>{const p=f.objectStore(c),v=d.isPrimaryKey?p:p.index(d.name),k=n(g),E=k?v.count(k):v.count();E.onsuccess=le(x=>b(x.target.result)),E.onerror=Ae(_)})}}}(o)),a={};return s.forEach(o=>a[o.name]=o),{stack:"dbcore",transaction:r.transaction.bind(r),table(o){if(!a[o])throw new Error(`Table '${o}' not found`);return a[o]},MIN_KEY:-1/0,MAX_KEY:jt(e),schema:i}}function Jn({_novip:r},e){const t=e.db,n=function(i,l,{IDBKeyRange:s,indexedDB:a},o){return{dbcore:function(c,h){return h.reduce((f,{create:d})=>({...f,...d(f)}),c)}(Sl(l,s,o),i.dbcore)}}(r._middlewares,t,r._deps,e);r.core=n.dbcore,r.tables.forEach(i=>{const l=i.name;r.core.schema.tables.some(s=>s.name===l)&&(i.core=r.core.table(l),r[l]instanceof r.Table&&(r[l].core=i.core))})}function gn({_novip:r},e,t,n){t.forEach(i=>{const l=n[i];e.forEach(s=>{const a=cr(s,i);(!a||"value"in a&&a.value===void 0)&&(s===r.Transaction.prototype||s instanceof r.Transaction?qe(s,i,{get(){return this.table(i)},set(o){Ni(this,i,{value:o,writable:!0,configurable:!0,enumerable:!0})}}):s[i]=new r.Table(i,l))})})}function Xn({_novip:r},e){e.forEach(t=>{for(let n in t)t[n]instanceof r.Table&&delete t[n]})}function Cl(r,e){return r._cfg.version-e._cfg.version}function Tl(r,e,t,n){const i=r._dbSchema,l=r._createTransaction("readwrite",r._storeNames,i);l.create(t),l._completion.catch(n);const s=l._reject.bind(l),a=F.transless||F;Ve(()=>{F.trans=l,F.transless=a,e===0?(ae(i).forEach(o=>{Dn(t,o,i[o].primKey,i[o].indexes)}),Jn(r,t),R.follow(()=>r.on.populate.fire(l)).catch(s)):function({_novip:o},u,c,h){const f=[],d=o._versions;let g=o._dbSchema=tr(o,o.idbdb,h),b=!1;const _=d.filter(v=>v._cfg.version>=u);function p(){return f.length?R.resolve(f.shift()(c.idbtrans)).then(p):R.resolve()}return _.forEach(v=>{f.push(()=>{const k=g,E=v._cfg.dbschema;nr(o,k,h),nr(o,E,h),g=o._dbSchema=E;const x=ps(k,E);x.add.forEach(C=>{Dn(h,C[0],C[1].primKey,C[1].indexes)}),x.change.forEach(C=>{if(C.recreate)throw new N.Upgrade("Not yet support for changing primary key");{const j=h.objectStore(C.name);C.add.forEach(S=>er(j,S)),C.change.forEach(S=>{j.deleteIndex(S.name),er(j,S)}),C.del.forEach(S=>j.deleteIndex(S))}});const T=v._cfg.contentUpgrade;if(T&&v._cfg.version>u){Jn(o,h),c._memoizedTables={},b=!0;let C=Hi(E);x.del.forEach(O=>{C[O]=k[O]}),Xn(o,[o.Transaction.prototype]),gn(o,[o.Transaction.prototype],ae(C),C),c.schema=C;const j=ur(T);let S;j&&mt();const B=R.follow(()=>{if(S=T(c),S&&j){var O=Le.bind(null,null);S.then(O,O)}});return S&&typeof S.then=="function"?R.resolve(S):B.then(()=>S)}}),f.push(k=>{(!b||!gl)&&function(E,x){[].slice.call(x.db.objectStoreNames).forEach(T=>E[T]==null&&x.db.deleteObjectStore(T))}(v._cfg.dbschema,k),Xn(o,[o.Transaction.prototype]),gn(o,[o.Transaction.prototype],o._storeNames,o._dbSchema),c.schema=o._dbSchema})}),p().then(()=>{var v,k;k=h,ae(v=g).forEach(E=>{k.db.objectStoreNames.contains(E)||Dn(k,E,v[E].primKey,v[E].indexes)})})}(r,e,l,t).catch(s)})}function ps(r,e){const t={del:[],add:[],change:[]};let n;for(n in r)e[n]||t.del.push(n);for(n in e){const i=r[n],l=e[n];if(i){const s={name:n,def:l,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(l.primKey.keyPath||"")||i.primKey.auto!==l.primKey.auto&&!xn)s.recreate=!0,t.change.push(s);else{const a=i.idxByName,o=l.idxByName;let u;for(u in a)o[u]||s.del.push(u);for(u in o){const c=a[u],h=o[u];c?c.src!==h.src&&s.change.push(h):s.add.push(h)}(s.del.length>0||s.add.length>0||s.change.length>0)&&t.change.push(s)}}else t.add.push([n,l])}return t}function Dn(r,e,t,n){const i=r.db.createObjectStore(e,t.keyPath?{keyPath:t.keyPath,autoIncrement:t.auto}:{autoIncrement:t.auto});return n.forEach(l=>er(i,l)),i}function er(r,e){r.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function tr(r,e,t){const n={};return un(e.objectStoreNames,0).forEach(i=>{const l=t.objectStore(i);let s=l.keyPath;const a=Zn(hs(s),s||"",!1,!1,!!l.autoIncrement,s&&typeof s!="string",!0),o=[];for(let c=0;c<l.indexNames.length;++c){const h=l.index(l.indexNames[c]);s=h.keyPath;var u=Zn(h.name,s,!!h.unique,!!h.multiEntry,!1,s&&typeof s!="string",!1);o.push(u)}n[i]=ds(i,a,o)}),n}function nr({_novip:r},e,t){const n=t.db.objectStoreNames;for(let i=0;i<n.length;++i){const l=n[i],s=t.objectStore(l);r._hasGetAll="getAll"in s;for(let a=0;a<s.indexNames.length;++a){const o=s.indexNames[a],u=s.index(o).keyPath,c=typeof u=="string"?u:"["+un(u).join("+")+"]";if(e[l]){const h=e[l].idxByName[c];h&&(h.name=o,delete e[l].idxByName[c],e[l].idxByName[o]=h)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&ie.WorkerGlobalScope&&ie instanceof ie.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}class Al{_parseStoresSpec(e,t){ae(e).forEach(n=>{if(e[n]!==null){var i=e[n].split(",").map((s,a)=>{const o=(s=s.trim()).replace(/([&*]|\+\+)/g,""),u=/^\[/.test(o)?o.match(/^\[(.*)\]$/)[1].split("+"):o;return Zn(o,u||null,/\&/.test(s),/\*/.test(s),/\+\+/.test(s),ye(u),a===0)}),l=i.shift();if(l.multi)throw new N.Schema("Primary key cannot be multi-valued");i.forEach(s=>{if(s.auto)throw new N.Schema("Only primary key can be marked as autoIncrement (++)");if(!s.keyPath)throw new N.Schema("Index must have a name and cannot be an empty string")}),t[n]=ds(n,l,i)}})}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?ve(this._cfg.storesSource,e):e;const n=t._versions,i={};let l={};return n.forEach(s=>{ve(i,s._cfg.storesSource),l=s._cfg.dbschema={},s._parseStoresSpec(i,l)}),t._dbSchema=l,Xn(t,[t._allTables,t,t.Transaction.prototype]),gn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],ae(l),l),t._storeNames=ae(l),this}upgrade(e){return this._cfg.contentUpgrade=dr(this._cfg.contentUpgrade||ee,e),this}}function br(r,e){let t=r._dbNamesDB;return t||(t=r._dbNamesDB=new et(En,{addons:[],indexedDB:r,IDBKeyRange:e}),t.version(1).stores({dbnames:"name"})),t.table("dbnames")}function yr(r){return r&&typeof r.databases=="function"}function rr(r){return Ve(function(){return F.letThrough=!0,r()})}function $l(){var r;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var t=function(){return indexedDB.databases().finally(e)};r=setInterval(t,100),t()}).finally(function(){return clearInterval(r)}):Promise.resolve()}function Pl(r){const e=r._state,{indexedDB:t}=r._deps;if(e.isBeingOpened||r.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?ce(e.dbOpenError):r);Re&&(e.openCanceller._stackHolder=st()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const n=e.openCanceller;function i(){if(e.openCanceller!==n)throw new N.DatabaseClosed("db.open() was cancelled")}let l=e.dbReadyResolve,s=null,a=!1;const o=()=>new R((u,c)=>{if(i(),!t)throw new N.MissingAPI;const h=r.name,f=e.autoSchema?t.open(h):t.open(h,Math.round(10*r.verno));if(!f)throw new N.MissingAPI;f.onerror=Ae(c),f.onblocked=le(r._fireOnBlocked),f.onupgradeneeded=le(d=>{if(s=f.transaction,e.autoSchema&&!r._options.allowEmptyDB){f.onerror=Ot,s.abort(),f.result.close();const b=t.deleteDatabase(h);b.onsuccess=b.onerror=le(()=>{c(new N.NoSuchDatabase(`Database ${h} doesnt exist`))})}else{s.onerror=Ae(c);var g=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;a=g<1,r._novip.idbdb=f.result,Tl(r,g/10,s,c)}},c),f.onsuccess=le(()=>{s=null;const d=r._novip.idbdb=f.result,g=un(d.objectStoreNames);if(g.length>0)try{const _=d.transaction((b=g).length===1?b[0]:b,"readonly");e.autoSchema?function({_novip:p},v,k){p.verno=v.version/10;const E=p._dbSchema=tr(0,v,k);p._storeNames=un(v.objectStoreNames,0),gn(p,[p._allTables],ae(E),E)}(r,d,_):(nr(r,r._dbSchema,_),function(p,v){const k=ps(tr(0,p.idbdb,v),p._dbSchema);return!(k.add.length||k.change.some(E=>E.add.length||E.change.length))}(r,_)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Jn(r,_)}catch{}var b;Ct.push(r),d.onversionchange=le(_=>{e.vcFired=!0,r.on("versionchange").fire(_)}),d.onclose=le(_=>{r.on("close").fire(_)}),a&&function({indexedDB:_,IDBKeyRange:p},v){!yr(_)&&v!==En&&br(_,p).put({name:v}).catch(ee)}(r._deps,h),u()},c)}).catch(u=>u&&u.name==="UnknownError"&&e.PR1398_maxLoop>0?(e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),o()):R.reject(u));return R.race([n,(typeof navigator>"u"?R.resolve():$l()).then(o)]).then(()=>(i(),e.onReadyBeingFired=[],R.resolve(rr(()=>r.on.ready.fire(r.vip))).then(function u(){if(e.onReadyBeingFired.length>0){let c=e.onReadyBeingFired.reduce(dr,ee);return e.onReadyBeingFired=[],R.resolve(rr(()=>c(r.vip))).then(u)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>r).catch(u=>{e.dbOpenError=u;try{s&&s.abort()}catch{}return n===e.openCanceller&&r._close(),ce(u)}).finally(()=>{e.openComplete=!0,l()})}function ir(r){var e=l=>r.next(l),t=i(e),n=i(l=>r.throw(l));function i(l){return s=>{var a=l(s),o=a.value;return a.done?o:o&&typeof o.then=="function"?o.then(t,n):ye(o)?Promise.all(o).then(t,n):t(o)}}return i(e)()}function Il(r,e,t){var n=arguments.length;if(n<2)throw new N.InvalidArgument("Too few arguments");for(var i=new Array(n-1);--n;)i[n-1]=arguments[n];return t=i.pop(),[r,Qi(i),t]}function ms(r,e,t,n,i){return R.resolve().then(()=>{const l=F.transless||F,s=r._createTransaction(e,t,r._dbSchema,n),a={trans:s,transless:l};if(n)s.idbtrans=n.idbtrans;else try{s.create(),r._state.PR1398_maxLoop=3}catch(h){return h.name===hr.InvalidState&&r.isOpen()&&--r._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),r._close(),r.open().then(()=>ms(r,e,t,null,i))):ce(h)}const o=ur(i);let u;o&&mt();const c=R.follow(()=>{if(u=i.call(s,s),u)if(o){var h=Le.bind(null,null);u.then(h,h)}else typeof u.next=="function"&&typeof u.throw=="function"&&(u=ir(u))},a);return(u&&typeof u.then=="function"?R.resolve(u).then(h=>s.active?h:ce(new N.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):c.then(()=>u)).then(h=>(n&&s._resolve(),s._completion.then(()=>h))).catch(h=>(s._reject(h),ce(h)))})}function Yt(r,e,t){const n=ye(r)?r.slice():[r];for(let i=0;i<t;++i)n.push(e);return n}const Dl={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(r){return{...r,table(e){const t=r.table(e),{schema:n}=t,i={},l=[];function s(c,h,f){const d=At(c),g=i[d]=i[d]||[],b=c==null?0:typeof c=="string"?1:c.length,_=h>0,p={...f,isVirtual:_,keyTail:h,keyLength:b,extractKey:Yn(c),unique:!_&&f.unique};return g.push(p),p.isPrimaryKey||l.push(p),b>1&&s(b===2?c[0]:c.slice(0,b-1),h+1,f),g.sort((v,k)=>v.keyTail-k.keyTail),p}const a=s(n.primaryKey.keyPath,0,n.primaryKey);i[":id"]=[a];for(const c of n.indexes)s(c.keyPath,0,c);function o(c){const h=c.query.index;return h.isVirtual?{...c,query:{index:h,range:(f=c.query.range,d=h.keyTail,{type:f.type===1?2:f.type,lower:Yt(f.lower,f.lowerOpen?r.MAX_KEY:r.MIN_KEY,d),lowerOpen:!0,upper:Yt(f.upper,f.upperOpen?r.MIN_KEY:r.MAX_KEY,d),upperOpen:!0})}}:c;var f,d}return{...t,schema:{...n,primaryKey:a,indexes:l,getIndexByKeyPath:function(c){const h=i[At(c)];return h&&h[0]}},count:c=>t.count(o(c)),query:c=>t.query(o(c)),openCursor(c){const{keyTail:h,isVirtual:f,keyLength:d}=c.query.index;return f?t.openCursor(o(c)).then(g=>g&&function(b){return Object.create(b,{continue:{value:function(p){p!=null?b.continue(Yt(p,c.reverse?r.MAX_KEY:r.MIN_KEY,h)):c.unique?b.continue(b.key.slice(0,d).concat(c.reverse?r.MIN_KEY:r.MAX_KEY,h)):b.continue()}},continuePrimaryKey:{value(p,v){b.continuePrimaryKey(Yt(p,r.MAX_KEY,h),v)}},primaryKey:{get:()=>b.primaryKey},key:{get(){const p=b.key;return d===1?p[0]:p.slice(0,d)}},value:{get:()=>b.value}})}(g)):t.openCursor(c)}}}}}};function _r(r,e,t,n){return t=t||{},n=n||"",ae(r).forEach(i=>{if(Se(e,i)){var l=r[i],s=e[i];if(typeof l=="object"&&typeof s=="object"&&l&&s){const a=Bn(l);a!==Bn(s)?t[n+i]=e[i]:a==="Object"?_r(l,s,t,n+i+"."):l!==s&&(t[n+i]=e[i])}else l!==s&&(t[n+i]=e[i])}else t[n+i]=void 0}),ae(e).forEach(i=>{Se(r,i)||(t[n+i]=e[i])}),t}const Rl={stack:"dbcore",name:"HooksMiddleware",level:2,create:r=>({...r,table(e){const t=r.table(e),{primaryKey:n}=t.schema;return{...t,mutate(l){const s=F.trans,{deleting:a,creating:o,updating:u}=s.table(e).hook;switch(l.type){case"add":if(o.fire===ee)break;return s._promise("readwrite",()=>c(l),!0);case"put":if(o.fire===ee&&u.fire===ee)break;return s._promise("readwrite",()=>c(l),!0);case"delete":if(a.fire===ee)break;return s._promise("readwrite",()=>c(l),!0);case"deleteRange":if(a.fire===ee)break;return s._promise("readwrite",()=>function(f){return h(f.trans,f.range,1e4)}(l),!0)}return t.mutate(l);function c(f){const d=F.trans,g=f.keys||function(b,_){return _.type==="delete"?_.keys:_.keys||_.values.map(b.extractKey)}(n,f);if(!g)throw new Error("Keys missing");return(f=f.type==="add"||f.type==="put"?{...f,keys:g}:{...f}).type!=="delete"&&(f.values=[...f.values]),f.keys&&(f.keys=[...f.keys]),function(b,_,p){return _.type==="add"?Promise.resolve([]):b.getMany({trans:_.trans,keys:p,cache:"immutable"})}(t,f,g).then(b=>{const _=g.map((p,v)=>{const k=b[v],E={onerror:null,onsuccess:null};if(f.type==="delete")a.fire.call(E,p,k,d);else if(f.type==="add"||k===void 0){const x=o.fire.call(E,p,f.values[v],d);p==null&&x!=null&&(p=x,f.keys[v]=p,n.outbound||Te(f.values[v],n.keyPath,p))}else{const x=_r(k,f.values[v]),T=u.fire.call(E,x,p,k,d);if(T){const C=f.values[v];Object.keys(T).forEach(j=>{Se(C,j)?C[j]=T[j]:Te(C,j,T[j])})}}return E});return t.mutate(f).then(({failures:p,results:v,numFailures:k,lastResult:E})=>{for(let x=0;x<g.length;++x){const T=v?v[x]:g[x],C=_[x];T==null?C.onerror&&C.onerror(p[x]):C.onsuccess&&C.onsuccess(f.type==="put"&&b[x]?f.values[x]:T)}return{failures:p,results:v,numFailures:k,lastResult:E}}).catch(p=>(_.forEach(v=>v.onerror&&v.onerror(p)),Promise.reject(p)))})}function h(f,d,g){return t.query({trans:f,values:!1,query:{index:n,range:d},limit:g}).then(({result:b})=>c({type:"delete",keys:b,trans:f}).then(_=>_.numFailures>0?Promise.reject(_.failures[0]):b.length<g?{failures:[],numFailures:0,lastResult:void 0}:h(f,{...d,lower:b[b.length-1],lowerOpen:!0},g)))}}}}})};function gs(r,e,t){try{if(!e||e.keys.length<r.length)return null;const n=[];for(let i=0,l=0;i<e.keys.length&&l<r.length;++i)_e(e.keys[i],r[l])===0&&(n.push(t?Lt(e.values[i]):e.values[i]),++l);return n.length===r.length?n:null}catch{return null}}const Ol={stack:"dbcore",level:-1,create:r=>({table:e=>{const t=r.table(e);return{...t,getMany:n=>{if(!n.cache)return t.getMany(n);const i=gs(n.keys,n.trans._cache,n.cache==="clone");return i?R.resolve(i):t.getMany(n).then(l=>(n.trans._cache={keys:n.keys,values:n.cache==="clone"?Lt(l):l},l))},mutate:n=>(n.type!=="add"&&(n.trans._cache=null),t.mutate(n))}}})};function vr(r){return!("from"in r)}const Ke=function(r,e){if(!this){const t=new Ke;return r&&"d"in r&&ve(t,r),t}ve(this,arguments.length?{d:1,from:r,to:arguments.length>1?e:r}:{d:0})};function Bt(r,e,t){const n=_e(e,t);if(isNaN(n))return;if(n>0)throw RangeError();if(vr(r))return ve(r,{from:e,to:t,d:1});const i=r.l,l=r.r;if(_e(t,r.from)<0)return i?Bt(i,e,t):r.l={from:e,to:t,d:1,l:null,r:null},Nr(r);if(_e(e,r.to)>0)return l?Bt(l,e,t):r.r={from:e,to:t,d:1,l:null,r:null},Nr(r);_e(e,r.from)<0&&(r.from=e,r.l=null,r.d=l?l.d+1:1),_e(t,r.to)>0&&(r.to=t,r.r=null,r.d=r.l?r.l.d+1:1);const s=!r.r;i&&!r.l&&bn(r,i),l&&s&&bn(r,l)}function bn(r,e){vr(e)||function t(n,{from:i,to:l,l:s,r:a}){Bt(n,i,l),s&&t(n,s),a&&t(n,a)}(r,e)}function Kl(r,e){const t=sr(e);let n=t.next();if(n.done)return!1;let i=n.value;const l=sr(r);let s=l.next(i.from),a=s.value;for(;!n.done&&!s.done;){if(_e(a.from,i.to)<=0&&_e(a.to,i.from)>=0)return!0;_e(i.from,a.from)<0?i=(n=t.next(a.from)).value:a=(s=l.next(i.from)).value}return!1}function sr(r){let e=vr(r)?null:{s:0,n:r};return{next(t){const n=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,n)for(;e.n.l&&_e(t,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!n||_e(t,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Nr(r){var e,t;const n=(((e=r.r)===null||e===void 0?void 0:e.d)||0)-(((t=r.l)===null||t===void 0?void 0:t.d)||0),i=n>1?"r":n<-1?"l":"";if(i){const l=i==="r"?"l":"r",s={...r},a=r[i];r.from=a.from,r.to=a.to,r[i]=a[i],s[i]=a[l],r[l]=s,s.d=Mr(s)}r.d=Mr(r)}function Mr({r,l:e}){return(r?e?Math.max(r.d,e.d):r.d:e?e.d:0)+1}dt(Ke.prototype,{add(r){return bn(this,r),this},addKey(r){return Bt(this,r,r),this},addKeys(r){return r.forEach(e=>Bt(this,e,e)),this},[qn](){return sr(this)}});const jl={stack:"dbcore",level:0,create:r=>{const e=r.schema.name,t=new Ke(r.MIN_KEY,r.MAX_KEY);return{...r,table:n=>{const i=r.table(n),{schema:l}=i,{primaryKey:s}=l,{extractKey:a,outbound:o}=s,u={...i,mutate:f=>{const d=f.trans,g=d.mutatedParts||(d.mutatedParts={}),b=T=>{const C=`idb://${e}/${n}/${T}`;return g[C]||(g[C]=new Ke)},_=b(""),p=b(":dels"),{type:v}=f;let[k,E]=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[[],f.values]:[];const x=f.trans._cache;return i.mutate(f).then(T=>{if(ye(k)){v!=="delete"&&(k=T.results),_.addKeys(k);const C=gs(k,x);C||v==="add"||p.addKeys(k),(C||E)&&function(j,S,B,O){function z(X){const Z=j(X.name||"");function oe(Q){return Q!=null?X.extractKey(Q):null}const se=Q=>X.multiEntry&&ye(Q)?Q.forEach(V=>Z.addKey(V)):Z.addKey(Q);(B||O).forEach((Q,V)=>{const ge=B&&oe(B[V]),we=O&&oe(O[V]);_e(ge,we)!==0&&(ge!=null&&se(ge),we!=null&&se(we))})}S.indexes.forEach(z)}(b,l,C,E)}else if(k){const C={from:k.lower,to:k.upper};p.add(C),_.add(C)}else _.add(t),p.add(t),l.indexes.forEach(C=>b(C.name).add(t));return T})}},c=({query:{index:f,range:d}})=>{var g,b;return[f,new Ke((g=d.lower)!==null&&g!==void 0?g:r.MIN_KEY,(b=d.upper)!==null&&b!==void 0?b:r.MAX_KEY)]},h={get:f=>[s,new Ke(f.key)],getMany:f=>[s,new Ke().addKeys(f.keys)],count:c,query:c,openCursor:c};return ae(h).forEach(f=>{u[f]=function(d){const{subscr:g}=F;if(g){const b=E=>{const x=`idb://${e}/${n}/${E}`;return g[x]||(g[x]=new Ke)},_=b(""),p=b(":dels"),[v,k]=h[f](d);if(b(v.name||"").add(k),!v.isPrimaryKey){if(f!=="count"){const E=f==="query"&&o&&d.values&&i.query({...d,values:!1});return i[f].apply(this,arguments).then(x=>{if(f==="query"){if(o&&d.values)return E.then(({result:C})=>(_.addKeys(C),x));const T=d.values?x.result.map(a):x.result;d.values?_.addKeys(T):p.addKeys(T)}else if(f==="openCursor"){const T=x,C=d.values;return T&&Object.create(T,{key:{get:()=>(p.addKey(T.primaryKey),T.key)},primaryKey:{get(){const j=T.primaryKey;return p.addKey(j),j}},value:{get:()=>(C&&_.addKey(T.primaryKey),T.value)}})}return x})}p.add(t)}}return i[f].apply(this,arguments)}}),u}}}};class et{constructor(e,t){this._middlewares={},this.verno=0;const n=et.dependencies;this._options=t={addons:et.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:i}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const l={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ee,dbReadyPromise:null,cancelOpen:ee,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var s;l.dbReadyPromise=new R(a=>{l.dbReadyResolve=a}),l.openCanceller=new R((a,o)=>{l.cancelOpen=o}),this._state=l,this.name=e,this.on=Tt(this,"populate","blocked","versionchange","close",{ready:[dr,ee]}),this.on.ready.subscribe=Mi(this.on.ready.subscribe,a=>(o,u)=>{et.vip(()=>{const c=this._state;if(c.openComplete)c.dbOpenError||R.resolve().then(o),u&&a(o);else if(c.onReadyBeingFired)c.onReadyBeingFired.push(o),u&&a(o);else{a(o);const h=this;u||a(function f(){h.on.ready.unsubscribe(o),h.on.ready.unsubscribe(f)})}})}),this.Collection=(s=this,yt(_l.prototype,function(a,o){this.db=s;let u=cs,c=null;if(o)try{u=o()}catch(g){c=g}const h=a._ctx,f=h.table,d=f.hook.reading.fire;this._ctx={table:f,index:h.index,isPrimKey:!h.index||f.schema.primKey.keyPath&&h.index===f.schema.primKey.name,range:u,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:c,or:h.or,valueMapper:d!==Dt?d:null}})),this.Table=function(a){return yt(yl.prototype,function(o,u,c){this.db=a,this._tx=c,this.name=o,this.schema=u,this.hook=a._allTables[o]?a._allTables[o].hook:Tt(null,{creating:[ll,ee],reading:[sl,Dt],updating:[al,ee],deleting:[ol,ee]})})}(this),this.Transaction=function(a){return yt(xl.prototype,function(o,u,c,h,f){this.db=a,this.mode=o,this.storeNames=u,this.schema=c,this.chromeTransactionDurability=h,this.idbtrans=null,this.on=Tt(this,"complete","error","abort"),this.parent=f||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new R((d,g)=>{this._resolve=d,this._reject=g}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},d=>{var g=this.active;return this.active=!1,this.on.error.fire(d),this.parent?this.parent._reject(d):g&&this.idbtrans&&this.idbtrans.abort(),ce(d)})})}(this),this.Version=function(a){return yt(Al.prototype,function(o){this.db=a,this._cfg={version:o,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(a){return yt(fs.prototype,function(o,u,c){this.db=a,this._ctx={table:o,index:u===":id"?null:u,or:c};const h=a._deps.indexedDB;if(!h)throw new N.MissingAPI;this._cmp=this._ascending=h.cmp.bind(h),this._descending=(f,d)=>h.cmp(d,f),this._max=(f,d)=>h.cmp(f,d)>0?f:d,this._min=(f,d)=>h.cmp(f,d)<0?f:d,this._IDBKeyRange=a._deps.IDBKeyRange})}(this),this.on("versionchange",a=>{a.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",a=>{!a.newVersion||a.newVersion<a.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${a.oldVersion/10}`)}),this._maxKey=jt(t.IDBKeyRange),this._createTransaction=(a,o,u,c)=>new this.Transaction(a,o,u,this._options.chromeTransactionDurability,c),this._fireOnBlocked=a=>{this.on("blocked").fire(a),Ct.filter(o=>o.name===this.name&&o!==this&&!o._state.vcFired).map(o=>o.on("versionchange").fire(a))},this.use(Dl),this.use(Rl),this.use(jl),this.use(Ol),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(a=>a(this))}version(e){if(isNaN(e)||e<.1)throw new N.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new N.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var n=t.filter(i=>i._cfg.version===e)[0];return n||(n=new this.Version(e),t.push(n),t.sort(Cl),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||F.letThrough||this._vip)?e():new R((t,n)=>{if(this._state.openComplete)return n(new N.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void n(new N.DatabaseClosed);this.open().catch(ee)}this._state.dbReadyPromise.then(t,n)}).then(e)}use({stack:e,create:t,level:n,name:i}){i&&this.unuse({stack:e,name:i});const l=this._middlewares[e]||(this._middlewares[e]=[]);return l.push({stack:e,create:t,level:n??10,name:i}),l.sort((s,a)=>s.level-a.level),this}unuse({stack:e,name:t,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>n?i.create!==n:!!t&&i.name!==t)),this}open(){return Pl(this)}_close(){const e=this._state,t=Ct.indexOf(this);if(t>=0&&Ct.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new R(n=>{e.dbReadyResolve=n}),e.openCanceller=new R((n,i)=>{e.cancelOpen=i})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new N.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new R((n,i)=>{const l=()=>{this.close();var s=this._deps.indexedDB.deleteDatabase(this.name);s.onsuccess=le(()=>{(function({indexedDB:a,IDBKeyRange:o},u){!yr(a)&&u!==En&&br(a,o).delete(u).catch(ee)})(this._deps,this.name),n()}),s.onerror=Ae(i),s.onblocked=this._fireOnBlocked};if(e)throw new N.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(l):l()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return ae(this._allTables).map(e=>this._allTables[e])}transaction(){const e=Il.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,n){let i=F.trans;i&&i.db===this&&e.indexOf("!")===-1||(i=null);const l=e.indexOf("?")!==-1;let s,a;e=e.replace("!","").replace("?","");try{if(a=t.map(u=>{var c=u instanceof this.Table?u.name:u;if(typeof c!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return c}),e=="r"||e===Tn)s=Tn;else{if(e!="rw"&&e!=An)throw new N.InvalidArgument("Invalid transaction mode: "+e);s=An}if(i){if(i.mode===Tn&&s===An){if(!l)throw new N.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&a.forEach(u=>{if(i&&i.storeNames.indexOf(u)===-1){if(!l)throw new N.SubTransaction("Table "+u+" not included in parent transaction.");i=null}}),l&&i&&!i.active&&(i=null)}}catch(u){return i?i._promise(null,(c,h)=>{h(u)}):ce(u)}const o=ms.bind(null,this,s,a,i,n);return i?i._promise(s,o,"lock"):F.trans?gt(F.transless,()=>this._whenReady(o)):this._whenReady(o)}table(e){if(!Se(this._allTables,e))throw new N.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const Bl=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class ql{constructor(e){this._subscribe=e}subscribe(e,t,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:n})}[Bl](){return this}}function bs(r,e){return ae(e).forEach(t=>{bn(r[t]||(r[t]=new Ke),e[t])}),r}function Fl(r){let e,t=!1;const n=new ql(i=>{const l=ur(r);let s=!1,a={},o={};const u={get closed(){return s},unsubscribe:()=>{s=!0,Ge.storagemutated.unsubscribe(d)}};i.start&&i.start(u);let c=!1,h=!1;function f(){return ae(o).some(b=>a[b]&&Kl(a[b],o[b]))}const d=b=>{bs(a,b),f()&&g()},g=()=>{if(c||s)return;a={};const b={},_=function(p){l&&mt();const v=()=>Ve(r,{subscr:p,trans:null}),k=F.trans?gt(F.transless,v):v();return l&&k.then(Le,Le),k}(b);h||(Ge(Kt,d),h=!0),c=!0,Promise.resolve(_).then(p=>{t=!0,e=p,c=!1,s||(f()?g():(a={},o=b,i.next&&i.next(p)))},p=>{c=!1,t=!1,i.error&&i.error(p),u.unsubscribe()})};return g(),u});return n.hasValue=()=>t,n.getValue=()=>e,n}let lr;try{lr={indexedDB:ie.indexedDB||ie.mozIndexedDB||ie.webkitIndexedDB||ie.msIndexedDB,IDBKeyRange:ie.IDBKeyRange||ie.webkitIDBKeyRange}}catch{lr={indexedDB:null,IDBKeyRange:null}}const Ze=et;function on(r){let e=Be;try{Be=!0,Ge.storagemutated.fire(r)}finally{Be=e}}dt(Ze,{...en,delete:r=>new Ze(r,{addons:[]}).delete(),exists:r=>new Ze(r,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(r){try{return function({indexedDB:e,IDBKeyRange:t}){return yr(e)?Promise.resolve(e.databases()).then(n=>n.map(i=>i.name).filter(i=>i!==En)):br(e,t).toCollection().primaryKeys()}(Ze.dependencies).then(r)}catch{return ce(new N.MissingAPI)}},defineClass:()=>function(r){ve(this,r)},ignoreTransaction:r=>F.trans?gt(F.transless,r):r(),vip:rr,async:function(r){return function(){try{var e=ir(r.apply(this,arguments));return e&&typeof e.then=="function"?e:R.resolve(e)}catch(t){return ce(t)}}},spawn:function(r,e,t){try{var n=ir(r.apply(t,e||[]));return n&&typeof n.then=="function"?n:R.resolve(n)}catch(i){return ce(i)}},currentTransaction:{get:()=>F.trans||null},waitFor:function(r,e){const t=R.resolve(typeof r=="function"?Ze.ignoreTransaction(r):r).timeout(e||6e4);return F.trans?F.trans.waitFor(t):t},Promise:R,debug:{get:()=>Re,set:r=>{Wi(r,r==="dexie"?()=>!0:as)}},derive:ut,extend:ve,props:dt,override:Mi,Events:Tt,on:Ge,liveQuery:Fl,extendObservabilitySet:bs,getByKeyPath:Fe,setByKeyPath:Te,delByKeyPath:function(r,e){typeof e=="string"?Te(r,e,void 0):"length"in e&&[].map.call(e,function(t){Te(r,t,void 0)})},shallowClone:Hi,deepClone:Lt,getObjectDiff:_r,cmp:_e,asap:zi,minKey:Gn,addons:[],connections:Ct,errnames:hr,dependencies:lr,semVer:Kr,version:Kr.split(".").map(r=>parseInt(r)).reduce((r,e,t)=>r+e/Math.pow(10,2*t))}),Ze.maxKey=jt(Ze.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Ge(Kt,r=>{if(!Be){let e;xn?(e=document.createEvent("CustomEvent"),e.initCustomEvent(He,!0,!0,r)):e=new CustomEvent(He,{detail:r}),Be=!0,dispatchEvent(e),Be=!1}}),addEventListener(He,({detail:r})=>{Be||on(r)}));let Be=!1;if(typeof BroadcastChannel<"u"){const r=new BroadcastChannel(He);typeof r.unref=="function"&&r.unref(),Ge(Kt,e=>{Be||r.postMessage(e)}),r.onmessage=e=>{e.data&&on(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Ge(Kt,e=>{try{Be||(typeof localStorage<"u"&&localStorage.setItem(He,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(t=>t.postMessage({type:He,changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key===He){const t=JSON.parse(e.newValue);t&&on(t.changedParts)}});const r=self.document&&navigator.serviceWorker;r&&r.addEventListener("message",function({data:e}){e&&e.type===He&&on(e.changedParts)})}R.rejectionMapper=function(r,e){if(!r||r instanceof ft||r instanceof TypeError||r instanceof SyntaxError||!r.name||!Ir[r.name])return r;var t=new Ir[r.name](e||r.message,r);return"stack"in r&&qe(t,"stack",{get:function(){return this.inner.stack}}),t},Wi(Re,as);class Ll extends et{constructor(){super("SocialApplianceDB");Y(this,"entities");this.version(1).stores({entities:"id, slug, type, parentId, [type+parentId], _cachedAt"})}}const $e=new Ll;async function Nl(r){await $e.entities.put({...r,_cachedAt:Date.now()})}async function ys(r){const e=r.map(t=>({...t,_cachedAt:Date.now()}));await $e.entities.bulkPut(e)}async function zr(r){return $e.entities.get(r)}async function Jt(r){return $e.entities.where("slug").equals(r).first()}async function Ml(r){let e=$e.entities.toCollection();return r.type&&r.parentId!==void 0?e=$e.entities.where("[type+parentId]").equals([r.type,r.parentId]):r.type?e=$e.entities.where("type").equals(r.type):r.parentId!==void 0&&(e=$e.entities.where("parentId").equals(r.parentId)),r.offset&&(e=e.offset(r.offset)),r.limit&&(e=e.limit(r.limit)),e.toArray()}async function Rn(r,e){return r._cachedAt?Date.now()-r._cachedAt>e:!0}const zl="modulepreload",Ul=function(r){return"/hook-test/"+r},Ur={},Hl=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));i=Promise.allSettled(t.map(o=>{if(o=Ul(o),o in Ur)return;Ur[o]=!0;const u=o.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${c}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":zl,u||(h.as="script"),h.crossOrigin="",h.href=o,a&&h.setAttribute("nonce",a),document.head.appendChild(h),u)return new Promise((f,d)=>{h.addEventListener("load",f),h.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${o}`)))})}))}function l(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return i.then(s=>{for(const a of s||[])a.status==="rejected"&&l(a.reason);return e().catch(l)})};async function Ql(){const e=_t(vt).staticDataFiles||["/static.info.js"],t=[];console.log(`DataLoader: Loading static data from ${e.length} files`);for(const n of e)try{console.log(`DataLoader: Loading ${n}...`);const i=Date.now(),l=await Hl(()=>import(`${n}?t=${i}`),[]);console.log("DataLoader: Module loaded:",l),l.default&&(Array.isArray(l.default)?t.push(...l.default):l.default.id&&t.push(l.default));for(const[s,a]of Object.entries(l))s!=="default"&&(Array.isArray(a)?t.push(...a):a&&typeof a=="object"&&a.id&&t.push(a));console.log(`DataLoader: Found ${t.length} entities so far`)}catch(i){console.error(`DataLoader: Failed to load ${n}:`,i)}t.length>0?(console.log(`DataLoader: Total entities loaded: ${t.length}`),await ys(t),console.log("DataLoader: All entities cached successfully")):console.log("DataLoader: No entities found in any static data files")}class Vl{constructor(){Y(this,"serverlessData",null);Y(this,"staticDataLoaded",!1);Y(this,"serverAvailable",null);this.init()}async init(){const e=_t(vt);if(e.flushCacheOnStartup){console.log("ApiClient: Flushing cache on startup...");try{await $e.delete(),await $e.open(),console.log("ApiClient: Cache flushed successfully")}catch(t){console.error("ApiClient: Failed to flush cache:",t)}}if(!this.staticDataLoaded){console.log("ApiClient: Loading static data...");try{await Ql(),this.staticDataLoaded=!0,console.log("ApiClient: Static data loaded successfully")}catch(t){console.error("ApiClient: Failed to load static data:",t)}}e.serverRetryInterval&&e.serverRetryInterval>0&&setInterval(()=>{this.serverAvailable===!1&&this.checkServerAvailability()},e.serverRetryInterval)}async checkServerAvailability(){const e=_t(vt);try{(await fetch(`${e.baseUrl}/health`,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok&&(this.serverAvailable=!0,console.log("ApiClient: Server is now available"))}catch{}}async loadServerlessData(){return console.log("ApiClient: Serverless mode - using cached/static data only"),[]}async request(e,t={}){const n=_t(vt);if(this.serverAvailable===!1||n.serverless)return this.handleServerlessRequest(e,t);if(n.enableCache&&t.method==="GET"){const l=await this.checkCache(e,n.cacheDuration);if(l)return console.log(`Cache hit for ${e}`),l}const i=`${n.baseUrl}${e}`;try{const l=await fetch(i,{...t,headers:{"Content-Type":"application/json",...t.headers}});if(this.serverAvailable!==!0&&(this.serverAvailable=!0,console.log("ApiClient: Server is available")),!l.ok){let a=`HTTP ${l.status}`;try{a=(await l.json()).error||a}catch{a=l.statusText||a}const o=new Error(a);throw o.status=l.status,o}const s=await l.json();if(s==null){const a=new Error("Entity not found");throw a.status=404,a}return n.enableCache&&t.method==="GET"&&await this.cacheResponse(e,s),s}catch(l){if(l.message==="Failed to fetch"||l.code==="ECONNREFUSED")return this.serverAvailable!==!1&&(this.serverAvailable=!1,console.log("ApiClient: Server is unreachable, switching to serverless mode permanently")),this.handleServerlessRequest(e,t);if(l.status===500||l.status===404)return console.log(`ApiClient: Server error (${l.status}), falling back to cached/static data for this request`),this.handleServerlessRequest(e,t);throw l}}async checkCache(e,t){if(e==="/entities/slug"){const n=await Jt("/");if(n&&!await Rn(n,t))return n}else if(e.startsWith("/entities/slug/")){const n="/"+e.substring(15),i=await Jt(n);if(i&&!await Rn(i,t))return i}else if(e.match(/^\/entities\/[^\/\?]+$/)){const n=e.substring(10),i=await zr(n);if(i&&!await Rn(i,t))return i}else if(e.startsWith("/entities?"))return null;return null}async cacheResponse(e,t){Array.isArray(t)?await ys(t):t&&t.id&&await Nl(t)}async handleServerlessRequest(e,t={}){const n=t.method||"GET";if(console.log("ApiClient: Handling serverless request:",e),_t(vt),n==="GET"){if(e==="/entities/slug"){console.log("ApiClient: Looking for root entity in cache");const l=await Jt("/");if(l)return console.log("ApiClient: Found root entity in cache:",l),l;console.log("ApiClient: Root entity not found in cache")}else if(e.startsWith("/entities/slug/")){const l="/"+e.substring(15),s=await Jt(l);if(s)return s}else if(e.match(/^\/entities\/[^\/\?]+$/)){const l=e.substring(10),s=await zr(l);if(s)return s}else if(e.startsWith("/entities?")){const l=new URLSearchParams(e.split("?")[1]),s={};l.get("type")&&(s.type=l.get("type")),l.get("parentId")&&(s.parentId=l.get("parentId")),s.limit=parseInt(l.get("limit")||"20"),s.offset=parseInt(l.get("offset")||"0");const a=await Ml(s);if(a.length>0)return a}}const i=await this.loadServerlessData();if(n==="GET"){if(e==="/entities/slug")return i.find(l=>l.slug==="/")||null;if(e.startsWith("/entities/slug/")){const l="/"+e.substring(15);return i.find(s=>s.slug===l)||null}else if(e.startsWith("/entities?")){const l=new URLSearchParams(e.split("?")[1]);return this.queryServerlessEntities(i,l)}else if(e.match(/^\/entities\/[^\/]+$/)){const l=e.substring(10);return i.find(s=>s.id===l)||null}}throw["POST","PUT","DELETE"].includes(n)?new Error("Mutations not supported in serverless mode"):new Error(`Unsupported serverless operation: ${n} ${e}`)}queryServerlessEntities(e,t){let n=[...e];const i=t.get("type");i&&(n=n.filter(u=>u.type===i));const l=t.get("parentId");l!==null&&(n=n.filter(u=>u.parentId===l));const s=t.get("slugPrefix");s&&(n=n.filter(u=>{var c;return(c=u.slug)==null?void 0:c.startsWith(s)}));const a=parseInt(t.get("limit")||"20"),o=parseInt(t.get("offset")||"0");return n.slice(o,o+a)}}const _s=new Vl,Ce={async request(r,e={}){return _s.request(r,e)},async createPost(r){return this.request("/posts",{method:"POST",body:JSON.stringify(r)})},async createGroup(r){return this.request("/groups",{method:"POST",body:JSON.stringify(r)})},async createUser(r){return this.request("/users",{method:"POST",body:JSON.stringify(r)})},async getEntityBySlug(r){try{if(r==="/")return await this.request("/entities/slug");const n=`/entities/slug/${r.split("/").filter(l=>l).map(l=>encodeURIComponent(l)).join("/")}`;return await this.request(n)}catch(e){throw console.error(`Failed to get entity by slug "${r}":`,e),e}},async queryEntities(r){const e=new URLSearchParams;return Object.entries(r).forEach(([t,n])=>{n!=null&&e.append(t,n)}),this.request(`/entities?${e}`)},async updateEntity(r,e){return this.request(`/entities/${r}`,{method:"PUT",body:JSON.stringify(e)})},async deleteEntity(r){return this.request(`/entities/${r}`,{method:"DELETE"})}};function wr(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let lt=wr();function vs(r){lt=r}const ws=/[&<>"']/,Wl=new RegExp(ws.source,"g"),ks=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,Gl=new RegExp(ks.source,"g"),Zl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Hr=r=>Zl[r];function Ee(r,e){if(e){if(ws.test(r))return r.replace(Wl,Hr)}else if(ks.test(r))return r.replace(Gl,Hr);return r}const Yl=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function Jl(r){return r.replace(Yl,(e,t)=>(t=t.toLowerCase(),t==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""))}const Xl=/(^|[^\[])\^/g;function G(r,e){r=typeof r=="string"?r:r.source,e=e||"";const t={replace:(n,i)=>(i=typeof i=="object"&&"source"in i?i.source:i,i=i.replace(Xl,"$1"),r=r.replace(n,i),t),getRegex:()=>new RegExp(r,e)};return t}function Qr(r){try{r=encodeURI(r).replace(/%25/g,"%")}catch{return null}return r}const yn={exec:()=>null};function Vr(r,e){const t=r.replace(/\|/g,(l,s,a)=>{let o=!1,u=s;for(;--u>=0&&a[u]==="\\";)o=!o;return o?"|":" |"}),n=t.split(/ \|/);let i=0;if(n[0].trim()||n.shift(),n.length>0&&!n[n.length-1].trim()&&n.pop(),e)if(n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;i<n.length;i++)n[i]=n[i].trim().replace(/\\\|/g,"|");return n}function Xt(r,e,t){const n=r.length;if(n===0)return"";let i=0;for(;i<n&&r.charAt(n-i-1)===e;)i++;return r.slice(0,n-i)}function eo(r,e){if(r.indexOf(e[1])===-1)return-1;let t=0;for(let n=0;n<r.length;n++)if(r[n]==="\\")n++;else if(r[n]===e[0])t++;else if(r[n]===e[1]&&(t--,t<0))return n;return-1}function Wr(r,e,t,n){const i=e.href,l=e.title?Ee(e.title):null,s=r[1].replace(/\\([\[\]])/g,"$1");if(r[0].charAt(0)!=="!"){n.state.inLink=!0;const a={type:"link",raw:t,href:i,title:l,text:s,tokens:n.inlineTokens(s)};return n.state.inLink=!1,a}return{type:"image",raw:t,href:i,title:l,text:Ee(s)}}function to(r,e){const t=r.match(/^(\s+)(?:```)/);if(t===null)return e;const n=t[1];return e.split(`
`).map(i=>{const l=i.match(/^\s+/);if(l===null)return i;const[s]=l;return s.length>=n.length?i.slice(n.length):i}).join(`
`)}class _n{constructor(e){Y(this,"options");Y(this,"rules");Y(this,"lexer");this.options=e||lt}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const n=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:Xt(n,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const n=t[0],i=to(n,t[3]||"");return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline._escapes,"$1"):t[2],text:i}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(/#$/.test(n)){const i=Xt(n,"#");(this.options.pedantic||!i||/ $/.test(i))&&(n=i.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){const n=Xt(t[0].replace(/^ *>[ \t]?/gm,""),`
`),i=this.lexer.state.top;this.lexer.state.top=!0;const l=this.lexer.blockTokens(n);return this.lexer.state.top=i,{type:"blockquote",raw:t[0],tokens:l,text:n}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim();const i=n.length>1,l={type:"list",raw:"",ordered:i,start:i?+n.slice(0,-1):"",loose:!1,items:[]};n=i?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=i?n:"[*+-]");const s=new RegExp(`^( {0,3}${n})((?:[	 ][^\\n]*)?(?:\\n|$))`);let a="",o="",u=!1;for(;e;){let c=!1;if(!(t=s.exec(e))||this.rules.block.hr.test(e))break;a=t[0],e=e.substring(a.length);let h=t[2].split(`
`,1)[0].replace(/^\t+/,p=>" ".repeat(3*p.length)),f=e.split(`
`,1)[0],d=0;this.options.pedantic?(d=2,o=h.trimStart()):(d=t[2].search(/[^ ]/),d=d>4?1:d,o=h.slice(d),d+=t[1].length);let g=!1;if(!h&&/^ *$/.test(f)&&(a+=f+`
`,e=e.substring(f.length+1),c=!0),!c){const p=new RegExp(`^ {0,${Math.min(3,d-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),v=new RegExp(`^ {0,${Math.min(3,d-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),k=new RegExp(`^ {0,${Math.min(3,d-1)}}(?:\`\`\`|~~~)`),E=new RegExp(`^ {0,${Math.min(3,d-1)}}#`);for(;e;){const x=e.split(`
`,1)[0];if(f=x,this.options.pedantic&&(f=f.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),k.test(f)||E.test(f)||p.test(f)||v.test(e))break;if(f.search(/[^ ]/)>=d||!f.trim())o+=`
`+f.slice(d);else{if(g||h.search(/[^ ]/)>=4||k.test(h)||E.test(h)||v.test(h))break;o+=`
`+f}!g&&!f.trim()&&(g=!0),a+=x+`
`,e=e.substring(x.length+1),h=f.slice(d)}}l.loose||(u?l.loose=!0:/\n *\n *$/.test(a)&&(u=!0));let b=null,_;this.options.gfm&&(b=/^\[[ xX]\] /.exec(o),b&&(_=b[0]!=="[ ] ",o=o.replace(/^\[[ xX]\] +/,""))),l.items.push({type:"list_item",raw:a,task:!!b,checked:_,loose:!1,text:o,tokens:[]}),l.raw+=a}l.items[l.items.length-1].raw=a.trimEnd(),l.items[l.items.length-1].text=o.trimEnd(),l.raw=l.raw.trimEnd();for(let c=0;c<l.items.length;c++)if(this.lexer.state.top=!1,l.items[c].tokens=this.lexer.blockTokens(l.items[c].text,[]),!l.loose){const h=l.items[c].tokens.filter(d=>d.type==="space"),f=h.length>0&&h.some(d=>/\n.*\n/.test(d.raw));l.loose=f}if(l.loose)for(let c=0;c<l.items.length;c++)l.items[c].loose=!0;return l}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const n=t[1].toLowerCase().replace(/\s+/g," "),i=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",l=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline._escapes,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:i,title:l}}}table(e){const t=this.rules.block.table.exec(e);if(t){if(!/[:|]/.test(t[2]))return;const n={type:"table",raw:t[0],header:Vr(t[1]).map(i=>({text:i,tokens:[]})),align:t[2].replace(/^\||\| *$/g,"").split("|"),rows:t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(n.header.length===n.align.length){let i=n.align.length,l,s,a,o;for(l=0;l<i;l++){const u=n.align[l];u&&(/^ *-+: *$/.test(u)?n.align[l]="right":/^ *:-+: *$/.test(u)?n.align[l]="center":/^ *:-+ *$/.test(u)?n.align[l]="left":n.align[l]=null)}for(i=n.rows.length,l=0;l<i;l++)n.rows[l]=Vr(n.rows[l],n.header.length).map(u=>({text:u,tokens:[]}));for(i=n.header.length,s=0;s<i;s++)n.header[s].tokens=this.lexer.inline(n.header[s].text);for(i=n.rows.length,s=0;s<i;s++)for(o=n.rows[s],a=0;a<o.length;a++)o[a].tokens=this.lexer.inline(o[a].text);return n}}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:Ee(t[1])}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const n=t[2].trim();if(!this.options.pedantic&&/^</.test(n)){if(!/>$/.test(n))return;const s=Xt(n.slice(0,-1),"\\");if((n.length-s.length)%2===0)return}else{const s=eo(t[2],"()");if(s>-1){const o=(t[0].indexOf("!")===0?5:4)+t[1].length+s;t[2]=t[2].substring(0,s),t[0]=t[0].substring(0,o).trim(),t[3]=""}}let i=t[2],l="";if(this.options.pedantic){const s=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(i);s&&(i=s[1],l=s[3])}else l=t[3]?t[3].slice(1,-1):"";return i=i.trim(),/^</.test(i)&&(this.options.pedantic&&!/>$/.test(n)?i=i.slice(1):i=i.slice(1,-1)),Wr(t,{href:i&&i.replace(this.rules.inline._escapes,"$1"),title:l&&l.replace(this.rules.inline._escapes,"$1")},t[0],this.lexer)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){let i=(n[2]||n[1]).replace(/\s+/g," ");if(i=t[i.toLowerCase()],!i){const l=n[0].charAt(0);return{type:"text",raw:l,text:l}}return Wr(n,i,n[0],this.lexer)}}emStrong(e,t,n=""){let i=this.rules.inline.emStrong.lDelim.exec(e);if(!i||i[3]&&n.match(/[\p{L}\p{N}]/u))return;if(!(i[1]||i[2]||"")||!n||this.rules.inline.punctuation.exec(n)){const s=[...i[0]].length-1;let a,o,u=s,c=0;const h=i[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(h.lastIndex=0,t=t.slice(-1*e.length+s);(i=h.exec(t))!=null;){if(a=i[1]||i[2]||i[3]||i[4]||i[5]||i[6],!a)continue;if(o=[...a].length,i[3]||i[4]){u+=o;continue}else if((i[5]||i[6])&&s%3&&!((s+o)%3)){c+=o;continue}if(u-=o,u>0)continue;o=Math.min(o,o+u+c);const f=[...i[0]][0].length,d=e.slice(0,s+i.index+f+o);if(Math.min(s,o)%2){const b=d.slice(1,-1);return{type:"em",raw:d,text:b,tokens:this.lexer.inlineTokens(b)}}const g=d.slice(2,-2);return{type:"strong",raw:d,text:g,tokens:this.lexer.inlineTokens(g)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(/\n/g," ");const i=/[^ ]/.test(n),l=/^ /.test(n)&&/ $/.test(n);return i&&l&&(n=n.substring(1,n.length-1)),n=Ee(n,!0),{type:"codespan",raw:t[0],text:n}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let n,i;return t[2]==="@"?(n=Ee(t[1]),i="mailto:"+n):(n=Ee(t[1]),i=n),{type:"link",raw:t[0],text:n,href:i,tokens:[{type:"text",raw:n,text:n}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let n,i;if(t[2]==="@")n=Ee(t[0]),i="mailto:"+n;else{let l;do l=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])[0];while(l!==t[0]);n=Ee(t[0]),t[1]==="www."?i="http://"+t[0]:i=t[0]}return{type:"link",raw:t[0],text:n,href:i,tokens:[{type:"text",raw:n,text:n}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){let n;return this.lexer.state.inRawBlock?n=t[0]:n=Ee(t[0]),{type:"text",raw:t[0],text:n}}}}const q={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:yn,lheading:/^(?!bull )((?:.|\n(?!\s*?\n|bull ))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};q._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;q._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;q.def=G(q.def).replace("label",q._label).replace("title",q._title).getRegex();q.bullet=/(?:[*+-]|\d{1,9}[.)])/;q.listItemStart=G(/^( *)(bull) */).replace("bull",q.bullet).getRegex();q.list=G(q.list).replace(/bull/g,q.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+q.def.source+")").getRegex();q._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";q._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;q.html=G(q.html,"i").replace("comment",q._comment).replace("tag",q._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();q.lheading=G(q.lheading).replace(/bull/g,q.bullet).getRegex();q.paragraph=G(q._paragraph).replace("hr",q.hr).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",q._tag).getRegex();q.blockquote=G(q.blockquote).replace("paragraph",q.paragraph).getRegex();q.normal={...q};q.gfm={...q.normal,table:"^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"};q.gfm.table=G(q.gfm.table).replace("hr",q.hr).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",q._tag).getRegex();q.gfm.paragraph=G(q._paragraph).replace("hr",q.hr).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",q.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",q._tag).getRegex();q.pedantic={...q.normal,html:G(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",q._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:yn,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:G(q.normal._paragraph).replace("hr",q.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",q.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()};const D={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:yn,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,rDelimAst:/^[^_*]*?__[^_*]*?\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\*)[punct](\*+)(?=[\s]|$)|[^punct\s](\*+)(?!\*)(?=[punct\s]|$)|(?!\*)[punct\s](\*+)(?=[^punct\s])|[\s](\*+)(?!\*)(?=[punct])|(?!\*)[punct](\*+)(?!\*)(?=[punct])|[^punct\s](\*+)(?=[^punct\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?_[^_*]*?(?=\*\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\s]|$)|[^punct\s](_+)(?!_)(?=[punct\s]|$)|(?!_)[punct\s](_+)(?=[^punct\s])|[\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:yn,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^((?![*_])[\spunctuation])/};D._punctuation="\\p{P}$+<=>`^|~";D.punctuation=G(D.punctuation,"u").replace(/punctuation/g,D._punctuation).getRegex();D.blockSkip=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g;D.anyPunctuation=/\\[punct]/g;D._escapes=/\\([punct])/g;D._comment=G(q._comment).replace("(?:-->|$)","-->").getRegex();D.emStrong.lDelim=G(D.emStrong.lDelim,"u").replace(/punct/g,D._punctuation).getRegex();D.emStrong.rDelimAst=G(D.emStrong.rDelimAst,"gu").replace(/punct/g,D._punctuation).getRegex();D.emStrong.rDelimUnd=G(D.emStrong.rDelimUnd,"gu").replace(/punct/g,D._punctuation).getRegex();D.anyPunctuation=G(D.anyPunctuation,"gu").replace(/punct/g,D._punctuation).getRegex();D._escapes=G(D._escapes,"gu").replace(/punct/g,D._punctuation).getRegex();D._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;D._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;D.autolink=G(D.autolink).replace("scheme",D._scheme).replace("email",D._email).getRegex();D._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;D.tag=G(D.tag).replace("comment",D._comment).replace("attribute",D._attribute).getRegex();D._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;D._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;D._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;D.link=G(D.link).replace("label",D._label).replace("href",D._href).replace("title",D._title).getRegex();D.reflink=G(D.reflink).replace("label",D._label).replace("ref",q._label).getRegex();D.nolink=G(D.nolink).replace("ref",q._label).getRegex();D.reflinkSearch=G(D.reflinkSearch,"g").replace("reflink",D.reflink).replace("nolink",D.nolink).getRegex();D.normal={...D};D.pedantic={...D.normal,strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:G(/^!?\[(label)\]\((.*?)\)/).replace("label",D._label).getRegex(),reflink:G(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",D._label).getRegex()};D.gfm={...D.normal,escape:G(D.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/};D.gfm.url=G(D.gfm.url,"i").replace("email",D.gfm._extended_email).getRegex();D.breaks={...D.gfm,br:G(D.br).replace("{2,}","*").getRegex(),text:G(D.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()};class Pe{constructor(e){Y(this,"tokens");Y(this,"options");Y(this,"state");Y(this,"tokenizer");Y(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||lt,this.options.tokenizer=this.options.tokenizer||new _n,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:q.normal,inline:D.normal};this.options.pedantic?(t.block=q.pedantic,t.inline=D.pedantic):this.options.gfm&&(t.block=q.gfm,this.options.breaks?t.inline=D.breaks:t.inline=D.gfm),this.tokenizer.rules=t}static get rules(){return{block:q,inline:D}}static lex(e,t){return new Pe(t).lex(e)}static lexInline(e,t){return new Pe(t).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);let t;for(;t=this.inlineQueue.shift();)this.inlineTokens(t.src,t.tokens);return this.tokens}blockTokens(e,t=[]){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(a,o,u)=>o+"    ".repeat(u.length));let n,i,l,s;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(a=>(n=a.call({lexer:this},e,t))?(e=e.substring(n.raw.length),t.push(n),!0):!1))){if(n=this.tokenizer.space(e)){e=e.substring(n.raw.length),n.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(n);continue}if(n=this.tokenizer.code(e)){e=e.substring(n.raw.length),i=t[t.length-1],i&&(i.type==="paragraph"||i.type==="text")?(i.raw+=`
`+n.raw,i.text+=`
`+n.text,this.inlineQueue[this.inlineQueue.length-1].src=i.text):t.push(n);continue}if(n=this.tokenizer.fences(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.heading(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.hr(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.blockquote(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.list(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.html(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.def(e)){e=e.substring(n.raw.length),i=t[t.length-1],i&&(i.type==="paragraph"||i.type==="text")?(i.raw+=`
`+n.raw,i.text+=`
`+n.raw,this.inlineQueue[this.inlineQueue.length-1].src=i.text):this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title});continue}if(n=this.tokenizer.table(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.lheading(e)){e=e.substring(n.raw.length),t.push(n);continue}if(l=e,this.options.extensions&&this.options.extensions.startBlock){let a=1/0;const o=e.slice(1);let u;this.options.extensions.startBlock.forEach(c=>{u=c.call({lexer:this},o),typeof u=="number"&&u>=0&&(a=Math.min(a,u))}),a<1/0&&a>=0&&(l=e.substring(0,a+1))}if(this.state.top&&(n=this.tokenizer.paragraph(l))){i=t[t.length-1],s&&i.type==="paragraph"?(i.raw+=`
`+n.raw,i.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=i.text):t.push(n),s=l.length!==e.length,e=e.substring(n.raw.length);continue}if(n=this.tokenizer.text(e)){e=e.substring(n.raw.length),i=t[t.length-1],i&&i.type==="text"?(i.raw+=`
`+n.raw,i.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=i.text):t.push(n);continue}if(e){const a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let n,i,l,s=e,a,o,u;if(this.tokens.links){const c=Object.keys(this.tokens.links);if(c.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(s))!=null;)c.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(s=s.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+s.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.blockSkip.exec(s))!=null;)s=s.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+s.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(s))!=null;)s=s.slice(0,a.index)+"++"+s.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(o||(u=""),o=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(c=>(n=c.call({lexer:this},e,t))?(e=e.substring(n.raw.length),t.push(n),!0):!1))){if(n=this.tokenizer.escape(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.tag(e)){e=e.substring(n.raw.length),i=t[t.length-1],i&&n.type==="text"&&i.type==="text"?(i.raw+=n.raw,i.text+=n.text):t.push(n);continue}if(n=this.tokenizer.link(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(n.raw.length),i=t[t.length-1],i&&n.type==="text"&&i.type==="text"?(i.raw+=n.raw,i.text+=n.text):t.push(n);continue}if(n=this.tokenizer.emStrong(e,s,u)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.codespan(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.br(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.del(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.autolink(e)){e=e.substring(n.raw.length),t.push(n);continue}if(!this.state.inLink&&(n=this.tokenizer.url(e))){e=e.substring(n.raw.length),t.push(n);continue}if(l=e,this.options.extensions&&this.options.extensions.startInline){let c=1/0;const h=e.slice(1);let f;this.options.extensions.startInline.forEach(d=>{f=d.call({lexer:this},h),typeof f=="number"&&f>=0&&(c=Math.min(c,f))}),c<1/0&&c>=0&&(l=e.substring(0,c+1))}if(n=this.tokenizer.inlineText(l)){e=e.substring(n.raw.length),n.raw.slice(-1)!=="_"&&(u=n.raw.slice(-1)),o=!0,i=t[t.length-1],i&&i.type==="text"?(i.raw+=n.raw,i.text+=n.text):t.push(n);continue}if(e){const c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return t}}class vn{constructor(e){Y(this,"options");this.options=e||lt}code(e,t,n){var l;const i=(l=(t||"").match(/^\S*/))==null?void 0:l[0];return e=e.replace(/\n$/,"")+`
`,i?'<pre><code class="language-'+Ee(i)+'">'+(n?e:Ee(e,!0))+`</code></pre>
`:"<pre><code>"+(n?e:Ee(e,!0))+`</code></pre>
`}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e,t){return e}heading(e,t,n){return`<h${t}>${e}</h${t}>
`}hr(){return`<hr>
`}list(e,t,n){const i=t?"ol":"ul",l=t&&n!==1?' start="'+n+'"':"";return"<"+i+l+`>
`+e+"</"+i+`>
`}listitem(e,t,n){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(e){return`<p>${e}</p>
`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+t+`</table>
`}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,t){const n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return"<br>"}del(e){return`<del>${e}</del>`}link(e,t,n){const i=Qr(e);if(i===null)return n;e=i;let l='<a href="'+e+'"';return t&&(l+=' title="'+t+'"'),l+=">"+n+"</a>",l}image(e,t,n){const i=Qr(e);if(i===null)return n;e=i;let l=`<img src="${e}" alt="${n}"`;return t&&(l+=` title="${t}"`),l+=">",l}text(e){return e}}class kr{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,n){return""+n}image(e,t,n){return""+n}br(){return""}}class Ie{constructor(e){Y(this,"options");Y(this,"renderer");Y(this,"textRenderer");this.options=e||lt,this.options.renderer=this.options.renderer||new vn,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new kr}static parse(e,t){return new Ie(t).parse(e)}static parseInline(e,t){return new Ie(t).parseInline(e)}parse(e,t=!0){let n="";for(let i=0;i<e.length;i++){const l=e[i];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[l.type]){const s=l,a=this.options.extensions.renderers[s.type].call({parser:this},s);if(a!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(s.type)){n+=a||"";continue}}switch(l.type){case"space":continue;case"hr":{n+=this.renderer.hr();continue}case"heading":{const s=l;n+=this.renderer.heading(this.parseInline(s.tokens),s.depth,Jl(this.parseInline(s.tokens,this.textRenderer)));continue}case"code":{const s=l;n+=this.renderer.code(s.text,s.lang,!!s.escaped);continue}case"table":{const s=l;let a="",o="";for(let c=0;c<s.header.length;c++)o+=this.renderer.tablecell(this.parseInline(s.header[c].tokens),{header:!0,align:s.align[c]});a+=this.renderer.tablerow(o);let u="";for(let c=0;c<s.rows.length;c++){const h=s.rows[c];o="";for(let f=0;f<h.length;f++)o+=this.renderer.tablecell(this.parseInline(h[f].tokens),{header:!1,align:s.align[f]});u+=this.renderer.tablerow(o)}n+=this.renderer.table(a,u);continue}case"blockquote":{const s=l,a=this.parse(s.tokens);n+=this.renderer.blockquote(a);continue}case"list":{const s=l,a=s.ordered,o=s.start,u=s.loose;let c="";for(let h=0;h<s.items.length;h++){const f=s.items[h],d=f.checked,g=f.task;let b="";if(f.task){const _=this.renderer.checkbox(!!d);u?f.tokens.length>0&&f.tokens[0].type==="paragraph"?(f.tokens[0].text=_+" "+f.tokens[0].text,f.tokens[0].tokens&&f.tokens[0].tokens.length>0&&f.tokens[0].tokens[0].type==="text"&&(f.tokens[0].tokens[0].text=_+" "+f.tokens[0].tokens[0].text)):f.tokens.unshift({type:"text",text:_+" "}):b+=_+" "}b+=this.parse(f.tokens,u),c+=this.renderer.listitem(b,g,!!d)}n+=this.renderer.list(c,a,o);continue}case"html":{const s=l;n+=this.renderer.html(s.text,s.block);continue}case"paragraph":{const s=l;n+=this.renderer.paragraph(this.parseInline(s.tokens));continue}case"text":{let s=l,a=s.tokens?this.parseInline(s.tokens):s.text;for(;i+1<e.length&&e[i+1].type==="text";)s=e[++i],a+=`
`+(s.tokens?this.parseInline(s.tokens):s.text);n+=t?this.renderer.paragraph(a):a;continue}default:{const s='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(s),"";throw new Error(s)}}}return n}parseInline(e,t){t=t||this.renderer;let n="";for(let i=0;i<e.length;i++){const l=e[i];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[l.type]){const s=this.options.extensions.renderers[l.type].call({parser:this},l);if(s!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(l.type)){n+=s||"";continue}}switch(l.type){case"escape":{const s=l;n+=t.text(s.text);break}case"html":{const s=l;n+=t.html(s.text);break}case"link":{const s=l;n+=t.link(s.href,s.title,this.parseInline(s.tokens,t));break}case"image":{const s=l;n+=t.image(s.href,s.title,s.text);break}case"strong":{const s=l;n+=t.strong(this.parseInline(s.tokens,t));break}case"em":{const s=l;n+=t.em(this.parseInline(s.tokens,t));break}case"codespan":{const s=l;n+=t.codespan(s.text);break}case"br":{n+=t.br();break}case"del":{const s=l;n+=t.del(this.parseInline(s.tokens,t));break}case"text":{const s=l;n+=t.text(s.text);break}default:{const s='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(s),"";throw new Error(s)}}}return n}}class $t{constructor(e){Y(this,"options");this.options=e||lt}preprocess(e){return e}postprocess(e){return e}}Y($t,"passThroughHooks",new Set(["preprocess","postprocess"]));var it,or,xs;class no{constructor(...e){Cr(this,it);Y(this,"defaults",wr());Y(this,"options",this.setOptions);Y(this,"parse",zt(this,it,or).call(this,Pe.lex,Ie.parse));Y(this,"parseInline",zt(this,it,or).call(this,Pe.lexInline,Ie.parseInline));Y(this,"Parser",Ie);Y(this,"Renderer",vn);Y(this,"TextRenderer",kr);Y(this,"Lexer",Pe);Y(this,"Tokenizer",_n);Y(this,"Hooks",$t);this.use(...e)}walkTokens(e,t){var i,l;let n=[];for(const s of e)switch(n=n.concat(t.call(this,s)),s.type){case"table":{const a=s;for(const o of a.header)n=n.concat(this.walkTokens(o.tokens,t));for(const o of a.rows)for(const u of o)n=n.concat(this.walkTokens(u.tokens,t));break}case"list":{const a=s;n=n.concat(this.walkTokens(a.items,t));break}default:{const a=s;(l=(i=this.defaults.extensions)==null?void 0:i.childTokens)!=null&&l[a.type]?this.defaults.extensions.childTokens[a.type].forEach(o=>{n=n.concat(this.walkTokens(a[o],t))}):a.tokens&&(n=n.concat(this.walkTokens(a.tokens,t)))}}return n}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(n=>{const i={...n};if(i.async=this.defaults.async||i.async||!1,n.extensions&&(n.extensions.forEach(l=>{if(!l.name)throw new Error("extension name required");if("renderer"in l){const s=t.renderers[l.name];s?t.renderers[l.name]=function(...a){let o=l.renderer.apply(this,a);return o===!1&&(o=s.apply(this,a)),o}:t.renderers[l.name]=l.renderer}if("tokenizer"in l){if(!l.level||l.level!=="block"&&l.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const s=t[l.level];s?s.unshift(l.tokenizer):t[l.level]=[l.tokenizer],l.start&&(l.level==="block"?t.startBlock?t.startBlock.push(l.start):t.startBlock=[l.start]:l.level==="inline"&&(t.startInline?t.startInline.push(l.start):t.startInline=[l.start]))}"childTokens"in l&&l.childTokens&&(t.childTokens[l.name]=l.childTokens)}),i.extensions=t),n.renderer){const l=this.defaults.renderer||new vn(this.defaults);for(const s in n.renderer){const a=n.renderer[s],o=s,u=l[o];l[o]=(...c)=>{let h=a.apply(l,c);return h===!1&&(h=u.apply(l,c)),h||""}}i.renderer=l}if(n.tokenizer){const l=this.defaults.tokenizer||new _n(this.defaults);for(const s in n.tokenizer){const a=n.tokenizer[s],o=s,u=l[o];l[o]=(...c)=>{let h=a.apply(l,c);return h===!1&&(h=u.apply(l,c)),h}}i.tokenizer=l}if(n.hooks){const l=this.defaults.hooks||new $t;for(const s in n.hooks){const a=n.hooks[s],o=s,u=l[o];$t.passThroughHooks.has(s)?l[o]=c=>{if(this.defaults.async)return Promise.resolve(a.call(l,c)).then(f=>u.call(l,f));const h=a.call(l,c);return u.call(l,h)}:l[o]=(...c)=>{let h=a.apply(l,c);return h===!1&&(h=u.apply(l,c)),h}}i.hooks=l}if(n.walkTokens){const l=this.defaults.walkTokens,s=n.walkTokens;i.walkTokens=function(a){let o=[];return o.push(s.call(this,a)),l&&(o=o.concat(l.call(this,a))),o}}this.defaults={...this.defaults,...i}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return Pe.lex(e,t??this.defaults)}parser(e,t){return Ie.parse(e,t??this.defaults)}}it=new WeakSet,or=function(e,t){return(n,i)=>{const l={...i},s={...this.defaults,...l};this.defaults.async===!0&&l.async===!1&&(s.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),s.async=!0);const a=zt(this,it,xs).call(this,!!s.silent,!!s.async);if(typeof n>"u"||n===null)return a(new Error("marked(): input parameter is undefined or null"));if(typeof n!="string")return a(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));if(s.hooks&&(s.hooks.options=s),s.async)return Promise.resolve(s.hooks?s.hooks.preprocess(n):n).then(o=>e(o,s)).then(o=>s.walkTokens?Promise.all(this.walkTokens(o,s.walkTokens)).then(()=>o):o).then(o=>t(o,s)).then(o=>s.hooks?s.hooks.postprocess(o):o).catch(a);try{s.hooks&&(n=s.hooks.preprocess(n));const o=e(n,s);s.walkTokens&&this.walkTokens(o,s.walkTokens);let u=t(o,s);return s.hooks&&(u=s.hooks.postprocess(u)),u}catch(o){return a(o)}}},xs=function(e,t){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const i="<p>An error occurred:</p><pre>"+Ee(n.message+"",!0)+"</pre>";return t?Promise.resolve(i):i}if(t)return Promise.reject(n);throw n}};const rt=new no;function W(r,e){return rt.parse(r,e)}W.options=W.setOptions=function(r){return rt.setOptions(r),W.defaults=rt.defaults,vs(W.defaults),W};W.getDefaults=wr;W.defaults=lt;W.use=function(...r){return rt.use(...r),W.defaults=rt.defaults,vs(W.defaults),W};W.walkTokens=function(r,e){return rt.walkTokens(r,e)};W.parseInline=rt.parseInline;W.Parser=Ie;W.parser=Ie.parse;W.Renderer=vn;W.TextRenderer=kr;W.Lexer=Pe;W.lexer=Pe.lex;W.Tokenizer=_n;W.Hooks=$t;W.parse=W;W.options;W.setOptions;W.use;W.walkTokens;W.parseInline;Ie.parse;Pe.lex;W.setOptions({breaks:!0,gfm:!0,headerIds:!1,mangle:!1});function qt(r){if(!r)return"";try{return W.parse(r)}catch(e){return console.error("Failed to parse markdown:",e),r.replace(/</g,"&lt;").replace(/>/g,"&gt;")}}function ro(r){let e,t,n=(r[0].title||"Untitled")+"",i,l,s,a,o=new Date(r[0].createdAt).toLocaleDateString()+"",u,c=r[2]&&Gr(r);return{c(){e=w("div"),t=w("h3"),i=L(n),l=A(),c&&c.c(),s=A(),a=w("div"),u=L(o),y(t,"class","text-sm font-medium mb-1"),y(a,"class","text-xs text-white/40 mt-2"),y(e,"class","border-b border-white/10 pb-4")},m(h,f){I(h,e,f),m(e,t),m(t,i),m(e,l),c&&c.m(e,null),m(e,s),m(e,a),m(a,u)},p(h,f){f&1&&n!==(n=(h[0].title||"Untitled")+"")&&H(i,n),h[2]?c?c.p(h,f):(c=Gr(h),c.c(),c.m(e,s)):c&&(c.d(1),c=null),f&1&&o!==(o=new Date(h[0].createdAt).toLocaleDateString()+"")&&H(u,o)},d(h){h&&P(e),c&&c.d()}}}function io(r){let e,t,n,i=(r[0].title||"Untitled")+"",l,s,a,o,u=new Date(r[0].createdAt).toLocaleDateString()+"",c,h=r[0].depiction&&Zr(r),f=r[2]&&Yr(r);return{c(){e=w("div"),h&&h.c(),t=A(),n=w("h3"),l=L(i),s=A(),f&&f.c(),a=A(),o=w("div"),c=L(u),y(n,"class","text-lg font-medium mb-2"),y(o,"class","text-xs text-white/40 mt-4")},m(d,g){I(d,e,g),h&&h.m(e,null),m(e,t),m(e,n),m(n,l),m(e,s),f&&f.m(e,null),m(e,a),m(e,o),m(o,c)},p(d,g){d[0].depiction?h?h.p(d,g):(h=Zr(d),h.c(),h.m(e,t)):h&&(h.d(1),h=null),g&1&&i!==(i=(d[0].title||"Untitled")+"")&&H(l,i),d[2]?f?f.p(d,g):(f=Yr(d),f.c(),f.m(e,a)):f&&(f.d(1),f=null),g&1&&u!==(u=new Date(d[0].createdAt).toLocaleDateString()+"")&&H(c,u)},d(d){d&&P(e),h&&h.d(),f&&f.d()}}}function so(r){let e,t,n,i,l=(r[0].title||"Untitled")+"",s,a,o,u,c=new Date(r[0].createdAt).toLocaleDateString()+"",h,f=r[0].depiction&&Jr(r),d=r[2]&&Xr(r);return{c(){e=w("div"),f&&f.c(),t=A(),n=w("div"),i=w("h3"),s=L(l),a=A(),d&&d.c(),o=A(),u=w("div"),h=L(c),y(i,"class","text-sm font-medium mb-1"),y(u,"class","text-xs text-white/40 mt-2"),y(n,"class","p-4"),y(e,"class","h-full")},m(g,b){I(g,e,b),f&&f.m(e,null),m(e,t),m(e,n),m(n,i),m(i,s),m(n,a),d&&d.m(n,null),m(n,o),m(n,u),m(u,h)},p(g,b){g[0].depiction?f?f.p(g,b):(f=Jr(g),f.c(),f.m(e,t)):f&&(f.d(1),f=null),b&1&&l!==(l=(g[0].title||"Untitled")+"")&&H(s,l),g[2]?d?d.p(g,b):(d=Xr(g),d.c(),d.m(n,o)):d&&(d.d(1),d=null),b&1&&c!==(c=new Date(g[0].createdAt).toLocaleDateString()+"")&&H(h,c)},d(g){g&&P(e),f&&f.d(),d&&d.d()}}}function Gr(r){let e;return{c(){e=w("div"),y(e,"class","text-sm text-white/80 prose-content")},m(t,n){I(t,e,n),e.innerHTML=r[2]},p(t,n){n&4&&(e.innerHTML=t[2])},d(t){t&&P(e)}}}function Zr(r){let e,t,n;return{c(){e=w("img"),Qe(e.src,t=r[0].depiction)||y(e,"src",t),y(e,"alt",n=r[0].title||"Image"),y(e,"class","w-full h-64 object-cover mb-4 rounded")},m(i,l){I(i,e,l)},p(i,l){l&1&&!Qe(e.src,t=i[0].depiction)&&y(e,"src",t),l&1&&n!==(n=i[0].title||"Image")&&y(e,"alt",n)},d(i){i&&P(e)}}}function Yr(r){let e;return{c(){e=w("div"),y(e,"class","text-sm text-white/70 prose-content")},m(t,n){I(t,e,n),e.innerHTML=r[2]},p(t,n){n&4&&(e.innerHTML=t[2])},d(t){t&&P(e)}}}function Jr(r){let e,t,n;return{c(){e=w("img"),Qe(e.src,t=r[0].depiction)||y(e,"src",t),y(e,"alt",n=r[0].title||"Image"),y(e,"class","w-full h-48 object-cover")},m(i,l){I(i,e,l)},p(i,l){l&1&&!Qe(e.src,t=i[0].depiction)&&y(e,"src",t),l&1&&n!==(n=i[0].title||"Image")&&y(e,"alt",n)},d(i){i&&P(e)}}}function Xr(r){let e;return{c(){e=w("div"),y(e,"class","text-xs text-white/60 line-clamp-3 prose-content")},m(t,n){I(t,e,n),e.innerHTML=r[2]},p(t,n){n&4&&(e.innerHTML=t[2])},d(t){t&&P(e)}}}function lo(r){let e;function t(l,s){return l[1]==="grid"?so:l[1]==="card"?io:ro}let n=t(r),i=n(r);return{c(){i.c(),e=De()},m(l,s){i.m(l,s),I(l,e,s)},p(l,[s]){n===(n=t(l))&&i?i.p(l,s):(i.d(1),i=n(l),i&&(i.c(),i.m(e.parentNode,e)))},i:M,o:M,d(l){l&&P(e),i.d(l)}}}function oo(r,e,t){let n,{post:i}=e,{variant:l="default"}=e;return r.$$set=s=>{"post"in s&&t(0,i=s.post),"variant"in s&&t(1,l=s.variant)},r.$$.update=()=>{r.$$.dirty&1&&t(2,n=i.content?qt(i.content):"")},[i,l,n]}class ao extends he{constructor(e){super(),de(this,e,oo,lo,pe,{post:0,variant:1})}}function co(r){let e,t,n,i,l,s,a,o,u,c,h,f,d;return{c(){e=w("form"),t=w("div"),n=w("input"),i=A(),l=w("div"),s=w("textarea"),a=A(),o=w("div"),u=w("button"),u.textContent="Post",c=A(),h=w("button"),h.textContent="Cancel",y(n,"type","text"),y(n,"placeholder","Title"),y(n,"class","w-full bg-black border-b border-white/20 pb-1 text-sm focus:outline-none focus:border-white"),y(s,"placeholder","Content (optional)"),y(s,"rows","4"),y(s,"class","w-full bg-black border border-white/20 p-2 text-sm focus:outline-none focus:border-white resize-none"),y(u,"type","submit"),y(u,"class","text-xs uppercase tracking-wider border border-white/20 px-3 py-1 hover:bg-white hover:text-black transition-colors"),y(h,"type","button"),y(h,"class","text-xs uppercase tracking-wider text-white/60 hover:text-white"),y(o,"class","flex gap-2"),y(e,"class","border border-white/20 p-4 space-y-3")},m(g,b){I(g,e,b),m(e,t),m(t,n),U(n,r[0]),m(e,i),m(e,l),m(l,s),U(s,r[1]),m(e,a),m(e,o),m(o,u),m(o,c),m(o,h),f||(d=[J(n,"input",r[4]),J(s,"input",r[5]),J(h,"click",r[3]),J(e,"submit",r[2])],f=!0)},p(g,[b]){b&1&&n.value!==g[0]&&U(n,g[0]),b&2&&U(s,g[1])},i:M,o:M,d(g){g&&P(e),f=!1,pt(d)}}}function uo(r,e,t){let{title:n=""}=e,{content:i=""}=e;const l=Ft();function s(c){c.preventDefault(),l("submit",{title:n,content:i})}function a(){l("cancel")}function o(){n=this.value,t(0,n)}function u(){i=this.value,t(1,i)}return r.$$set=c=>{"title"in c&&t(0,n=c.title),"content"in c&&t(1,i=c.content)},[n,i,s,a,o,u]}class fo extends he{constructor(e){super(),de(this,e,uo,co,pe,{title:0,content:1})}}function ei(r,e,t){const n=r.slice();return n[1]=e[t],n}function ti(r){let e,t,n;return{c(){e=w("img"),Qe(e.src,t=r[1].depiction)||y(e,"src",t),y(e,"alt",n=r[1].title||"Image"),y(e,"class","w-full h-48 object-cover")},m(i,l){I(i,e,l)},p(i,l){l&1&&!Qe(e.src,t=i[1].depiction)&&y(e,"src",t),l&1&&n!==(n=i[1].title||"Image")&&y(e,"alt",n)},d(i){i&&P(e)}}}function ni(r){let e,t=r[1].content+"",n;return{c(){e=w("p"),n=L(t),y(e,"class","text-xs text-white/60 line-clamp-3")},m(i,l){I(i,e,l),m(e,n)},p(i,l){l&1&&t!==(t=i[1].content+"")&&H(n,t)},d(i){i&&P(e)}}}function ri(r){let e,t,n,i,l=(r[1].title||r[1].slug||"Untitled")+"",s,a,o,u,c=r[1].depiction&&ti(r),h=r[1].content&&ni(r);return{c(){e=w("a"),c&&c.c(),t=A(),n=w("div"),i=w("h3"),s=L(l),a=A(),h&&h.c(),o=A(),y(i,"class","text-sm font-medium mb-2"),y(n,"class","p-4"),y(e,"href",u=r[1].slug||`/${r[1].id}`),y(e,"class","block border border-white/20 hover:border-white/40 transition-colors overflow-hidden")},m(f,d){I(f,e,d),c&&c.m(e,null),m(e,t),m(e,n),m(n,i),m(i,s),m(n,a),h&&h.m(n,null),m(e,o)},p(f,d){f[1].depiction?c?c.p(f,d):(c=ti(f),c.c(),c.m(e,t)):c&&(c.d(1),c=null),d&1&&l!==(l=(f[1].title||f[1].slug||"Untitled")+"")&&H(s,l),f[1].content?h?h.p(f,d):(h=ni(f),h.c(),h.m(n,null)):h&&(h.d(1),h=null),d&1&&u!==(u=f[1].slug||`/${f[1].id}`)&&y(e,"href",u)},d(f){f&&P(e),c&&c.d(),h&&h.d()}}}function ho(r){let e,t=me(r[0]),n=[];for(let i=0;i<t.length;i+=1)n[i]=ri(ei(r,t,i));return{c(){e=w("div");for(let i=0;i<n.length;i+=1)n[i].c();y(e,"class","grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4")},m(i,l){I(i,e,l);for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(e,null)},p(i,[l]){if(l&1){t=me(i[0]);let s;for(s=0;s<t.length;s+=1){const a=ei(i,t,s);n[s]?n[s].p(a,l):(n[s]=ri(a),n[s].c(),n[s].m(e,null))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},i:M,o:M,d(i){i&&P(e),Ne(n,i)}}}function po(r,e,t){let{children:n=[]}=e;return r.$$set=i=>{"children"in i&&t(0,n=i.children)},[n]}class mo extends he{constructor(e){super(),de(this,e,po,ho,pe,{children:0})}}function ii(r,e,t){const n=r.slice();return n[2]=e[t],n}function si(r){let e,t=r[1](r[2].content)+"",n;return{c(){e=w("span"),n=L(t),y(e,"class","text-xs text-white/60 ml-2")},m(i,l){I(i,e,l),m(e,n)},p(i,l){l&1&&t!==(t=i[1](i[2].content)+"")&&H(n,t)},d(i){i&&P(e)}}}function li(r){let e,t,n,i,l=(r[2].title||r[2].slug||"Untitled")+"",s,a,o,u,c=new Date(r[2].updatedAt).toLocaleDateString()+"",h,f,d,g=r[2].content&&si(r);return{c(){e=w("a"),t=w("div"),n=w("div"),i=w("h3"),s=L(l),a=A(),g&&g.c(),o=A(),u=w("span"),h=L(c),f=A(),y(i,"class","text-sm font-medium inline"),y(n,"class","flex-grow"),y(u,"class","text-xs text-white/40"),y(t,"class","flex items-baseline gap-3"),y(e,"href",d=r[2].slug||`/${r[2].id}`),y(e,"class","block border-b border-white/10 pb-2 hover:border-white/30 transition-colors")},m(b,_){I(b,e,_),m(e,t),m(t,n),m(n,i),m(i,s),m(n,a),g&&g.m(n,null),m(t,o),m(t,u),m(u,h),m(e,f)},p(b,_){_&1&&l!==(l=(b[2].title||b[2].slug||"Untitled")+"")&&H(s,l),b[2].content?g?g.p(b,_):(g=si(b),g.c(),g.m(n,null)):g&&(g.d(1),g=null),_&1&&c!==(c=new Date(b[2].updatedAt).toLocaleDateString()+"")&&H(h,c),_&1&&d!==(d=b[2].slug||`/${b[2].id}`)&&y(e,"href",d)},d(b){b&&P(e),g&&g.d()}}}function go(r){let e,t=me(r[0]),n=[];for(let i=0;i<t.length;i+=1)n[i]=li(ii(r,t,i));return{c(){e=w("div");for(let i=0;i<n.length;i+=1)n[i].c();y(e,"class","space-y-2")},m(i,l){I(i,e,l);for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(e,null)},p(i,[l]){if(l&3){t=me(i[0]);let s;for(s=0;s<t.length;s+=1){const a=ii(i,t,s);n[s]?n[s].p(a,l):(n[s]=li(a),n[s].c(),n[s].m(e,null))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},i:M,o:M,d(i){i&&P(e),Ne(n,i)}}}function bo(r){const e=document.createElement("div");return e.innerHTML=r,e.textContent||e.innerText||""}function yo(r,e,t){let{children:n=[]}=e;function i(l){const s=qt(l),a=bo(s);return a.substring(0,100)+(a.length>100?"...":"")}return r.$$set=l=>{"children"in l&&t(0,n=l.children)},[n,i]}class _o extends he{constructor(e){super(),de(this,e,yo,go,pe,{children:0})}}function oi(r,e,t){const n=r.slice();return n[2]=e[t],n}function ai(r){let e,t,n;return{c(){e=w("img"),Qe(e.src,t=r[2].depiction)||y(e,"src",t),y(e,"alt",n=r[2].title||"Image"),y(e,"class","w-full h-64 object-cover")},m(i,l){I(i,e,l)},p(i,l){l&1&&!Qe(e.src,t=i[2].depiction)&&y(e,"src",t),l&1&&n!==(n=i[2].title||"Image")&&y(e,"alt",n)},d(i){i&&P(e)}}}function ci(r){let e,t=r[1](r[2].content)+"",n;return{c(){e=w("p"),n=L(t),y(e,"class","text-sm text-white/70 leading-relaxed")},m(i,l){I(i,e,l),m(e,n)},p(i,l){l&1&&t!==(t=i[1](i[2].content)+"")&&H(n,t)},d(i){i&&P(e)}}}function ui(r){let e,t,n,i,l,s,a=r[2].type+"",o,u,c,h=(r[2].title||r[2].slug||"Untitled")+"",f,d,g,b=new Date(r[2].createdAt).toLocaleDateString()+"",_,p,v,k,E,x=new Date(r[2].updatedAt).toLocaleString()+"",T,C,j,S=r[2].depiction&&ai(r),B=r[2].content&&ci(r);return{c(){e=w("a"),S&&S.c(),t=A(),n=w("div"),i=w("div"),l=w("div"),s=w("span"),o=L(a),u=A(),c=w("h3"),f=L(h),d=A(),g=w("span"),_=L(b),p=A(),B&&B.c(),v=A(),k=w("div"),E=L("Last updated: "),T=L(x),C=A(),y(s,"class","text-xs text-white/60 uppercase tracking-wider"),y(c,"class","text-lg font-medium mt-1"),y(g,"class","text-xs text-white/40"),y(i,"class","flex items-start justify-between mb-3"),y(k,"class","mt-4 text-xs text-white/40"),y(n,"class","p-6"),y(e,"href",j=r[2].slug||`/${r[2].id}`),y(e,"class","block bg-white/5 rounded-lg overflow-hidden hover:bg-white/10 transition-colors")},m(O,z){I(O,e,z),S&&S.m(e,null),m(e,t),m(e,n),m(n,i),m(i,l),m(l,s),m(s,o),m(l,u),m(l,c),m(c,f),m(i,d),m(i,g),m(g,_),m(n,p),B&&B.m(n,null),m(n,v),m(n,k),m(k,E),m(k,T),m(e,C)},p(O,z){O[2].depiction?S?S.p(O,z):(S=ai(O),S.c(),S.m(e,t)):S&&(S.d(1),S=null),z&1&&a!==(a=O[2].type+"")&&H(o,a),z&1&&h!==(h=(O[2].title||O[2].slug||"Untitled")+"")&&H(f,h),z&1&&b!==(b=new Date(O[2].createdAt).toLocaleDateString()+"")&&H(_,b),O[2].content?B?B.p(O,z):(B=ci(O),B.c(),B.m(n,v)):B&&(B.d(1),B=null),z&1&&x!==(x=new Date(O[2].updatedAt).toLocaleString()+"")&&H(T,x),z&1&&j!==(j=O[2].slug||`/${O[2].id}`)&&y(e,"href",j)},d(O){O&&P(e),S&&S.d(),B&&B.d()}}}function vo(r){let e,t=me(r[0]),n=[];for(let i=0;i<t.length;i+=1)n[i]=ui(oi(r,t,i));return{c(){e=w("div");for(let i=0;i<n.length;i+=1)n[i].c();y(e,"class","space-y-6")},m(i,l){I(i,e,l);for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(e,null)},p(i,[l]){if(l&3){t=me(i[0]);let s;for(s=0;s<t.length;s+=1){const a=oi(i,t,s);n[s]?n[s].p(a,l):(n[s]=ui(a),n[s].c(),n[s].m(e,null))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},i:M,o:M,d(i){i&&P(e),Ne(n,i)}}}function wo(r){const e=document.createElement("div");return e.innerHTML=r,e.textContent||e.innerText||""}function ko(r,e,t){let{children:n=[]}=e;function i(l,s=200){const a=qt(l),o=wo(a);return o.substring(0,s)+(o.length>s?"...":"")}return r.$$set=l=>{"children"in l&&t(0,n=l.children)},[n,i]}class xo extends he{constructor(e){super(),de(this,e,ko,vo,pe,{children:0})}}function fi(r,e,t){const n=r.slice();return n[15]=e[t],n}function hi(r,e,t){const n=r.slice();return n[12]=e[t],n}function Eo(r){let e,t,n,i=(r[1].title||r[1].slug||"Untitled")+"",l,s,a,o,u,c=r[1].content&&di(r),h=r[1].type==="group"&&pi(r),f=r[2].length>0&&bi(r);return{c(){e=w("div"),t=w("div"),n=w("h1"),l=L(i),s=A(),c&&c.c(),a=A(),h&&h.c(),o=A(),f&&f.c(),y(n,"class","text-lg mb-2"),y(t,"class","mb-8")},m(d,g){I(d,e,g),m(e,t),m(t,n),m(n,l),m(t,s),c&&c.m(t,null),m(e,a),h&&h.m(e,null),m(e,o),f&&f.m(e,null),u=!0},p(d,g){(!u||g&2)&&i!==(i=(d[1].title||d[1].slug||"Untitled")+"")&&H(l,i),d[1].content?c?c.p(d,g):(c=di(d),c.c(),c.m(t,null)):c&&(c.d(1),c=null),d[1].type==="group"?h?(h.p(d,g),g&2&&$(h,1)):(h=pi(d),h.c(),$(h,1),h.m(e,o)):h&&(ue(),K(h,1,1,()=>{h=null}),fe()),d[2].length>0?f?(f.p(d,g),g&4&&$(f,1)):(f=bi(d),f.c(),$(f,1),f.m(e,null)):f&&(ue(),K(f,1,1,()=>{f=null}),fe())},i(d){u||($(h),$(f),u=!0)},o(d){K(h),K(f),u=!1},d(d){d&&P(e),c&&c.d(),h&&h.d(),f&&f.d()}}}function So(r){let e;return{c(){e=w("div"),e.innerHTML='<div class="text-sm text-white/60">Page not found</div> <a href="/" class="text-xs text-white/60 hover:text-white underline">â Back to home</a>',y(e,"class","space-y-4")},m(t,n){I(t,e,n)},p:M,i:M,o:M,d(t){t&&P(e)}}}function Co(r){let e,t,n,i;function l(o,u){return o[2].length===0?Bo:jo}let s=l(r),a=s(r);return{c(){e=w("div"),t=w("h1"),t.textContent="Groups",n=A(),i=w("div"),a.c(),y(t,"class","text-xs uppercase tracking-wider mb-8"),y(i,"class","space-y-2")},m(o,u){I(o,e,u),m(e,t),m(e,n),m(e,i),a.m(i,null)},p(o,u){s===(s=l(o))&&a?a.p(o,u):(a.d(1),a=s(o),a&&(a.c(),a.m(i,null)))},i:M,o:M,d(o){o&&P(e),a.d()}}}function To(r){let e,t,n,i,l;return{c(){e=w("div"),t=w("div"),n=L(r[5]),i=A(),l=w("a"),l.textContent="â Back to home",y(t,"class","text-sm text-red-400"),y(l,"href","/"),y(l,"class","text-xs text-white/60 hover:text-white underline"),y(e,"class","space-y-4")},m(s,a){I(s,e,a),m(e,t),m(t,n),m(e,i),m(e,l)},p(s,a){a&32&&H(n,s[5])},i:M,o:M,d(s){s&&P(e)}}}function Ao(r){let e;return{c(){e=w("div"),e.textContent="Loading...",y(e,"class","text-xs text-white/60")},m(t,n){I(t,e,n)},p:M,i:M,o:M,d(t){t&&P(e)}}}function di(r){let e,t=qt(r[1].content)+"";return{c(){e=w("div"),y(e,"class","text-sm text-white/60 prose-content")},m(n,i){I(n,e,i),e.innerHTML=t},p(n,i){i&2&&t!==(t=qt(n[1].content)+"")&&(e.innerHTML=t)},d(n){n&&P(e)}}}function pi(r){let e,t,n,i=r[6]&&!r[4]&&mi(r),l=r[4]&&gi(r);return{c(){e=w("div"),i&&i.c(),t=A(),l&&l.c(),y(e,"class","mb-6")},m(s,a){I(s,e,a),i&&i.m(e,null),m(e,t),l&&l.m(e,null),n=!0},p(s,a){s[6]&&!s[4]?i?i.p(s,a):(i=mi(s),i.c(),i.m(e,t)):i&&(i.d(1),i=null),s[4]?l?(l.p(s,a),a&16&&$(l,1)):(l=gi(s),l.c(),$(l,1),l.m(e,null)):l&&(ue(),K(l,1,1,()=>{l=null}),fe())},i(s){n||($(l),n=!0)},o(s){K(l),n=!1},d(s){s&&P(e),i&&i.d(),l&&l.d()}}}function mi(r){let e,t,n;return{c(){e=w("button"),e.textContent="New Post",y(e,"class","text-xs uppercase tracking-wider border border-white/20 px-3 py-1 hover:bg-white hover:text-black transition-colors")},m(i,l){I(i,e,l),t||(n=J(e,"click",r[9]),t=!0)},p:M,d(i){i&&P(e),t=!1,n()}}}function gi(r){let e,t;return e=new fo({}),e.$on("submit",r[7]),e.$on("cancel",r[10]),{c(){re(e.$$.fragment)},m(n,i){ne(e,n,i),t=!0},p:M,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){K(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function bi(r){let e,t,n,i;const l=[Po,$o],s=[];function a(o,u){return o[1].type==="group"?0:1}return t=a(r),n=s[t]=l[t](r),{c(){e=w("div"),n.c(),y(e,"class","space-y-4")},m(o,u){I(o,e,u),s[t].m(e,null),i=!0},p(o,u){let c=t;t=a(o),t===c?s[t].p(o,u):(ue(),K(s[c],1,1,()=>{s[c]=null}),fe(),n=s[t],n?n.p(o,u):(n=s[t]=l[t](o),n.c()),$(n,1),n.m(e,null))},i(o){i||($(n),i=!0)},o(o){K(n),i=!1},d(o){o&&P(e),s[t].d()}}}function $o(r){let e,t,n=me(r[2]),i=[];for(let s=0;s<n.length;s+=1)i[s]=_i(fi(r,n,s));const l=s=>K(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=De()},m(s,a){for(let o=0;o<i.length;o+=1)i[o]&&i[o].m(s,a);I(s,e,a),t=!0},p(s,a){if(a&4){n=me(s[2]);let o;for(o=0;o<n.length;o+=1){const u=fi(s,n,o);i[o]?(i[o].p(u,a),$(i[o],1)):(i[o]=_i(u),i[o].c(),$(i[o],1),i[o].m(e.parentNode,e))}for(ue(),o=n.length;o<i.length;o+=1)l(o);fe()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)K(i[a]);t=!1},d(s){s&&P(e),Ne(i,s)}}}function Po(r){let e,t,n,i;const l=[Ko,Oo,Ro],s=[];function a(o,u){return o[1].view==="grid"?0:o[1].view==="cards"?1:2}return e=a(r),t=s[e]=l[e](r),{c(){t.c(),n=De()},m(o,u){s[e].m(o,u),I(o,n,u),i=!0},p(o,u){let c=e;e=a(o),e===c?s[e].p(o,u):(ue(),K(s[c],1,1,()=>{s[c]=null}),fe(),t=s[e],t?t.p(o,u):(t=s[e]=l[e](o),t.c()),$(t,1),t.m(n.parentNode,n))},i(o){i||($(t),i=!0)},o(o){K(t),i=!1},d(o){o&&P(n),s[e].d(o)}}}function Io(r){let e,t,n,i,l,s=r[15].type+"",a,o,u,c,h=(r[15].title||r[15].slug||"Untitled")+"",f,d,g,b,_=r[15].content&&yi(r);return{c(){e=w("div"),t=w("a"),n=w("div"),i=w("span"),l=L("["),a=L(s),o=L("]"),u=A(),c=w("span"),f=L(h),g=A(),_&&_.c(),b=A(),y(i,"class","text-xs text-white/60"),y(c,"class","text-sm font-medium"),y(n,"class","flex items-baseline gap-2"),y(t,"href",d=r[15].slug||`/${r[15].id}`),y(t,"class","hover:underline"),y(e,"class","border-b border-white/10 pb-4")},m(p,v){I(p,e,v),m(e,t),m(t,n),m(n,i),m(i,l),m(i,a),m(i,o),m(n,u),m(n,c),m(c,f),m(e,g),_&&_.m(e,null),m(e,b)},p(p,v){v&4&&s!==(s=p[15].type+"")&&H(a,s),v&4&&h!==(h=(p[15].title||p[15].slug||"Untitled")+"")&&H(f,h),v&4&&d!==(d=p[15].slug||`/${p[15].id}`)&&y(t,"href",d),p[15].content?_?_.p(p,v):(_=yi(p),_.c(),_.m(e,b)):_&&(_.d(1),_=null)},i:M,o:M,d(p){p&&P(e),_&&_.d()}}}function Do(r){let e,t;return e=new ao({props:{post:r[15]}}),{c(){re(e.$$.fragment)},m(n,i){ne(e,n,i),t=!0},p(n,i){const l={};i&4&&(l.post=n[15]),e.$set(l)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){K(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function yi(r){let e,t=r[15].content+"",n;return{c(){e=w("p"),n=L(t),y(e,"class","text-xs text-white/60 mt-1 line-clamp-2")},m(i,l){I(i,e,l),m(e,n)},p(i,l){l&4&&t!==(t=i[15].content+"")&&H(n,t)},d(i){i&&P(e)}}}function _i(r){let e,t,n,i;const l=[Do,Io],s=[];function a(o,u){return o[15].type==="post"?0:1}return e=a(r),t=s[e]=l[e](r),{c(){t.c(),n=De()},m(o,u){s[e].m(o,u),I(o,n,u),i=!0},p(o,u){let c=e;e=a(o),e===c?s[e].p(o,u):(ue(),K(s[c],1,1,()=>{s[c]=null}),fe(),t=s[e],t?t.p(o,u):(t=s[e]=l[e](o),t.c()),$(t,1),t.m(n.parentNode,n))},i(o){i||($(t),i=!0)},o(o){K(t),i=!1},d(o){o&&P(n),s[e].d(o)}}}function Ro(r){let e,t;return e=new _o({props:{children:r[2]}}),{c(){re(e.$$.fragment)},m(n,i){ne(e,n,i),t=!0},p(n,i){const l={};i&4&&(l.children=n[2]),e.$set(l)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){K(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Oo(r){let e,t;return e=new xo({props:{children:r[2]}}),{c(){re(e.$$.fragment)},m(n,i){ne(e,n,i),t=!0},p(n,i){const l={};i&4&&(l.children=n[2]),e.$set(l)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){K(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Ko(r){let e,t;return e=new mo({props:{children:r[2]}}),{c(){re(e.$$.fragment)},m(n,i){ne(e,n,i),t=!0},p(n,i){const l={};i&4&&(l.children=n[2]),e.$set(l)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){K(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function jo(r){let e,t=me(r[2]),n=[];for(let i=0;i<t.length;i+=1)n[i]=wi(hi(r,t,i));return{c(){for(let i=0;i<n.length;i+=1)n[i].c();e=De()},m(i,l){for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(i,l);I(i,e,l)},p(i,l){if(l&4){t=me(i[2]);let s;for(s=0;s<t.length;s+=1){const a=hi(i,t,s);n[s]?n[s].p(a,l):(n[s]=wi(a),n[s].c(),n[s].m(e.parentNode,e))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},d(i){i&&P(e),Ne(n,i)}}}function Bo(r){let e;return{c(){e=w("p"),e.textContent="No groups found",y(e,"class","text-xs text-white/60")},m(t,n){I(t,e,n)},p:M,d(t){t&&P(e)}}}function vi(r){let e,t=r[12].content+"",n;return{c(){e=w("p"),n=L(t),y(e,"class","text-xs text-white/60 mt-1 line-clamp-2")},m(i,l){I(i,e,l),m(e,n)},p(i,l){l&4&&t!==(t=i[12].content+"")&&H(n,t)},d(i){i&&P(e)}}}function wi(r){let e,t,n,i,l,s=r[12].type+"",a,o,u,c,h=(r[12].title||r[12].slug||"Untitled")+"",f,d,g,b,_=r[12].content&&vi(r);return{c(){e=w("div"),t=w("a"),n=w("div"),i=w("span"),l=L("["),a=L(s),o=L("]"),u=A(),c=w("span"),f=L(h),d=A(),_&&_.c(),b=A(),y(i,"class","text-xs text-white/60"),y(c,"class","text-sm"),y(n,"class","flex items-baseline gap-2"),y(t,"href",g=r[12].slug||`/${r[12].id}`),y(t,"class","hover:underline"),y(e,"class","border-b border-white/10 pb-2")},m(p,v){I(p,e,v),m(e,t),m(t,n),m(n,i),m(i,l),m(i,a),m(i,o),m(n,u),m(n,c),m(c,f),m(t,d),_&&_.m(t,null),m(e,b)},p(p,v){v&4&&s!==(s=p[12].type+"")&&H(a,s),v&4&&h!==(h=(p[12].title||p[12].slug||"Untitled")+"")&&H(f,h),p[12].content?_?_.p(p,v):(_=vi(p),_.c(),_.m(t,null)):_&&(_.d(1),_=null),v&4&&g!==(g=p[12].slug||`/${p[12].id}`)&&y(t,"href",g)},d(p){p&&P(e),_&&_.d()}}}function qo(r){let e,t,n,i;const l=[Ao,To,Co,So,Eo],s=[];function a(o,u){return o[3]?0:o[5]?1:!o[1]&&o[0]==="/"?2:o[1]?4:3}return e=a(r),t=s[e]=l[e](r),{c(){t.c(),n=De()},m(o,u){s[e].m(o,u),I(o,n,u),i=!0},p(o,[u]){let c=e;e=a(o),e===c?s[e].p(o,u):(ue(),K(s[c],1,1,()=>{s[c]=null}),fe(),t=s[e],t?t.p(o,u):(t=s[e]=l[e](o),t.c()),$(t,1),t.m(n.parentNode,n))},i(o){i||($(t),i=!0)},o(o){K(t),i=!1},d(o){o&&P(n),s[e].d(o)}}}function Fo(r,e,t){let n;xt(r,Pt,b=>t(6,n=b));let{wildcard:i=""}=e,l=i||"/",s=null,a=[],o=!0,u=!1,c=null;Rs(async()=>{l&&await h()});async function h(){var b,_;t(3,o=!0),t(5,c=null),t(1,s=null),t(2,a=[]);try{const p=l.startsWith("/")?l:`/${l}`;console.log("EntityView: Loading entity with slug:",p);const v=await Ce.getEntityBySlug(p);if(console.log("EntityView: Received entity data:",v),!v)throw new Error(`Entity not found: ${p}`);t(1,s=v);try{const k=await Ce.queryEntities({parentId:v.id,limit:100});t(2,a=k||[])}catch(k){console.error("Failed to load children:",k),t(2,a=[])}}catch(p){if(console.error("Failed to load entity:",p),p.status===404||(b=p.message)!=null&&b.includes("not found")||(_=p.message)!=null&&_.includes("Entity not found"))if(querySlug==="/"){t(5,c=null),t(1,s=null);try{const v=await Ce.queryEntities({type:"group",limit:100});t(2,a=v||[]),a.length===0&&console.log("No groups found, showing empty state")}catch(v){console.error("Failed to load groups:",v),t(2,a=[])}}else t(5,c=`Page not found: ${l}`);else p.status===403?t(5,c="You do not have permission to view this page"):p.message==="Failed to fetch"||p.code==="ECONNREFUSED"?(console.log("Server unavailable, using cached/static data only"),t(5,c=null)):t(5,c=p.message||"Failed to load page");l!=="/"&&(t(1,s=null),t(2,a=[]))}finally{t(3,o=!1)}}async function f(b){const{title:_,content:p}=b.detail;if(!(!n||!s||!_.trim()))try{await Ce.createPost({title:_.trim(),content:p.trim(),parentId:s.id,sponsorId:n.id,auth:n.id}),t(4,u=!1),await h()}catch(v){console.error("Failed to create post:",v)}}const d=()=>t(4,u=!0),g=()=>t(4,u=!1);return r.$$set=b=>{"wildcard"in b&&t(8,i=b.wildcard)},r.$$.update=()=>{r.$$.dirty&256&&t(0,l=i||"/"),r.$$.dirty&1&&l&&h()},[l,s,a,o,u,c,n,f,i,d,g]}class ki extends he{constructor(e){super(),de(this,e,Fo,qo,pe,{wildcard:8})}}function Lo(r){let e,t,n,i,l,s,a,o,u,c,h,f;return{c(){e=w("div"),t=w("h1"),t.textContent="Login",n=A(),i=w("form"),l=w("div"),s=w("label"),s.textContent="Username",a=A(),o=w("input"),u=A(),c=w("button"),c.textContent="Enter",y(t,"class","text-xs uppercase tracking-wider mb-8"),y(s,"for","username"),y(s,"class","block text-xs text-white/60 mb-1"),y(o,"id","username"),y(o,"type","text"),y(o,"class","w-full bg-black border border-white/20 px-2 py-1 text-sm focus:outline-none focus:border-white"),y(o,"placeholder","enter username"),y(c,"type","submit"),y(c,"class","border border-white/20 px-4 py-1 text-xs uppercase tracking-wider hover:bg-white hover:text-black transition-colors"),y(i,"class","space-y-4"),y(e,"class","max-w-sm")},m(d,g){I(d,e,g),m(e,t),m(e,n),m(e,i),m(i,l),m(l,s),m(l,a),m(l,o),U(o,r[0]),m(i,u),m(i,c),h||(f=[J(o,"input",r[2]),J(i,"submit",r[1])],h=!0)},p(d,[g]){g&1&&o.value!==d[0]&&U(o,d[0])},i:M,o:M,d(d){d&&P(e),h=!1,pt(f)}}}function No(r,e,t){let n="";async function i(s){s.preventDefault(),n.trim()&&(await Pt.login(n.trim()),qi("/"))}function l(){n=this.value,t(0,n)}return[n,i,l]}class Mo extends he{constructor(e){super(),de(this,e,No,Lo,pe,{})}}function zo(r){let e,t,n,i,l;return{c(){e=w("button"),t=L(r[1]),y(e,"class",n="pb-2 text-xs uppercase tracking-wider "+(r[0]?"border-b border-white":"text-white/60 hover:text-white"))},m(s,a){I(s,e,a),m(e,t),i||(l=J(e,"click",r[2]),i=!0)},p(s,[a]){a&2&&H(t,s[1]),a&1&&n!==(n="pb-2 text-xs uppercase tracking-wider "+(s[0]?"border-b border-white":"text-white/60 hover:text-white"))&&y(e,"class",n)},i:M,o:M,d(s){s&&P(e),i=!1,l()}}}function Uo(r,e,t){let{active:n=!1}=e,{label:i}=e;function l(s){Os.call(this,r,s)}return r.$$set=s=>{"active"in s&&t(0,n=s.active),"label"in s&&t(1,i=s.label)},[n,i,l]}class On extends he{constructor(e){super(),de(this,e,Uo,zo,pe,{active:0,label:1})}}function Ho(r){const e=new Map,t=new Set,n=[];return r.forEach(i=>{e.set(i.id,{...i,children:[]})}),r.forEach(i=>{const l=e.get(i.id);if(i.parentId){const s=e.get(i.parentId);s?s.children.push(l):t.has(i.id)||(t.add(i.id),n.push(l))}else t.has(i.id)||(t.add(i.id),n.push(l))}),n.sort((i,l)=>{const s=i.slug||i.id,a=l.slug||l.id;return s.localeCompare(a)}),n}function Qo(r){let e,t,n,i,l,s,a,o,u,c,h,f,d,g,b;return{c(){e=w("div"),t=w("input"),n=A(),i=w("select"),l=w("option"),l.textContent="All Types",s=w("option"),s.textContent="Post",a=w("option"),a.textContent="Group",o=w("option"),o.textContent="Party",u=w("option"),u.textContent="Place",c=w("option"),c.textContent="Thing",h=w("option"),h.textContent="Agent",f=A(),d=w("button"),d.textContent="Search",y(t,"type","text"),y(t,"placeholder","Search by slug..."),y(t,"class","bg-black border border-white/20 px-2 py-1 text-xs"),l.__value="",U(l,l.__value),s.__value="post",U(s,s.__value),a.__value="group",U(a,a.__value),o.__value="party",U(o,o.__value),u.__value="place",U(u,u.__value),c.__value="thing",U(c,c.__value),h.__value="agent",U(h,h.__value),y(i,"class","bg-black border border-white/20 px-2 py-1 text-xs"),r[1]===void 0&&Fi(()=>r[6].call(i)),y(d,"class","border border-white/20 px-3 py-1 text-xs uppercase tracking-wider hover:bg-white hover:text-black"),y(e,"class","flex gap-4 mb-4")},m(_,p){I(_,e,p),m(e,t),U(t,r[0]),m(e,n),m(e,i),m(i,l),m(i,s),m(i,a),m(i,o),m(i,u),m(i,c),m(i,h),an(i,r[1],!0),m(e,f),m(e,d),g||(b=[J(t,"input",r[4]),J(t,"keydown",r[5]),J(i,"change",r[6]),J(i,"change",r[3]),J(d,"click",r[2])],g=!0)},p(_,[p]){p&1&&t.value!==_[0]&&U(t,_[0]),p&2&&an(i,_[1])},i:M,o:M,d(_){_&&P(e),g=!1,pt(b)}}}function Vo(r,e,t){let{searchQuery:n=""}=e,{typeFilter:i=""}=e;const l=Ft();function s(){l("search")}function a(){l("typeChange")}function o(){n=this.value,t(0,n)}const u=h=>h.key==="Enter"&&s();function c(){i=Li(this),t(1,i)}return r.$$set=h=>{"searchQuery"in h&&t(0,n=h.searchQuery),"typeFilter"in h&&t(1,i=h.typeFilter)},[n,i,s,a,o,u,c]}class Wo extends he{constructor(e){super(),de(this,e,Vo,Qo,pe,{searchQuery:0,typeFilter:1})}}function xi(r){let e,t,n=r[0].title+"",i;return{c(){e=w("div"),t=L("Title: "),i=L(n),y(e,"class","text-white/80")},m(l,s){I(l,e,s),m(e,t),m(e,i)},p(l,s){s&1&&n!==(n=l[0].title+"")&&H(i,n)},d(l){l&&P(e)}}}function Ei(r){let e,t,n=r[0].parentId+"",i;return{c(){e=w("div"),t=L("Parent: "),i=L(n),y(e,"class","text-white/60 text-xs")},m(l,s){I(l,e,s),m(e,t),m(e,i)},p(l,s){s&1&&n!==(n=l[0].parentId+"")&&H(i,n)},d(l){l&&P(e)}}}function Go(r){let e,t,n,i,l,s=r[0].type+"",a,o,u,c,h=(r[0].slug||r[0].id)+"",f,d,g,b,_,p,v=r[0].id+"",k,E,x,T,C=new Date(r[0].createdAt).toLocaleString()+"",j,S,B,O,z,X,Z,oe,se=r[0].title&&xi(r),Q=r[3]&&r[0].parentId&&Ei(r);return{c(){e=w("div"),t=w("div"),n=w("div"),i=w("span"),l=L("["),a=L(s),o=L("]"),u=A(),c=w("span"),f=L(h),d=A(),se&&se.c(),g=A(),Q&&Q.c(),b=A(),_=w("div"),p=L("ID: "),k=L(v),E=A(),x=w("div"),T=L("Created: "),j=L(C),S=A(),B=w("div"),O=w("button"),O.textContent="Edit",z=A(),X=w("button"),X.textContent="Delete",y(i,"class","text-white/60"),y(c,"class","font-mono"),y(n,"class","flex items-baseline gap-2 mb-1"),y(_,"class","text-white/60 text-xs mt-1"),y(x,"class","text-white/60 text-xs"),y(t,"class","flex-1"),y(O,"class","text-blue-500 hover:text-blue-400"),y(X,"class","text-red-500 hover:text-red-400"),y(B,"class","flex gap-2"),y(e,"class","flex justify-between items-start")},m(V,ge){I(V,e,ge),m(e,t),m(t,n),m(n,i),m(i,l),m(i,a),m(i,o),m(n,u),m(n,c),m(c,f),m(t,d),se&&se.m(t,null),m(t,g),Q&&Q.m(t,null),m(t,b),m(t,_),m(_,p),m(_,k),m(t,E),m(t,x),m(x,T),m(x,j),m(e,S),m(e,B),m(B,O),m(B,z),m(B,X),Z||(oe=[J(O,"click",r[4]),J(X,"click",r[5])],Z=!0)},p(V,[ge]){ge&1&&s!==(s=V[0].type+"")&&H(a,s),ge&1&&h!==(h=(V[0].slug||V[0].id)+"")&&H(f,h),V[0].title?se?se.p(V,ge):(se=xi(V),se.c(),se.m(t,g)):se&&(se.d(1),se=null),V[3]&&V[0].parentId?Q?Q.p(V,ge):(Q=Ei(V),Q.c(),Q.m(t,b)):Q&&(Q.d(1),Q=null),ge&1&&v!==(v=V[0].id+"")&&H(k,v),ge&1&&C!==(C=new Date(V[0].createdAt).toLocaleString()+"")&&H(j,C)},i:M,o:M,d(V){V&&P(e),se&&se.d(),Q&&Q.d(),Z=!1,pt(oe)}}}function Zo(r,e,t){let{entity:n}=e,{onEdit:i}=e,{onDelete:l}=e,{showParent:s=!0}=e;const a=()=>i(n),o=()=>l(n.id);return r.$$set=u=>{"entity"in u&&t(0,n=u.entity),"onEdit"in u&&t(1,i=u.onEdit),"onDelete"in u&&t(2,l=u.onDelete),"showParent"in u&&t(3,s=u.showParent)},[n,i,l,s,a,o]}class Es extends he{constructor(e){super(),de(this,e,Zo,Go,pe,{entity:0,onEdit:1,onDelete:2,showParent:3})}}function Si(r,e,t){const n=r.slice();return n[9]=e[t],n}function Ci(r){let e,t=r[2]?"â¼":"â¶",n,i,l;return{c(){e=w("button"),n=L(t),y(e,"class","text-white/60 hover:text-white mt-1")},m(s,a){I(s,e,a),m(e,n),i||(l=J(e,"click",r[8]),i=!0)},p(s,a){a&4&&t!==(t=s[2]?"â¼":"â¶")&&H(n,t)},d(s){s&&P(e),i=!1,l()}}}function Ti(r){let e,t,n=me(r[0].children),i=[];for(let s=0;s<n.length;s+=1)i[s]=Ai(Si(r,n,s));const l=s=>K(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=De()},m(s,a){for(let o=0;o<i.length;o+=1)i[o]&&i[o].m(s,a);I(s,e,a),t=!0},p(s,a){if(a&123){n=me(s[0].children);let o;for(o=0;o<n.length;o+=1){const u=Si(s,n,o);i[o]?(i[o].p(u,a),$(i[o],1)):(i[o]=Ai(u),i[o].c(),$(i[o],1),i[o].m(e.parentNode,e))}for(ue(),o=n.length;o<i.length;o+=1)l(o);fe()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)K(i[a]);t=!1},d(s){s&&P(e),Ne(i,s)}}}function Ai(r){let e,t;return e=new Ss({props:{entity:r[9],level:r[1]+1,expanded:r[3].has(r[9].id),expandedNodes:r[3],onToggle:r[4],onEdit:r[5],onDelete:r[6]}}),{c(){re(e.$$.fragment)},m(n,i){ne(e,n,i),t=!0},p(n,i){const l={};i&1&&(l.entity=n[9]),i&2&&(l.level=n[1]+1),i&9&&(l.expanded=n[3].has(n[9].id)),i&8&&(l.expandedNodes=n[3]),i&16&&(l.onToggle=n[4]),i&32&&(l.onEdit=n[5]),i&64&&(l.onDelete=n[6]),e.$set(l)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){K(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Yo(r){let e,t,n,i,l,s,a,o,u=r[7]&&Ci(r);s=new Es({props:{entity:r[0],onEdit:r[5],onDelete:r[6],showParent:!1}});let c=r[7]&&r[2]&&Ti(r);return{c(){e=w("div"),t=w("div"),n=w("div"),u&&u.c(),i=A(),l=w("div"),re(s.$$.fragment),a=A(),c&&c.c(),y(l,"class","flex-1"),y(n,"class","flex items-start gap-2"),y(t,"class","border border-white/20 p-3 text-xs hover:bg-white/5"),Tr(t,"margin-left",r[1]*20+"px")},m(h,f){I(h,e,f),m(e,t),m(t,n),u&&u.m(n,null),m(n,i),m(n,l),ne(s,l,null),m(e,a),c&&c.m(e,null),o=!0},p(h,[f]){h[7]?u?u.p(h,f):(u=Ci(h),u.c(),u.m(n,i)):u&&(u.d(1),u=null);const d={};f&1&&(d.entity=h[0]),f&32&&(d.onEdit=h[5]),f&64&&(d.onDelete=h[6]),s.$set(d),(!o||f&2)&&Tr(t,"margin-left",h[1]*20+"px"),h[7]&&h[2]?c?(c.p(h,f),f&132&&$(c,1)):(c=Ti(h),c.c(),$(c,1),c.m(e,null)):c&&(ue(),K(c,1,1,()=>{c=null}),fe())},i(h){o||($(s.$$.fragment,h),$(c),o=!0)},o(h){K(s.$$.fragment,h),K(c),o=!1},d(h){h&&P(e),u&&u.d(),te(s),c&&c.d()}}}function Jo(r,e,t){let n,{entity:i}=e,{level:l=0}=e,{expanded:s=!1}=e,{expandedNodes:a}=e,{onToggle:o}=e,{onEdit:u}=e,{onDelete:c}=e;const h=()=>o(i.id);return r.$$set=f=>{"entity"in f&&t(0,i=f.entity),"level"in f&&t(1,l=f.level),"expanded"in f&&t(2,s=f.expanded),"expandedNodes"in f&&t(3,a=f.expandedNodes),"onToggle"in f&&t(4,o=f.onToggle),"onEdit"in f&&t(5,u=f.onEdit),"onDelete"in f&&t(6,c=f.onDelete)},r.$$.update=()=>{r.$$.dirty&1&&t(7,n=i.children&&i.children.length>0)},[i,l,s,a,o,u,c,n,h]}class Ss extends he{constructor(e){super(),de(this,e,Jo,Yo,pe,{entity:0,level:1,expanded:2,expandedNodes:3,onToggle:4,onEdit:5,onDelete:6})}}function Xo(r){let e,t,n,i,l,s,a,o,u,c,h,f,d,g,b,_,p,v,k,E,x,T,C,j,S,B;return{c(){e=w("div"),t=w("div"),n=w("h3"),n.textContent="Edit Entity",i=A(),l=w("div"),s=w("div"),a=w("label"),a.textContent="Slug",o=A(),u=w("input"),c=A(),h=w("div"),f=w("label"),f.textContent="Title",d=A(),g=w("input"),b=A(),_=w("div"),p=w("label"),p.textContent="Content",v=A(),k=w("textarea"),E=A(),x=w("div"),T=w("button"),T.textContent="Save",C=A(),j=w("button"),j.textContent="Cancel",y(n,"class","text-xs uppercase tracking-wider mb-4"),y(a,"for","edit-entity-slug"),y(a,"class","block text-xs text-white/60 mb-1"),y(u,"id","edit-entity-slug"),y(u,"type","text"),y(u,"class","w-full bg-black border border-white/20 px-2 py-1 text-sm"),y(f,"for","edit-entity-title"),y(f,"class","block text-xs text-white/60 mb-1"),y(g,"id","edit-entity-title"),y(g,"type","text"),y(g,"class","w-full bg-black border border-white/20 px-2 py-1 text-sm"),y(p,"for","edit-entity-content"),y(p,"class","block text-xs text-white/60 mb-1"),y(k,"id","edit-entity-content"),y(k,"class","w-full bg-black border border-white/20 px-2 py-1 text-sm"),y(k,"rows","4"),y(T,"class","border border-white/20 px-3 py-1 text-xs uppercase tracking-wider hover:bg-white hover:text-black"),y(j,"class","text-xs uppercase tracking-wider text-white/60 hover:text-white"),y(x,"class","flex gap-2"),y(l,"class","space-y-4"),y(t,"class","bg-black border border-white/20 p-6 max-w-md w-full"),y(e,"class","fixed inset-0 bg-black/80 flex items-center justify-center p-4")},m(O,z){I(O,e,z),m(e,t),m(t,n),m(t,i),m(t,l),m(l,s),m(s,a),m(s,o),m(s,u),U(u,r[0]),m(l,c),m(l,h),m(h,f),m(h,d),m(h,g),U(g,r[1]),m(l,b),m(l,_),m(_,p),m(_,v),m(_,k),U(k,r[2]),m(l,E),m(l,x),m(x,T),m(x,C),m(x,j),S||(B=[J(u,"input",r[6]),J(g,"input",r[7]),J(k,"input",r[8]),J(T,"click",r[3]),J(j,"click",r[4])],S=!0)},p(O,[z]){z&1&&u.value!==O[0]&&U(u,O[0]),z&2&&g.value!==O[1]&&U(g,O[1]),z&4&&U(k,O[2])},i:M,o:M,d(O){O&&P(e),S=!1,pt(B)}}}function ea(r,e,t){let{entity:n}=e;const i=Ft();let l=n.slug||"",s=n.title||"",a=n.content||"";function o(){i("save",{...n,slug:l,title:s,content:a})}function u(){i("cancel")}function c(){l=this.value,t(0,l)}function h(){s=this.value,t(1,s)}function f(){a=this.value,t(2,a)}return r.$$set=d=>{"entity"in d&&t(5,n=d.entity)},[l,s,a,o,u,n,c,h,f]}class ta extends he{constructor(e){super(),de(this,e,ea,Xo,pe,{entity:5})}}function $i(r,e,t){const n=r.slice();return n[16]=e[t],n}function Pi(r,e,t){const n=r.slice();return n[16]=e[t],n}function na(r){let e,t,n,i;const l=[sa,ia],s=[];function a(o,u){return o[4]||o[5]?0:1}return t=a(r),n=s[t]=l[t](r),{c(){e=w("div"),n.c(),y(e,"class","space-y-1")},m(o,u){I(o,e,u),s[t].m(e,null),i=!0},p(o,u){let c=t;t=a(o),t===c?s[t].p(o,u):(ue(),K(s[c],1,1,()=>{s[c]=null}),fe(),n=s[t],n?n.p(o,u):(n=s[t]=l[t](o),n.c()),$(n,1),n.m(e,null))},i(o){i||($(n),i=!0)},o(o){K(n),i=!1},d(o){o&&P(e),s[t].d()}}}function ra(r){let e;return{c(){e=w("div"),e.textContent="Loading...",y(e,"class","text-xs text-white/60")},m(t,n){I(t,e,n)},p:M,i:M,o:M,d(t){t&&P(e)}}}function ia(r){let e,t,n=me(r[2]),i=[];for(let s=0;s<n.length;s+=1)i[s]=Ii($i(r,n,s));const l=s=>K(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=De()},m(s,a){for(let o=0;o<i.length;o+=1)i[o]&&i[o].m(s,a);I(s,e,a),t=!0},p(s,a){if(a&964){n=me(s[2]);let o;for(o=0;o<n.length;o+=1){const u=$i(s,n,o);i[o]?(i[o].p(u,a),$(i[o],1)):(i[o]=Ii(u),i[o].c(),$(i[o],1),i[o].m(e.parentNode,e))}for(ue(),o=n.length;o<i.length;o+=1)l(o);fe()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)K(i[a]);t=!1},d(s){s&&P(e),Ne(i,s)}}}function sa(r){let e,t,n=me(r[1]),i=[];for(let s=0;s<n.length;s+=1)i[s]=Di(Pi(r,n,s));const l=s=>K(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=De()},m(s,a){for(let o=0;o<i.length;o+=1)i[o]&&i[o].m(s,a);I(s,e,a),t=!0},p(s,a){if(a&578){n=me(s[1]);let o;for(o=0;o<n.length;o+=1){const u=Pi(s,n,o);i[o]?(i[o].p(u,a),$(i[o],1)):(i[o]=Di(u),i[o].c(),$(i[o],1),i[o].m(e.parentNode,e))}for(ue(),o=n.length;o<i.length;o+=1)l(o);fe()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)K(i[a]);t=!1},d(s){s&&P(e),Ne(i,s)}}}function Ii(r){let e,t;return e=new Ss({props:{entity:r[16],expanded:r[7].has(r[16].id),expandedNodes:r[7],onToggle:r[8],onEdit:r[14],onDelete:r[9]}}),{c(){re(e.$$.fragment)},m(n,i){ne(e,n,i),t=!0},p(n,i){const l={};i&4&&(l.entity=n[16]),i&132&&(l.expanded=n[7].has(n[16].id)),i&128&&(l.expandedNodes=n[7]),i&64&&(l.onEdit=n[14]),e.$set(l)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){K(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Di(r){let e,t,n,i;return t=new Es({props:{entity:r[16],onEdit:r[13],onDelete:r[9]}}),{c(){e=w("div"),re(t.$$.fragment),n=A(),y(e,"class","border border-white/20 p-3 text-xs")},m(l,s){I(l,e,s),ne(t,e,null),m(e,n),i=!0},p(l,s){const a={};s&2&&(a.entity=l[16]),s&64&&(a.onEdit=l[13]),t.$set(a)},i(l){i||($(t.$$.fragment,l),i=!0)},o(l){K(t.$$.fragment,l),i=!1},d(l){l&&P(e),te(t)}}}function Ri(r){let e,t;return e=new ta({props:{entity:r[6]}}),e.$on("save",r[10]),e.$on("cancel",r[15]),{c(){re(e.$$.fragment)},m(n,i){ne(e,n,i),t=!0},p(n,i){const l={};i&64&&(l.entity=n[6]),e.$set(l)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){K(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function la(r){let e,t,n,i,l,s,a,o,u;function c(p){r[11](p)}function h(p){r[12](p)}let f={};r[4]!==void 0&&(f.searchQuery=r[4]),r[5]!==void 0&&(f.typeFilter=r[5]),t=new Wo({props:f}),cn.push(()=>Ar(t,"searchQuery",c)),cn.push(()=>Ar(t,"typeFilter",h)),t.$on("search",r[0]),t.$on("typeChange",r[0]);const d=[ra,na],g=[];function b(p,v){return p[3]?0:1}s=b(r),a=g[s]=d[s](r);let _=r[6]&&Ri(r);return{c(){e=w("div"),re(t.$$.fragment),l=A(),a.c(),o=A(),_&&_.c()},m(p,v){I(p,e,v),ne(t,e,null),m(e,l),g[s].m(e,null),m(e,o),_&&_.m(e,null),u=!0},p(p,[v]){const k={};!n&&v&16&&(n=!0,k.searchQuery=p[4],$r(()=>n=!1)),!i&&v&32&&(i=!0,k.typeFilter=p[5],$r(()=>i=!1)),t.$set(k);let E=s;s=b(p),s===E?g[s].p(p,v):(ue(),K(g[E],1,1,()=>{g[E]=null}),fe(),a=g[s],a?a.p(p,v):(a=g[s]=d[s](p),a.c()),$(a,1),a.m(e,o)),p[6]?_?(_.p(p,v),v&64&&$(_,1)):(_=Ri(p),_.c(),$(_,1),_.m(e,null)):_&&(ue(),K(_,1,1,()=>{_=null}),fe())},i(p){u||($(t.$$.fragment,p),$(a),$(_),u=!0)},o(p){K(t.$$.fragment,p),K(a),K(_),u=!1},d(p){p&&P(e),te(t),g[s].d(),_&&_.d()}}}function oa(r,e,t){let n=[],i=[],l=!1,s="",a="",o=null,u=new Set;async function c(){t(3,l=!0);try{const k={limit:1e3};a&&(k.type=a),s&&(k.slugPrefix=s);const E=await Ce.queryEntities(k);t(1,n=E||[]);const x=Array.from(new Map(n.map(T=>[T.id,T])).values());t(2,i=Ho(x))}catch(k){console.error("Failed to load entities:",k),t(1,n=[]),t(2,i=[])}finally{t(3,l=!1)}}function h(k){u.has(k)?u.delete(k):u.add(k),t(7,u)}async function f(k){if(confirm("Are you sure you want to delete this entity?"))try{await Ce.deleteEntity(k),await c()}catch(E){console.error("Failed to delete entity:",E),alert("Failed to delete entity")}}async function d(k){const E=k.detail;try{await Ce.updateEntity(E.id,{title:E.title,content:E.content,slug:E.slug}),t(6,o=null),await c()}catch(x){console.error("Failed to update entity:",x),alert("Failed to update entity")}}function g(k){s=k,t(4,s)}function b(k){a=k,t(5,a)}return[c,n,i,l,s,a,o,u,h,f,d,g,b,k=>t(6,o=k),k=>t(6,o=k),()=>t(6,o=null)]}class aa extends he{constructor(e){super(),de(this,e,oa,la,pe,{loadEntities:0})}get loadEntities(){return this.$$.ctx[0]}}function ca(r){let e,t,n,i,l,s,a,o,u,c,h,f,d,g,b,_,p,v,k,E,x,T,C,j,S,B,O,z,X,Z,oe,se,Q,V,ge,we,xr,bt,Sn,Er;return{c(){e=w("form"),t=w("div"),n=w("label"),n.textContent="Type",i=A(),l=w("select"),s=w("option"),s.textContent="Post",a=w("option"),a.textContent="Group",o=w("option"),o.textContent="Party (User)",u=w("option"),u.textContent="Place",c=w("option"),c.textContent="Thing",h=w("option"),h.textContent="Agent",f=A(),d=w("div"),g=w("label"),g.textContent="Slug (optional)",b=A(),_=w("input"),p=A(),v=w("div"),k=w("label"),k.textContent="Title",E=A(),x=w("input"),T=A(),C=w("div"),j=w("label"),j.textContent="Content",S=A(),B=w("textarea"),O=A(),z=w("div"),X=w("label"),X.textContent="Parent ID (optional)",Z=A(),oe=w("input"),se=A(),Q=w("div"),V=w("label"),V.textContent="Sponsor ID (optional)",ge=A(),we=w("input"),xr=A(),bt=w("button"),bt.textContent="Create Entity",y(n,"for","entity-type"),y(n,"class","block text-xs text-white/60 mb-1"),s.__value="post",U(s,s.__value),a.__value="group",U(a,a.__value),o.__value="party",U(o,o.__value),u.__value="place",U(u,u.__value),c.__value="thing",U(c,c.__value),h.__value="agent",U(h,h.__value),y(l,"id","entity-type"),y(l,"class","w-full bg-black border border-white/20 px-2 py-1 text-sm"),r[0]===void 0&&Fi(()=>r[7].call(l)),y(g,"for","entity-slug"),y(g,"class","block text-xs text-white/60 mb-1"),y(_,"id","entity-slug"),y(_,"type","text"),y(_,"class","w-full bg-black border border-white/20 px-2 py-1 text-sm"),y(_,"placeholder","unique-identifier"),y(k,"for","entity-title"),y(k,"class","block text-xs text-white/60 mb-1"),y(x,"id","entity-title"),y(x,"type","text"),y(x,"class","w-full bg-black border border-white/20 px-2 py-1 text-sm"),x.required=!0,y(j,"for","entity-content"),y(j,"class","block text-xs text-white/60 mb-1"),y(B,"id","entity-content"),y(B,"class","w-full bg-black border border-white/20 px-2 py-1 text-sm"),y(B,"rows","4"),y(X,"for","entity-parent-id"),y(X,"class","block text-xs text-white/60 mb-1"),y(oe,"id","entity-parent-id"),y(oe,"type","text"),y(oe,"class","w-full bg-black border border-white/20 px-2 py-1 text-sm"),y(oe,"placeholder","parent-entity-id"),y(V,"for","entity-sponsor-id"),y(V,"class","block text-xs text-white/60 mb-1"),y(we,"id","entity-sponsor-id"),y(we,"type","text"),y(we,"class","w-full bg-black border border-white/20 px-2 py-1 text-sm"),y(we,"placeholder","sponsor-entity-id"),y(bt,"type","submit"),y(bt,"class","border border-white/20 px-4 py-1 text-xs uppercase tracking-wider hover:bg-white hover:text-black"),y(e,"class","max-w-md space-y-4")},m(ke,Me){I(ke,e,Me),m(e,t),m(t,n),m(t,i),m(t,l),m(l,s),m(l,a),m(l,o),m(l,u),m(l,c),m(l,h),an(l,r[0],!0),m(e,f),m(e,d),m(d,g),m(d,b),m(d,_),U(_,r[1]),m(e,p),m(e,v),m(v,k),m(v,E),m(v,x),U(x,r[2]),m(e,T),m(e,C),m(C,j),m(C,S),m(C,B),U(B,r[3]),m(e,O),m(e,z),m(z,X),m(z,Z),m(z,oe),U(oe,r[4]),m(e,se),m(e,Q),m(Q,V),m(Q,ge),m(Q,we),U(we,r[5]),m(e,xr),m(e,bt),Sn||(Er=[J(l,"change",r[7]),J(_,"input",r[8]),J(x,"input",r[9]),J(B,"input",r[10]),J(oe,"input",r[11]),J(we,"input",r[12]),J(e,"submit",r[6])],Sn=!0)},p(ke,[Me]){Me&1&&an(l,ke[0]),Me&2&&_.value!==ke[1]&&U(_,ke[1]),Me&4&&x.value!==ke[2]&&U(x,ke[2]),Me&8&&U(B,ke[3]),Me&16&&oe.value!==ke[4]&&U(oe,ke[4]),Me&32&&we.value!==ke[5]&&U(we,ke[5])},i:M,o:M,d(ke){ke&&P(e),Sn=!1,pt(Er)}}}function ua(r,e,t){let{type:n="post"}=e,{slug:i=""}=e,{title:l=""}=e,{content:s=""}=e,{parentId:a=""}=e,{sponsorId:o=""}=e;const u=Ft();function c(p){p.preventDefault(),u("submit",{type:n,slug:i,title:l,content:s,parentId:a,sponsorId:o})}function h(){n=Li(this),t(0,n)}function f(){i=this.value,t(1,i)}function d(){l=this.value,t(2,l)}function g(){s=this.value,t(3,s)}function b(){a=this.value,t(4,a)}function _(){o=this.value,t(5,o)}return r.$$set=p=>{"type"in p&&t(0,n=p.type),"slug"in p&&t(1,i=p.slug),"title"in p&&t(2,l=p.title),"content"in p&&t(3,s=p.content),"parentId"in p&&t(4,a=p.parentId),"sponsorId"in p&&t(5,o=p.sponsorId)},[n,i,l,s,a,o,c,h,f,d,g,b,_]}class fa extends he{constructor(e){super(),de(this,e,ua,ca,pe,{type:0,slug:1,title:2,content:3,parentId:4,sponsorId:5})}}function ha(r){let e,t;return e=new fa({}),e.$on("submit",r[0]),{c(){re(e.$$.fragment)},m(n,i){ne(e,n,i),t=!0},p:M,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){K(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function da(r,e,t){let n;xt(r,Pt,s=>t(1,n=s));const i=Ft();async function l(s){const a=s.detail;try{const o={title:a.title,content:a.content,auth:n==null?void 0:n.id};a.slug&&(o.slug=a.slug),a.parentId&&(o.parentId=a.parentId),a.sponsorId&&(o.sponsorId=a.sponsorId),a.type==="group"?await Ce.createGroup(o):a.type==="party"?await Ce.createUser(o):await Ce.createPost(o),i("created")}catch(o){console.error("Failed to create entity:",o),alert("Failed to create entity: "+o.message)}}return[l]}class pa extends he{constructor(e){super(),de(this,e,da,ha,pe,{})}}function Oi(r,e,t){const n=r.slice();return n[3]=e[t][0],n[4]=e[t][1],n}function ma(r){let e,t,n,i,l,s=r[1].totalEntities+"",a,o,u,c,h,f,d=me(Object.entries(r[1].byType)),g=[];for(let b=0;b<d.length;b+=1)g[b]=Ki(Oi(r,d,b));return{c(){e=w("div"),t=w("div"),n=w("h3"),n.textContent="Total Entities",i=A(),l=w("div"),a=L(s),o=A(),u=w("div"),c=w("h3"),c.textContent="By Type",h=A(),f=w("div");for(let b=0;b<g.length;b+=1)g[b].c();y(n,"class","text-xs uppercase tracking-wider mb-2"),y(l,"class","text-2xl"),y(t,"class","border border-white/20 p-4"),y(c,"class","text-xs uppercase tracking-wider mb-2"),y(f,"class","space-y-1"),y(u,"class","border border-white/20 p-4"),y(e,"class","space-y-4")},m(b,_){I(b,e,_),m(e,t),m(t,n),m(t,i),m(t,l),m(l,a),m(e,o),m(e,u),m(u,c),m(u,h),m(u,f);for(let p=0;p<g.length;p+=1)g[p]&&g[p].m(f,null)},p(b,_){if(_&2&&s!==(s=b[1].totalEntities+"")&&H(a,s),_&2){d=me(Object.entries(b[1].byType));let p;for(p=0;p<d.length;p+=1){const v=Oi(b,d,p);g[p]?g[p].p(v,_):(g[p]=Ki(v),g[p].c(),g[p].m(f,null))}for(;p<g.length;p+=1)g[p].d(1);g.length=d.length}},d(b){b&&P(e),Ne(g,b)}}}function ga(r){let e;return{c(){e=w("div"),e.textContent="Loading...",y(e,"class","text-xs text-white/60")},m(t,n){I(t,e,n)},p:M,d(t){t&&P(e)}}}function Ki(r){let e,t,n=r[3]+"",i,l,s,a=r[4]+"",o,u;return{c(){e=w("div"),t=w("span"),i=L(n),l=A(),s=w("span"),o=L(a),u=A(),y(t,"class","text-white/60"),y(e,"class","flex justify-between text-sm")},m(c,h){I(c,e,h),m(e,t),m(t,i),m(e,l),m(e,s),m(s,o),m(e,u)},p(c,h){h&2&&n!==(n=c[3]+"")&&H(i,n),h&2&&a!==(a=c[4]+"")&&H(o,a)},d(c){c&&P(e)}}}function ba(r){let e;function t(l,s){if(l[0])return ga;if(l[1])return ma}let n=t(r),i=n&&n(r);return{c(){e=w("div"),i&&i.c()},m(l,s){I(l,e,s),i&&i.m(e,null)},p(l,[s]){n===(n=t(l))&&i?i.p(l,s):(i&&i.d(1),i=n&&n(l),i&&(i.c(),i.m(e,null)))},i:M,o:M,d(l){l&&P(e),i&&i.d()}}}function ya(r,e,t){let n=!1,i=null;async function l(){t(0,n=!0);try{const s=await Ce.queryEntities({limit:1e3}),a={};s.forEach(o=>{a[o.type]=(a[o.type]||0)+1}),t(1,i={totalEntities:s.length,byType:a})}catch(s){console.error("Failed to load stats:",s)}finally{t(0,n=!1)}}return[n,i,l]}class _a extends he{constructor(e){super(),de(this,e,ya,ba,pe,{loadStats:2})}get loadStats(){return this.$$.ctx[2]}}function va(r){let e,t,n={};return e=new _a({props:n}),r[8](e),{c(){re(e.$$.fragment)},m(i,l){ne(e,i,l),t=!0},p(i,l){const s={};e.$set(s)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){K(e.$$.fragment,i),t=!1},d(i){r[8](null),te(e,i)}}}function wa(r){let e,t;return e=new pa({}),e.$on("created",r[3]),{c(){re(e.$$.fragment)},m(n,i){ne(e,n,i),t=!0},p:M,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){K(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function ka(r){let e,t,n={};return e=new aa({props:n}),r[7](e),{c(){re(e.$$.fragment)},m(i,l){ne(e,i,l),t=!0},p(i,l){const s={};e.$set(s)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){K(e.$$.fragment,i),t=!1},d(i){r[7](null),te(e,i)}}}function xa(r){let e,t,n,i,l,s,a,o,u,c,h,f,d;l=new On({props:{active:r[0]==="entities",label:"Entities"}}),l.$on("click",r[4]),a=new On({props:{active:r[0]==="create",label:"Create"}}),a.$on("click",r[5]),u=new On({props:{active:r[0]==="stats",label:"Stats"}}),u.$on("click",r[6]);const g=[ka,wa,va],b=[];function _(p,v){return p[0]==="entities"?0:p[0]==="create"?1:p[0]==="stats"?2:-1}return~(h=_(r))&&(f=b[h]=g[h](r)),{c(){e=w("div"),t=w("h1"),t.textContent="Admin Panel",n=A(),i=w("div"),re(l.$$.fragment),s=A(),re(a.$$.fragment),o=A(),re(u.$$.fragment),c=A(),f&&f.c(),y(t,"class","text-xs uppercase tracking-wider mb-6"),y(i,"class","flex gap-4 mb-6 border-b border-white/20")},m(p,v){I(p,e,v),m(e,t),m(e,n),m(e,i),ne(l,i,null),m(i,s),ne(a,i,null),m(i,o),ne(u,i,null),m(e,c),~h&&b[h].m(e,null),d=!0},p(p,[v]){const k={};v&1&&(k.active=p[0]==="entities"),l.$set(k);const E={};v&1&&(E.active=p[0]==="create"),a.$set(E);const x={};v&1&&(x.active=p[0]==="stats"),u.$set(x);let T=h;h=_(p),h===T?~h&&b[h].p(p,v):(f&&(ue(),K(b[T],1,1,()=>{b[T]=null}),fe()),~h?(f=b[h],f?f.p(p,v):(f=b[h]=g[h](p),f.c()),$(f,1),f.m(e,null)):f=null)},i(p){d||($(l.$$.fragment,p),$(a.$$.fragment,p),$(u.$$.fragment,p),$(f),d=!0)},o(p){K(l.$$.fragment,p),K(a.$$.fragment,p),K(u.$$.fragment,p),K(f),d=!1},d(p){p&&P(e),te(l),te(a),te(u),~h&&b[h].d()}}}function Ea(r,e,t){let n="entities",i,l;function s(){t(0,n="entities")}const a=()=>t(0,n="entities"),o=()=>t(0,n="create"),u=()=>t(0,n="stats");function c(f){cn[f?"unshift":"push"](()=>{i=f,t(1,i)})}function h(f){cn[f?"unshift":"push"](()=>{l=f,t(2,l)})}return r.$$.update=()=>{r.$$.dirty&7&&(n==="entities"&&i?i.loadEntities():n==="stats"&&l&&l.loadStats())},[n,i,l,s,a,o,u,c,h]}class Sa extends he{constructor(e){super(),de(this,e,Ea,xa,pe,{})}}function Ca(r){let e,t,n,i,l,s,a,o;return e=new Ut({props:{path:"/",component:ki}}),n=new Ut({props:{path:"/login",component:Mo}}),l=new Ut({props:{path:"/admin",component:Sa}}),a=new Ut({props:{path:"/*wildcard",component:ki}}),{c(){re(e.$$.fragment),t=A(),re(n.$$.fragment),i=A(),re(l.$$.fragment),s=A(),re(a.$$.fragment)},m(u,c){ne(e,u,c),I(u,t,c),ne(n,u,c),I(u,i,c),ne(l,u,c),I(u,s,c),ne(a,u,c),o=!0},p:M,i(u){o||($(e.$$.fragment,u),$(n.$$.fragment,u),$(l.$$.fragment,u),$(a.$$.fragment,u),o=!0)},o(u){K(e.$$.fragment,u),K(n.$$.fragment,u),K(l.$$.fragment,u),K(a.$$.fragment,u),o=!1},d(u){u&&(P(t),P(i),P(s)),te(e,u),te(n,u),te(l,u),te(a,u)}}}function Ta(r){let e,t;return e=new Ws({props:{$$slots:{default:[Ca]},$$scope:{ctx:r}}}),{c(){re(e.$$.fragment)},m(n,i){ne(e,n,i),t=!0},p(n,i){const l={};i&2&&(l.$$scope={dirty:i,ctx:n}),e.$set(l)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){K(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Aa(r){let e,t;return e=new Ks({props:{url:r[0],$$slots:{default:[Ta]},$$scope:{ctx:r}}}),{c(){re(e.$$.fragment)},m(n,i){ne(e,n,i),t=!0},p(n,[i]){const l={};i&1&&(l.url=n[0]),i&2&&(l.$$scope={dirty:i,ctx:n}),e.$set(l)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){K(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function $a(r,e,t){let{url:n=""}=e;return r.$$set=i=>{"url"in i&&t(0,n=i.url)},[n]}class Pa extends he{constructor(e){super(),de(this,e,$a,Aa,pe,{url:0})}}async function Ia(){return console.log("Main: Initializing app..."),await _s.init(),console.log("Main: API client initialized, starting app..."),new Pa({target:document.getElementById("app")})}Ia();
